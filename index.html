<!DOCTYPE html>
<!--
  ============================================================
  QEIRAN BOOKS â€” Independent Author Register Platform
  PRIVATE & PROPRIETARY â€” QRIB / YH (Angel)
  Â© QRIB. All rights reserved.
  ============================================================
-->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="Qeiran â€” Instant publishing. Your QAN Code. Your price. Your wallet.">
<title>Qeiran â€” Independent Publishing</title>
<style id="disco-font">
/* Disco/retro title style â€” zero network dependency */
@font-face {
  font-family: 'DiscoTitle';
  src: local('Impact'), local('Haettenschweiler'), local('Arial Narrow Bold');
  font-weight: 900;
}

/* â”€â”€ Global mobile fixes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:700px){
  #nav{padding:0 14px;gap:8px}
  .nav-mid{display:none}
  .nav-reg,.nav-authors{font-size:9px;padding:5px 10px;letter-spacing:.06em}
  .brand{font-size:26px}
  .brand-q-mark{width:28px;height:28px}
}
@media(max-width:400px){
  .nav-reg,.nav-authors{font-size:8px;padding:4px 8px}
  .brand{font-size:22px}
  .brand-q-mark{width:24px;height:24px}
}
@media(max-width:520px){
  .cat-head{padding:40px 18px 24px}
  .cat-body{padding:28px 18px}
  .search-wrap{max-width:100%}
  .search-wrap input{font-size:13px;padding:11px 14px}
  .search-wrap button{padding:11px 16px;font-size:9px;min-width:66px;white-space:nowrap;flex-shrink:0}
  #hero{padding:60px 18px 40px}
  .hero-ctas{gap:10px}
  .cta-p,.cta-g{width:100%;text-align:center;padding:12px 20px}
  .stat-bar{grid-template-columns:1fr 1fr}
  .stat{padding:16px 8px}
  .stat-n{font-size:18px}
  .fgrid{grid-template-columns:1fr !important}
  .reg-wrap{padding:28px 18px}
  .book-wrap{padding:20px 16px}
  .b-price-bar{flex-direction:column;align-items:flex-start;gap:10px}
  .scard{padding:24px 18px 20px}
  .s-acts{flex-direction:column}
  .sbn{width:100%}
  .ocard{padding:24px 18px}
  .filters{gap:6px}
  .fb{font-size:13px;padding:4px 10px}
  .qr-scan-block{flex-direction:column;align-items:center;gap:16px}
  .qr-scan-info{text-align:center}
}
</style>
<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RESET + VARS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  /* â•â•â• QEIRAN â€” Cream Â· Gold Â· Turquoise â€” no black panels â•â•â• */
  --bg:     #F6F1E9;   /* warm cream */
  --fg:     #2A2420;   /* warm dark ink */
  --bg2:    #EDE8DE;   /* parchment */
  --surface:#FDFAF5;   /* off-white */
  --border: rgba(42,36,32,.08);
  --dim:    rgba(42,36,32,.40);

  --gold:   #A07810;   /* warm gold */
  --goldf:  #C49830;   /* lighter gold */
  --teal:   #5BA89A;   /* soft turquoise-green â€” primary */
  --teal-l: #4A9488;
  --sage:   #7FB09A;
  --mint:   #A8CFC4;
  --amber:  #C8A040;

  --brand:  #5BA89A;
  --brandl: #4A9488;

  /* legacy aliases â€” keep so nothing breaks */
  --ink:    #2A2420;
  --ink2:   #EDE8DE;
  --paper:  #F6F1E9;
  --cream:  #FDFAF5;
  --rule:   rgba(42,36,32,.08);
  --accent: #C49830;
  --btn-primary:   #5BA89A;
  --btn-secondary: #7FB09A;

  --mono:   'SF Mono','Fira Code','Cascadia Code','Consolas','Courier New',monospace;
  --narrow: 'Helvetica Neue','Arial Narrow','Gill Sans MT Condensed',Arial,sans-serif;
  --serif:  'Helvetica Neue','Arial Narrow',Arial,sans-serif;
  --sans:   'Helvetica Neue','Arial Narrow',Arial,sans-serif;
  --disco:  'Helvetica Neue','Arial Narrow',Arial,sans-serif;
}
html{scroll-behavior:smooth}
body{font-family:var(--narrow);background:var(--bg);color:var(--fg);min-height:100vh;overflow-x:hidden}
a{color:inherit;text-decoration:none}
button{font-family:var(--sans);cursor:pointer;border:none;outline:none;background:none}
input,textarea,select{font-family:var(--sans);outline:none}
.hide{display:none!important}
img{display:block}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   GRAIN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::after{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:9998;opacity:.022;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)'/%3E%3C/svg%3E");
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   NAV
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#nav{
  position:fixed;top:0;left:0;right:0;z-index:500;
  height:54px;display:flex;align-items:center;justify-content:space-between;
  padding:0 36px;
  background:rgba(246,241,233,.97);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(26,24,20,.09);
}
.brand{
  font-family:var(--sans);font-weight:800;font-size:34px;
  letter-spacing:-.02em;display:flex;align-items:baseline;gap:0;
  cursor:pointer;
}
.brand-b{color:var(--fg)}
.brand-q-mark{width:36px;height:36px;vertical-align:middle;margin-right:2px;position:relative;top:-2px}
.brand-q{color:var(--fg)}
.nav-mid{display:flex;gap:32px}
.nav-mid a{
  font-size:12px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;
  color:rgba(26,24,20,.38);transition:color .2s;
}
.nav-mid a:hover,.nav-mid a.active-link{color:var(--fg)}
.nav-reg{
  background:transparent;color:var(--teal);
  font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;
  padding:6px 14px;border-radius:3px;
  border:1px solid rgba(91,143,160,.35);
  transition:all .18s;
}
.nav-reg:hover{background:rgba(91,143,160,.1);border-color:var(--teal);}
.nav-authors{
  background:transparent;color:var(--warm-brown);
  font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;
  padding:6px 14px;border-radius:3px;
  border:1px solid rgba(139,99,85,.3);
  transition:all .18s;margin-right:6px;cursor:pointer;
}
.nav-authors:hover{background:rgba(139,99,85,.08);border-color:var(--warm-brown);}
@media(max-width:700px){
  #nav{padding:0 18px}
  .nav-mid{display:none}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PAGE SHELL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page{display:none;min-height:100vh;padding-top:54px}
.page.active{display:block}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HOME â€” HERO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#home-page{background:var(--bg)}
#hero{
  position:relative;min-height:calc(100vh - 54px);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:80px 24px 60px;text-align:center;overflow:hidden;
}
.hero-dot-grid{
  position:absolute;inset:0;pointer-events:none;
  background-image:radial-gradient(circle,rgba(91,143,160,.35) 1px,transparent 1px);
  background-size:36px 36px;
  mask-image:radial-gradient(ellipse 75% 75% at 50% 50%,black 10%,transparent 100%);
  opacity:.35;
}
.hero-glow{
  position:absolute;width:600px;height:600px;border-radius:50%;
  background:radial-gradient(circle,rgba(91,143,160,.10) 0%,transparent 70%);
  pointer-events:none;top:50%;left:50%;transform:translate(-50%,-50%);
}
.eyebrow{
  font-family:var(--mono);font-size:10px;font-weight:500;
  letter-spacing:.28em;text-transform:uppercase;
  color:var(--warm-brown);margin-bottom:28px;
  display:flex;align-items:center;gap:12px;
}
.eyebrow::before,.eyebrow::after{
  content:'';display:block;width:28px;height:1px;background:var(--warm-brown);opacity:.45;
}
.hero-h{
  font-family:var(--narrow);font-size:clamp(54px,9vw,120px);
  letter-spacing:-.01em;
  line-height:.9;letter-spacing:-.03em;margin-bottom:30px;
  font-weight:200;
}
.hero-h .it{font-style:italic;color:var(--teal)}
.hero-lead{
  font-size:clamp(14px,1.8vw,17px);font-weight:400;
  color:var(--dim);max-width:500px;line-height:1.8;
  margin-bottom:48px;
}
.hero-ctas{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-bottom:72px}
.cta-p{
  background:rgba(91,143,160,.15);color:var(--teal);
  font-size:11px;font-weight:500;letter-spacing:.12em;text-transform:uppercase;
  padding:12px 28px;border-radius:3px;
  border:1px solid rgba(91,143,160,.3);
  transition:all .18s;
  font-family:var(--narrow);
}
.cta-p:hover{background:rgba(91,143,160,.25);transform:translateY(-1px);}
.cta-g{
  background:transparent;color:var(--fg);
  font-size:12px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;
  padding:15px 34px;border-radius:3px;
  border:1px solid var(--border);
  transition:border-color .2s,background .2s,transform .15s;
  font-family:var(--narrow);
}
.cta-g:hover{border-color:var(--teal);color:var(--teal);transform:translateY(-2px)}

/* stat bar */
.stat-bar{
  display:grid;grid-template-columns:repeat(4,1fr);
  border:1px solid var(--border);border-radius:6px;
  overflow:hidden;max-width:680px;width:100%;
  background:var(--surface);
  backdrop-filter:blur(10px);
}
.stat{
  padding:22px 12px;text-align:center;
  border:1px solid var(--border);
}
.stat:last-child{border-right:none}
.stat-n{
  font-family:var(--mono);font-size:22px;font-weight:500;
  color:var(--goldf);display:block;margin-bottom:5px;
}
.stat-l{font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:var(--dim)}
@media(max-width:600px){.stat-bar{grid-template-columns:1fr 1fr}}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HOME â€” FEATURES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#features{
  background:var(--bg2);color:var(--fg);
  padding:100px 24px;
}
.sec-eyebrow{
  font-family:var(--mono);font-size:10px;font-weight:500;
  letter-spacing:.26em;text-transform:uppercase;
  color:var(--brand);margin-bottom:14px;text-align:center;
}
.sec-h{
  font-family:var(--narrow);font-size:clamp(28px,5vw,52px);
  text-align:center;margin-bottom:64px;color:var(--ink);
  line-height:1.05;font-weight:300;
}
.feat-grid{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:2px;max-width:1060px;margin:0 auto;
}
.feat{
  padding:36px 30px;background:var(--surface);
  transition:background .2s;
}
.feat:hover{background:var(--paper)}
.feat-ico{font-size:26px;margin-bottom:18px}
.feat-t{font-size:15px;font-weight:700;margin-bottom:8px;color:var(--ink)}
.feat-b{font-size:13px;line-height:1.8;color:var(--dim);font-weight:300}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HOME â€” HOW IT WORKS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#how{padding:100px 24px;background:var(--bg2)}
.how-wrap{max-width:780px;margin:0 auto}
.steps-list{margin-top:52px}
.step{
  display:grid;grid-template-columns:64px 1fr;
  border:1px solid var(--border);
  padding:28px 0;gap:8px;
}
.step-n{
  font-family:var(--mono);font-size:36px;font-weight:300;
  color:rgba(232,180,34,.18);padding-top:3px;
}
.step-t{font-size:15px;font-weight:700;margin-bottom:6px;letter-spacing:-.01em}
.step-b{font-size:13px;line-height:1.75;color:var(--dim)}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HOME â€” Q-CODE EXPLAINER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#qsec{
  background:var(--brand);padding:100px 24px;
  position:relative;overflow:hidden;
}
#qsec::before{
  content:'';position:absolute;inset:0;pointer-events:none;
  background-image:
    linear-gradient(var(--border) 1px,transparent 1px),
    linear-gradient(90deg,var(--border) 1px,transparent 1px);
  background-size:44px 44px;
}
.qsec-inner{
  max-width:980px;margin:0 auto;position:relative;
  display:grid;grid-template-columns:1fr auto;gap:60px;align-items:center;
}
.qsec-demo{
  background:var(--bg2);border-radius:10px;padding:36px;
  border:1px solid var(--border);
  font-family:var(--mono);min-width:340px;
}
.qcode-str{
  font-size:clamp(13px,2vw,17px);font-weight:500;
  color:#fff;letter-spacing:.07em;margin-bottom:24px;
  word-break:break-all;
}
.qcode-rows{display:flex;flex-direction:column;gap:9px}
.qr{display:flex;align-items:baseline;gap:12px}
.qs{font-weight:700;color:var(--goldf);min-width:48px;font-size:14px}
.qd{color:var(--dim);font-size:12px;line-height:1.4}
@media(max-width:760px){
  .qsec-inner{grid-template-columns:1fr}
  .qsec-demo{min-width:0}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CATALOGUE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#catalogue-page{background:var(--bg);color:var(--fg)}
.cat-head{
  background:var(--bg);
  color:var(--fg);
  padding:52px 36px 36px;
  border-bottom:1px solid var(--border);
}
.cat-head-in{max-width:1080px;margin:0 auto}
.cat-h{
  font-family:var(--narrow);font-size:clamp(26px,5vw,46px);
  margin-bottom:24px;font-weight:300;
}
.search-wrap{
  display:flex;max-width:520px;
  border:1.5px solid var(--border);border-radius:4px;overflow:hidden;
  background:var(--surface);
}
.search-wrap input{
  flex:1;padding:13px 18px;background:transparent;color:var(--fg);
  font-family:var(--narrow);font-size:14px;border:none;
}
.search-wrap input::placeholder{color:var(--dim);font-size:14px}
.search-wrap button{
  padding:13px 20px;background:rgba(91,143,160,.18);color:var(--teal);
  font-family:var(--narrow);font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;
  transition:all .18s;border-left:1px solid var(--border);
}
.search-wrap button:hover{background:rgba(91,143,160,.28);color:var(--fg);}

.cat-body{padding:44px 36px;max-width:1080px;margin:0 auto}
.filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:36px}
.fb{
  padding:5px 13px;border-radius:20px;
  font-family:var(--narrow);font-size:10px;font-weight:500;letter-spacing:.08em;text-transform:uppercase;
  border:1.5px solid rgba(91,168,154,.35);background:var(--surface);color:var(--fg);font-size:15px;
  background:transparent;color:var(--teal);
  cursor:pointer;transition:all .18s;
}
.fb:hover,.fb.on{background:var(--teal);color:#fff;border-color:var(--teal)}

.books-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(210px,1fr));
  gap:20px;
}
.book-card{
  background:var(--surface);border-radius:6px;overflow:hidden;
  box-shadow:0 2px 10px rgba(0,0,0,.07);
  cursor:pointer;transition:transform .2s,box-shadow .2s;
}
.book-card:hover{transform:translateY(-4px);box-shadow:0 14px 36px rgba(0,0,0,.13)}
.bc-cover{
  aspect-ratio:3/4;background:var(--ink);
  position:relative;overflow:hidden;
}
.bc-cover img{width:100%;height:100%;object-fit:cover}
.bc-placeholder{
  width:100%;height:100%;
  display:flex;align-items:center;justify-content:center;
  padding:18px;
  font-family:var(--narrow);font-style:italic;font-size:13px;
  color:var(--dim);text-align:center;
  background:linear-gradient(140deg,var(--bg2),var(--mint));
}
/* QR badge on card */
.bc-qr{
  position:absolute;bottom:7px;left:7px;
  width:38px;height:38px;
}
.bc-qr canvas{width:38px!important;height:38px!important;display:block;border-radius:50%}

.bc-info{padding:14px}
.bc-title{font-size:13px;font-weight:700;margin-bottom:3px;color:var(--ink);line-height:1.3}
.bc-author{font-size:11px;color:var(--dim);margin-bottom:7px}
.bc-qcode{
  font-family:var(--mono);font-size:8px;color:var(--brand);
  letter-spacing:.04em;margin-bottom:8px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.bc-price{font-size:14px;font-weight:700;color:var(--brand)}

.cat-empty{
  text-align:center;padding:72px 0;color:var(--dim);font-size:14px;
  grid-column:1/-1;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   REGISTER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#register-page{background:var(--bg)}
.reg-wrap{max-width:720px;margin:0 auto;padding:56px 32px 100px}
.reg-h{
  font-family:var(--narrow);font-size:clamp(26px,5vw,46px);
  margin-bottom:10px;font-weight:300;color:var(--fg);
}
.reg-sub{font-size:15px;color:var(--dim);margin-bottom:44px;line-height:1.7}

.fsec{border-top:1px solid var(--border);padding-top:28px;margin-bottom:36px}
.fsec-title{
  font-family:var(--mono);font-size:11px;font-weight:600;
  letter-spacing:.18em;text-transform:uppercase;color:var(--gold);margin-bottom:22px;
}
.fgrid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
.fgrid.one{grid-template-columns:1fr}
.field{display:flex;flex-direction:column;gap:8px}
.field label{
  font-size:12px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;
  color:var(--fg);
}
.field input,.field textarea,.field select{
  padding:13px 15px;
  background:var(--surface);
  border:1.5px solid rgba(91,168,154,.35);
  border-radius:4px;color:var(--fg);
  font-size:15px;transition:border-color .2s,background .2s;
}
.field input::placeholder,.field textarea::placeholder{
  color:var(--dim);font-size:14px;
}
.field input:focus,.field textarea:focus,.field select:focus{
  border-color:var(--teal);background:#fff;
  outline:none;box-shadow:0 0 0 3px rgba(91,168,154,.12);
}
.field textarea{resize:vertical;min-height:110px;line-height:1.7;font-size:15px}
.field select{color:var(--fg);background:var(--surface)}
.field select option{background:var(--surface);color:var(--fg)}
.fhint{font-size:11px;color:var(--dim);margin-top:3px;line-height:1.5}

/* cover upload */
.cover-drop{
  border:2px dashed rgba(91,168,154,.4);border-radius:6px;
  padding:44px 22px;text-align:center;cursor:pointer;
  position:relative;transition:border-color .2s,background .2s;
  background:var(--surface);
}
.cover-drop:hover{border-color:var(--teal);background:rgba(91,168,154,.06)}
.cover-drop input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;font-size:0}
.drop-ico{font-size:32px;margin-bottom:10px}
.drop-txt{font-size:14px;color:var(--dim);line-height:1.7}
.drop-txt strong{color:var(--fg)}
.cover-prev{display:none;max-width:160px;margin:16px auto 0;border-radius:4px;overflow:hidden}
.cover-prev img{width:100%}

/* pay tabs */
.ptabs{
  display:flex;border:1.5px solid rgba(91,168,154,.3);border-radius:4px;
  overflow:hidden;margin-bottom:18px;
}
.ptab{
  flex:1;padding:12px;text-align:center;
  font-size:13px;font-weight:600;cursor:pointer;
  color:var(--dim);transition:background .2s,color .2s;
  background:var(--surface);
}
.ptab.on{background:var(--teal);color:#fff}
.pf{display:none}
.pf.on{display:block}

/* submit */
.reg-btn{
  width:100%;padding:18px;margin-top:28px;
  background:var(--teal);color:#fff;
  font-family:var(--narrow);font-size:14px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;
  border:none;
  border-radius:4px;transition:background .2s,transform .15s,box-shadow .2s;
  cursor:pointer;
}
.reg-btn:hover:not(:disabled){
  background:var(--teal-l);transform:translateY(-2px);
  box-shadow:0 8px 28px rgba(91,168,154,.3);
}
.reg-btn:disabled{background:var(--bg2);color:var(--dim);cursor:not-allowed}

/* Original content declaration */
.orig-decl{
  margin-top:28px;
  border:1.5px solid var(--border);border-radius:6px;
  padding:20px 22px;
  background:var(--surface);
}
.orig-label{
  display:flex;align-items:flex-start;gap:14px;cursor:pointer;
}
.orig-label input[type=checkbox]{
  width:18px;height:18px;flex-shrink:0;margin-top:2px;
  accent-color:var(--teal);cursor:pointer;
}
.orig-text{
  font-size:13px;line-height:1.75;color:var(--dim);
}
.orig-label:has(input:checked) .orig-text{color:var(--fg)}

/* Duplicate warning */
.dup-warning{
  display:flex;align-items:flex-start;flex-wrap:wrap;gap:10px;
  margin-top:16px;padding:14px 16px;
  background:rgba(180,60,0,.07);
  border:1.5px solid rgba(180,60,0,.25);
  border-radius:5px;
}
.dup-ico{font-size:18px;line-height:1}
.dup-warning span{font-size:13px;color:var(--fg);flex:1;line-height:1.6}
.dup-view-btn{
  font-family:var(--sans);font-size:11px;font-weight:700;letter-spacing:.08em;
  text-transform:uppercase;color:var(--teal);background:none;border:none;
  cursor:pointer;white-space:nowrap;transition:color .18s;padding:0;
}
.dup-view-btn:hover{color:var(--teal-l)}

/* Duplicate check state on title/author fields */
.field input.dup-hit{border-color:rgba(180,60,0,.5)!important;background:rgba(180,60,0,.05)!important}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   BOOK PAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#book-page{background:var(--cream);color:var(--ink)}
.book-wrap{max-width:880px;margin:0 auto;padding:44px 32px 100px}
.back{
  display:inline-flex;align-items:center;gap:8px;
  font-size:12px;color:var(--brand);font-weight:600;
  letter-spacing:.08em;text-transform:uppercase;
  cursor:pointer;margin-bottom:40px;transition:gap .18s;
}
.back:hover{gap:13px}

.book-hero{display:grid;grid-template-columns:240px 1fr;gap:44px;align-items:start;margin-bottom:52px}
.b-cover{
  border-radius:6px;overflow:hidden;
  box-shadow:0 16px 52px rgba(0,0,0,.18);
  aspect-ratio:3/4;background:var(--ink);position:relative;
}
.b-cover img{width:100%;height:100%;object-fit:cover}
.b-cover-ph{
  width:100%;height:100%;display:flex;align-items:center;justify-content:center;
  font-family:var(--narrow);font-style:italic;font-size:13px;
  color:var(--dim);padding:20px;text-align:center;
  background:linear-gradient(140deg,var(--bg2),var(--mint));
}
.b-cover .qr-stamp{
  position:absolute;bottom:10px;left:10px;
  width:56px;height:56px;
}
.b-cover .qr-stamp canvas{border-radius:50%}

.b-title{font-family:var(--narrow);font-size:clamp(22px,4vw,38px);line-height:1.05;margin-bottom:6px;font-weight:300}
.b-sub{font-size:15px;color:var(--dim);margin-bottom:10px;line-height:1.4}
.b-author{font-size:14px;color:var(--dim);margin-bottom:14px}
.b-qcode{
  font-family:var(--mono);font-size:11px;color:var(--brand);letter-spacing:.06em;
  padding:9px 13px;background:rgba(0,25,168,.06);border-radius:3px;
  display:inline-block;margin-bottom:18px;
}
.b-meta{
  display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;
}
.bm{padding:10px 14px;background:rgba(0,25,168,.05);border-radius:4px}
.bm-l{font-size:9px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;color:var(--dim);margin-bottom:3px}
.bm-v{font-size:13px;font-weight:600;color:var(--ink)}
.b-price-bar{
  display:flex;align-items:center;justify-content:space-between;
  padding:18px 22px;background:var(--ink);color:var(--paper);
  border-radius:6px;margin-bottom:12px;
}
.b-price{font-family:var(--narrow);font-size:30px;color:var(--goldf);font-weight:300}
.b-order-btn{
  background:var(--brand);color:#fff;padding:13px 26px;
  border-radius:3px;font-family:var(--sans);font-size:12px;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;transition:background .2s;
}
.b-order-btn:hover{background:var(--brandl)}
.b-delete-btn{
  background:none;color:rgba(160,40,20,.5);padding:6px 0;
  border:none;font-family:var(--sans);font-size:11px;font-weight:600;
  letter-spacing:.08em;text-transform:uppercase;cursor:pointer;
  transition:color .2s;display:block;margin-top:8px;
}
.b-delete-btn:hover{color:rgba(160,40,20,.9)}
.del-confirm{
  display:none;margin-top:8px;padding:12px 16px;
  background:rgba(160,40,20,.07);border:1px solid rgba(160,40,20,.2);
  border-radius:4px;font-size:12px;color:var(--fg);
}
.del-confirm.open{display:block}
.del-confirm strong{color:rgba(160,40,20,.8)}
.del-yes{background:rgba(160,40,20,.8);color:#fff;border:none;
  padding:7px 16px;border-radius:3px;font-size:11px;font-weight:700;
  letter-spacing:.08em;text-transform:uppercase;cursor:pointer;margin-right:8px;}
.del-yes:hover{background:rgba(160,40,20,1)}
.del-no{background:none;border:1px solid var(--border);color:var(--dim);
  padding:7px 14px;border-radius:3px;font-size:11px;cursor:pointer;}

.b-sec-label{
  font-size:11px;font-weight:700;letter-spacing:.16em;text-transform:uppercase;
  color:var(--brand);margin-bottom:14px;
  padding-bottom:7px;border-bottom:1px solid rgba(0,25,168,.1);
  margin-top:40px;
}
.b-synopsis{font-size:14px;line-height:1.85;color:var(--dim)}

.qr-scan-block{
  display:flex;align-items:center;gap:28px;flex-wrap:wrap;
  padding:28px;background:var(--surface);border-radius:6px;
  box-shadow:0 2px 12px rgba(0,0,0,.07);
}
.qr-scan-info{flex:1;min-width:180px}
.qr-scan-info p{font-size:13px;color:var(--dim);line-height:1.7;margin-bottom:10px}
.qr-url{font-family:var(--mono);font-size:10px;color:var(--brand);word-break:break-all}

@media(max-width:680px){
  .book-hero{grid-template-columns:1fr}
  .b-cover{max-width:220px}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SUCCESS MODAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#success-modal{
  display:none;position:fixed;inset:0;z-index:600;
  background:rgba(0,0,0,.87);backdrop-filter:blur(10px);
  align-items:center;justify-content:center;padding:20px;
  overflow-y:auto;
}
#success-modal.open{display:flex}
.scard{
  background:var(--surface);color:var(--fg);
  border-radius:10px;max-width:560px;width:100%;
  padding:32px 32px 28px;
  animation:pop .28s cubic-bezier(.34,1.56,.64,1);
  position:relative;
}
@keyframes pop{from{transform:scale(.86);opacity:0}to{transform:scale(1);opacity:1}}

/* â”€â”€ Header row â”€â”€ */
.s-header{
  display:flex;align-items:flex-start;
  justify-content:space-between;
  margin-bottom:20px;
  border-bottom:1px solid var(--border);
  padding-bottom:16px;
}
.s-header-text{flex:1;padding-right:16px}
.s-ico{font-size:28px;margin-bottom:6px}
.s-h{font-family:var(--narrow);font-size:24px;font-weight:200;
     letter-spacing:-.01em;color:var(--fg);margin-bottom:3px}
.s-sub{font-size:12px;color:var(--dim);line-height:1.6}

/* â”€â”€ Book details block â”€â”€ */
.s-book-details{
  background:var(--bg2);border-radius:6px;
  padding:16px 18px;margin-bottom:18px;
  border-left:3px solid var(--teal);
}
.s-book-title{
  font-family:var(--narrow);font-size:20px;font-weight:300;
  color:var(--fg);margin-bottom:2px;letter-spacing:-.01em;
}
.s-book-author{
  font-size:13px;color:var(--dim);margin-bottom:12px;
}
.s-meta-grid{
  display:grid;grid-template-columns:1fr 1fr;gap:6px 16px;
}
.s-meta-item{font-size:11px;color:var(--dim)}
.s-meta-item strong{display:block;font-size:12px;color:var(--fg);font-weight:600}

/* â”€â”€ QAN code â”€â”€ */
.s-qcode{
  background:var(--bg);border:1px solid rgba(160,120,16,.25);
  color:#2A2420;
  font-family:var(--mono);font-size:clamp(11px,2.8vw,14px);
  font-weight:500;letter-spacing:.12em;
  padding:13px 16px;border-radius:4px;margin-bottom:6px;
  word-break:break-all;text-align:center;
}
.s-qcode-label{
  font-size:10px;color:var(--dim);text-align:center;
  letter-spacing:.08em;text-transform:uppercase;margin-bottom:18px;
}

/* â”€â”€ Stamp placement section â”€â”€ */
.s-stamp-section{
  display:flex;align-items:flex-start;gap:18px;
  background:var(--bg2);border-radius:6px;
  padding:16px 18px;margin-bottom:18px;
}
.s-stamp-left{flex:1}
.s-stamp-title{
  font-size:12px;font-weight:700;color:var(--fg);
  letter-spacing:.05em;text-transform:uppercase;margin-bottom:6px;
}
.s-stamp-note{font-size:11px;color:var(--dim);line-height:1.7;margin-bottom:10px}
.s-placement-diagram{
  border:1px dashed rgba(91,168,154,.4);border-radius:4px;
  padding:10px 14px;background:var(--surface);
  font-size:10px;color:var(--dim);line-height:1.8;
}
.s-placement-diagram strong{color:var(--teal);display:block;margin-bottom:2px;font-size:11px}

/* â”€â”€ Stamp corner â€” bottom-right front cover â”€â”€ */
.s-stamp-corner{
  flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:6px;
}
#s-qr canvas{
  width:110px!important;height:110px!important;
  display:block;border-radius:50%;
}
.s-stamp-corner-label{
  font-size:9px;color:var(--dim);text-align:center;
  letter-spacing:.04em;text-transform:uppercase;line-height:1.4;
}

.s-hint{font-size:11px;color:var(--dim);margin-bottom:18px;text-align:center}
.s-acts{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.sbn{
  padding:10px 22px;border-radius:3px;
  font-family:var(--sans);font-size:12px;font-weight:700;letter-spacing:.08em;text-transform:uppercase;
  transition:all .18s;
}
.sbn.p{background:var(--brand);color:#fff}
.sbn.p:hover{background:var(--brandl)}
.sbn.o{background:transparent;color:var(--brand);border:1.5px solid var(--brand)}
.sbn.o:hover{background:var(--brand);color:#fff}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ORDER MODAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#order-modal{
  display:none;position:fixed;inset:0;z-index:600;
  background:rgba(0,0,0,.87);backdrop-filter:blur(10px);
  align-items:center;justify-content:center;padding:20px;
}
#order-modal.open{display:flex}
.ocard{
  background:var(--cream);color:var(--ink);
  border-radius:10px;max-width:440px;width:100%;
  padding:38px;
  animation:pop .28s cubic-bezier(.34,1.56,.64,1);
}
.o-h{font-family:var(--narrow);font-size:24px;margin-bottom:5px;font-weight:300}
.o-sub{font-size:12px;color:var(--dim);margin-bottom:26px}
.qty-row{display:flex;align-items:center;gap:14px;margin-bottom:22px}
.qty-label{font-size:13px;font-weight:600}
.qty-inp{
  width:76px;padding:9px;text-align:center;
  background:var(--surface);border:1.5px solid rgba(0,0,0,.12);border-radius:3px;
  font-family:var(--mono);font-size:16px;font-weight:500;color:var(--ink);
}
.o-total{
  display:flex;justify-content:space-between;align-items:center;
  padding:15px;background:rgba(0,25,168,.06);border-radius:5px;margin-bottom:22px;
}
.o-total-l{font-size:12px;color:var(--dim)}
.o-total-v{font-family:var(--narrow);font-size:22px;color:var(--brand);font-weight:300}
.pmethods{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:22px}
.pm{
  padding:13px;border-radius:5px;border:1.5px solid rgba(0,0,0,.1);
  background:var(--surface);cursor:pointer;text-align:center;transition:all .18s;
}
.pm.on{border-color:var(--brand);background:rgba(0,25,168,.05)}
.pm-ico{font-size:20px;display:block;margin-bottom:5px}
.pm-l{font-size:11px;font-weight:600;color:var(--dim)}
.o-place{
  width:100%;padding:15px;background:var(--brand);color:#fff;
  font-family:var(--sans);font-size:13px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  border-radius:4px;transition:background .2s;margin-bottom:10px;
}
.o-place:hover{background:var(--brandl)}
.o-cancel{
  width:100%;padding:11px;font-family:var(--sans);font-size:12px;
  color:var(--dim);font-weight:600;cursor:pointer;transition:color .2s;background:none;border:none;
}
.o-cancel:hover{color:var(--ink)}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TOAST
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast{
  position:fixed;bottom:28px;left:50%;
  transform:translateX(-50%) translateY(16px);
  background:var(--bg2);color:var(--fg);
  padding:12px 22px;border-radius:5px;
  font-size:13px;font-weight:500;
  border:1px solid var(--border);
  opacity:0;transition:opacity .28s,transform .28s;
  pointer-events:none;z-index:1000;white-space:nowrap;
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â”€â”€ CUSTOMISER PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#customiser{
  position:fixed;bottom:14px;right:14px;z-index:9000;
}
#cust-toggle{
  width:30px;height:30px;border-radius:50%;
  background:rgba(184,134,11,.15);color:rgba(184,134,11,.7);
  font-size:13px;font-weight:600;cursor:pointer;
  border:1px solid rgba(184,134,11,.25);
  box-shadow:0 2px 8px rgba(0,0,0,.2);
  display:flex;align-items:center;justify-content:center;
  transition:all .18s;
}
#cust-toggle:hover{background:rgba(184,134,11,.28);color:rgba(184,134,11,1);}
#cust-panel{
  position:absolute;bottom:46px;right:0;
  width:248px;
  background:var(--bg2);
  border:1px solid var(--border);
  border-radius:8px;
  padding:14px;
  box-shadow:0 8px 32px rgba(0,0,0,.5);
  display:none;
}
#cust-panel.open{display:block;}
.cust-h{
  font-size:9px;font-weight:600;letter-spacing:.2em;
  text-transform:uppercase;color:rgba(184,134,11,.7);
  margin-bottom:10px;font-family:var(--mono);
}
.cust-row{
  display:flex;align-items:center;
  margin-bottom:7px;gap:6px;
}
.cust-label{
  font-size:9px;color:var(--dim);
  font-family:var(--mono);letter-spacing:.06em;
  white-space:nowrap;margin-bottom:4px;
}
.cust-row input[type=text]{
  flex:1;padding:4px 7px;
  background:var(--surface);border:1px solid rgba(91,168,154,.3);
  border-radius:3px;color:rgba(255,255,255,.8);font-size:10px;
  font-family:var(--mono);
}
.cust-row input[type=text]:focus{outline:none;border-color:rgba(184,134,11,.6);}
.cust-row select{
  flex:1;padding:4px 6px;
  background:var(--surface);border:1px solid rgba(91,168,154,.3);
  border-radius:3px;color:rgba(255,255,255,.8);font-size:10px;
  font-family:var(--mono);cursor:pointer;
}
.cust-row select option{background:var(--bg2);}
.cust-divider{height:1px;background:var(--surface);margin:8px 0;}
.cust-apply{
  width:100%;padding:6px;margin-top:4px;
  background:rgba(184,134,11,.18);color:rgba(184,134,11,.9);
  font-size:9px;font-weight:700;letter-spacing:.16em;text-transform:uppercase;
  border:1px solid rgba(184,134,11,.25);border-radius:3px;cursor:pointer;
  transition:all .15s;font-family:var(--mono);
}
.cust-apply:hover{background:rgba(184,134,11,.3);color:#fff;}
.cust-swatch-row{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:8px;}
.cust-swatch{
  width:20px;height:20px;border-radius:3px;cursor:pointer;
  border:1.5px solid transparent;transition:border .15s;
}
.cust-swatch:hover,.cust-swatch.active{border-color:rgba(255,255,255,.7);}
.cust-name-hint{
  font-size:8px;color:rgba(255,255,255,.18);
  font-family:var(--mono);line-height:1.8;margin-bottom:8px;
}



.qan-wordmark{
  font-family:var(--narrow);font-size:10px;font-weight:600;
  letter-spacing:.28em;text-transform:uppercase;
  color:var(--dim);margin-bottom:10px;
}
.cat-sub{
  font-size:13px;color:var(--dim);
  margin-top:6px;margin-bottom:4px;
  font-family:var(--narrow);font-weight:300;
  letter-spacing:.02em;
}
.cat-h{
  font-family:var(--narrow);font-size:clamp(36px,6vw,64px);
  font-weight:200;letter-spacing:-.02em;
  margin-bottom:20px;color:var(--fg);
}

.cta-ghost{
  padding:12px 22px;font-size:10px;font-weight:400;
  letter-spacing:.1em;text-transform:uppercase;
  border:none;border-radius:3px;
  color:var(--dim);background:transparent;
  cursor:pointer;transition:color .18s;
  font-family:var(--narrow);
}
.cta-ghost:hover{color:var(--fg);}
.cat-sub{font-size:14px;color:rgba(0,0,0,.45);margin-top:6px;margin-bottom:0;}
.wholesale-bar{
  background:var(--bg2);border-bottom:1px solid var(--border);
  padding:0;
}
.ws-inner{
  max-width:1080px;margin:0 auto;
  padding:14px 24px;
  display:flex;align-items:center;gap:16px;flex-wrap:wrap;
}
.ws-tag{
  font-size:11px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  background:var(--sage);color:#fff;padding:3px 9px;border-radius:3px;white-space:nowrap;
}
.ws-text{font-size:13px;color:#555;flex:1;min-width:200px;}
.ws-btn{
  padding:8px 18px;background:transparent;
  border:1px solid rgba(122,158,138,.4);color:var(--sage);
  border-radius:3px;font-size:10px;font-weight:500;
  letter-spacing:.1em;text-transform:uppercase;cursor:pointer;
  white-space:nowrap;transition:all .15s;padding:6px 14px;
}
.ws-btn:hover{background:rgba(122,158,138,.12);}


/* â”€â”€ AUTHORS PORTAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#authors-page{background:var(--bg);color:var(--fg);}
.author-step{
  display:grid;grid-template-columns:42px 1fr;gap:20px;
  padding:24px 0;border-top:1px solid var(--border);
  align-items:start;
}
.step-num{
  font-family:var(--mono);font-size:11px;font-weight:600;
  color:var(--dim);letter-spacing:.04em;padding-top:3px;
}
.step-title{
  font-family:var(--narrow);font-size:16px;font-weight:400;
  letter-spacing:-.01em;color:var(--fg);margin-bottom:8px;
}
.step-desc{
  font-size:13px;line-height:1.8;color:var(--dim);
  font-weight:300;max-width:580px;
}
.step-action{
  display:inline-block;margin-top:14px;
  background:transparent;border:none;padding:0;
  font-size:11px;font-weight:500;letter-spacing:.08em;
  text-transform:uppercase;color:var(--teal);cursor:pointer;
  font-family:var(--narrow);transition:letter-spacing .18s;
}
.step-action:hover{letter-spacing:.14em;}
.step-upload-row{display:flex;gap:10px;margin-top:14px;align-items:center;flex-wrap:wrap;}
.upload-pill{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 14px;border-radius:30px;cursor:pointer;
  border:1px solid var(--border);
  font-size:11px;font-weight:500;color:var(--fg);
  font-family:var(--narrow);transition:all .15s;
  background:var(--surface);
}
.upload-pill:hover{border-color:var(--teal);color:var(--teal);}
.author-stat-box{
  padding:14px 20px;background:var(--bg2);
  border-radius:4px;border:1px solid var(--border);
  min-width:90px;
}
.asb-n{
  font-family:var(--narrow);font-size:28px;font-weight:200;
  color:var(--fg);letter-spacing:-.02em;line-height:1;margin-bottom:4px;
}
.asb-l{
  font-size:9px;font-weight:600;letter-spacing:.14em;
  text-transform:uppercase;color:var(--dim);font-family:var(--mono);
}


#caveat-bar{
  background:var(--bg2);border-top:1px solid var(--border);
  padding:16px 24px;text-align:center;
  font-family:var(--mono);font-size:10px;
  color:var(--dim);line-height:1.9;
}

/* ===== MOBILE RESPONSIVE IMPROVEMENTS ===== */
@media(max-width:480px){
  #nav{padding:0 12px;gap:6px;height:52px;}
  .brand-name{font-size:13px;}
  .nav-reg,.nav-authors,.nav-link{font-size:8px;padding:4px 7px;}
  .hero-inner{padding:40px 16px 30px;}
  .hero-inner h1{font-size:clamp(22px,7vw,36px);}
  .hero-inner p{font-size:13px;}
  .stat-bar{grid-template-columns:1fr 1fr;gap:0;}
  .stat-item{padding:12px 8px;}
  .stat-num{font-size:22px;}
  .stat-lbl{font-size:8px;}
  #page-register{padding:20px 14px;}
  .reg-card{padding:20px 16px;}
  #payblock{padding:16px;}
  #payblock a{width:100%;display:block;text-align:center;box-sizing:border-box;}
  .book-hero{grid-template-columns:1fr !important;}
  .book-cover-wrap{max-width:180px;margin:0 auto;}
  .book-grid{grid-template-columns:1fr 1fr !important;}
  #admin-modal > div{padding:16px !important;width:97vw !important;}
  #admin-modal h2{font-size:15px;}
  #modal-overlay > div{padding:20px 16px !important;}
  canvas{max-width:100% !important;}
  #caveat-bar{padding:12px 14px;font-size:9px;}
}
@media(max-width:360px){
  .book-grid{grid-template-columns:1fr !important;}
  .stat-bar{grid-template-columns:1fr !important;}
}
@media(max-width:600px){
  .reg-label{font-size:11px;}
  .terms-scroll{max-height:120px;}
  .success-inner{padding:24px 16px;}
}
/* ===== END MOBILE ===== */
</style>

<!-- PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=AWgaR0lcttqcqzsLi1eM7EskTA39MgGUph_kXACfIxngi2yM_W6fwIIR_D72EqbdK_Y6vMxXwluY-LUw&currency=GBP&components=buttons,card-fields&intent=capture" data-sdk-integration-source="button-factory"></script>
</head>
<body>

<div id="admin-pw-modal" style="display:flex;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:10000;align-items:center;justify-content:center;">
  <div style="background:#f6f1e9;border-radius:10px;padding:32px;width:min(320px,90vw);text-align:center;">
    <div style="font-size:28px;margin-bottom:10px;">&#128274;</div>
    <h3 style="font-size:15px;font-weight:700;margin-bottom:6px;">QRIB Admin</h3>
    <p style="font-size:11px;color:#888;margin-bottom:14px;">Enter your admin password.</p>
    <input id="admin-pw-input" type="password" placeholder="Password"
      onkeydown="if(event.key==='Enter')adminCheckPW()"
      style="width:100%;padding:10px 12px;border:1px solid #ccc;border-radius:6px;font-size:14px;box-sizing:border-box;margin-bottom:8px;">
    <div id="admin-pw-error" style="display:none;font-size:11px;color:#c0392b;margin-bottom:8px;">Incorrect password.</div>
    <button onclick="adminCheckPW()" style="width:100%;padding:11px;background:#1A0800;color:#fff;border:none;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;">Enter</button>
  </div>
</div>



<!-- â•â•â• NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="nav">
  <div class="brand" onclick="go('home')">
    <span class="brand-b"><svg class="brand-q-mark" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><circle cx="16" cy="16" r="14.5" fill="none" stroke="#A07810" stroke-width="1.0"/><circle cx="16" cy="16" r="11" fill="#A07810"/><circle cx="16" cy="16" r="7.1" fill="#F6F1E9"/><path d="M21.2 21.8 L26.8 27.4 L24.8 29.2 L19.2 23.6 Z" fill="#A07810"/><circle cx="16" cy="16" r="7.1" fill="#F6F1E9"/></svg><span style="font-weight:200;color:#2A2420">eiran</span></span>
  </div>
  <!-- brand sub removed from nav, shown in page header instead -->
  <div class="nav-mid">
    <a id="nl-catalogue" href="#" onclick="go('catalogue');return false">Search &amp; Buy</a>
    <a id="nl-home"      href="#" onclick="go('home');return false"     >About</a>
  </div>
  <button class="nav-authors" onclick="go('authors')">Qeiran Authors</button>
  <button class="nav-reg" onclick="go('register')">Register a Book</button>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="home-page" class="page">

  <section id="hero">
    <div class="hero-dot-grid"></div>
    <div class="hero-glow"></div>
    <div class="eyebrow">Independent Author Register</div>
    <h1 class="hero-h">
      Your book.<br><span class="it">Your address.</span>
    </h1>
    <p class="hero-lead">Register your book in under five minutes. Get a unique QAN Code, a print-ready QR, and a live global catalogue page â€” instantly. No agents. No waiting lists.</p>
    <div class="hero-ctas">
      <button class="cta-p" onclick="go('register')">Register Your Book</button>
      <button class="cta-ghost" onclick="go('catalogue')">Search &amp; Browse â†“</button>
    </div>
    <div class="stat-bar">
      <div class="stat"><span class="stat-n" id="stat-count">0</span><span class="stat-l">Books Registered</span></div>
      <div class="stat"><span class="stat-n">&lt;5 min</span><span class="stat-l">To Go Live</span></div>
      <div class="stat"><span class="stat-n">150+</span><span class="stat-l">Countries</span></div>
      <div class="stat"><span class="stat-n">0%</span><span class="stat-l">Gatekeeping</span></div>
    </div>
  </section>

  <section id="features">
    <p class="sec-eyebrow">Why Qeiran</p>
    <h2 class="sec-h">The ISBN took weeks.<br>The Q&#8209;Code takes four minutes.</h2>
    <div class="feat-grid">
      <div class="feat"><div class="feat-ico">âš¡</div><div class="feat-t">Instant Registration</div><div class="feat-b">Your QAN Code is generated the moment you submit. Your QR is print-ready in seconds. Your book is live in the catalogue before you've put the kettle on.</div></div>
      <div class="feat"><div class="feat-ico">ğŸŒ</div><div class="feat-t">Globally Reachable</div><div class="feat-b">Any author. Any country. The QAN Code carries an ISO country prefix so your origin is always encoded â€” and buyers worldwide can find and order your title.</div></div>
      <div class="feat"><div class="feat-ico">ğŸ’°</div><div class="feat-t">Direct Payment</div><div class="feat-b">Buyers pay you â€” not a publisher, not a distributor. Straight to your PayPal or crypto wallet. Qeiran takes its percentage automatically. No delay.</div></div>
      <div class="feat"><div class="feat-ico">ğŸ“¦</div><div class="feat-t">Print on Demand</div><div class="feat-b">No warehouse. No minimum run. One copy or one thousand â€” printed and shipped only when someone buys. Zero stock risk. Zero waste.</div></div>
      <div class="feat"><div class="feat-ico">ğŸ”’</div><div class="feat-t">Permanently Traceable</div><div class="feat-b">Every QAN Code is permanently recorded. Every scan is logged. Every order is traceable. If your book is scanned on the other side of the world, you'll know.</div></div>
      <div class="feat"><div class="feat-ico">âœ…</div><div class="feat-t">Error Corrected</div><div class="feat-b">The QAN Code carries a built-in check character. If a scanner misreads one digit, the mismatch is caught. Your book's identity is always protected.</div></div>
    </div>
  </section>

  <section id="how">
    <div class="how-wrap">
      <p class="eyebrow" style="justify-content:flex-start">The Process</p>
      <h2 style="font-family:var(--narrow);font-size:clamp(28px,5vw,50px);font-weight:300;line-height:1.05;margin-top:12px">Six steps.<br>Fully automated.</h2>
      <div class="steps-list">
        <div class="step"><div class="step-n">01</div><div><div class="step-t">Create your author account</div><div class="step-b">Name, country, payment details. One form. Takes 90 seconds. Your author token links all your titles permanently.</div></div></div>
        <div class="step"><div class="step-n">02</div><div><div class="step-t">Enter your book details</div><div class="step-b">Title, genre, language, edition, year, synopsis, price. The QAN Code is generated automatically from these fields.</div></div></div>
        <div class="step"><div class="step-n">03</div><div><div class="step-t">Upload your cover</div><div class="step-b">An overlay shows you where to keep clear. The QR is composited onto your cover at bottom-centre at print resolution.</div></div></div>
        <div class="step"><div class="step-n">04</div><div><div class="step-t">Receive your QAN Code and QR</div><div class="step-b">Download your print-ready QR PNG at 300dpi with error correction Level H â€” 30% damage tolerance. Printer-ready immediately.</div></div></div>
        <div class="step"><div class="step-n">05</div><div><div class="step-t">Go live in the catalogue</div><div class="step-b">Searchable by title, author, genre, or QAN Code. Buyers anywhere in the world can find and order from this moment.</div></div></div>
        <div class="step"><div class="step-n">06</div><div><div class="step-t">Get paid when they do</div><div class="step-b">A buyer orders. Payment confirmed. Qeiran's percentage deducted automatically. Your payout hits your wallet within 48 hours.</div></div></div>
      </div>
    </div>
  </section>

  <section id="qsec">
    <div class="qsec-inner">
      <div>
        <p class="sec-eyebrow" style="text-align:left;color:var(--dim)">The Identifier</p>
        <h2 style="font-family:var(--narrow);font-size:clamp(26px,4.5vw,48px);font-weight:200;line-height:1.05;color:var(--fg);margin:10px 0 22px">More than an ISBN.<br>It's a complete record.</h2>
        <p style="font-size:14px;line-height:1.85;color:var(--dim);max-width:420px;margin-bottom:30px">The ISBN only stores country + publisher + title. The QAN Code stores everything: author, title, country, year, edition â€” and a built-in error-correction check â€” all in one scannable string.</p>
        <button class="cta-p" onclick="go('register')">Get your QAN Code â†’</button>
      </div>
      <div class="qsec-demo">
        <div class="qcode-str">Q-GB-25-KNJA-ABST-01-0047-X</div>
        <div class="qcode-rows">
          <div class="qr"><span class="qs">Q</span><span class="qd">Qeiran platform prefix</span></div>
          <div class="qr"><span class="qs">GB</span><span class="qd">ISO 3166 country code â€” Great Britain</span></div>
          <div class="qr"><span class="qs">25</span><span class="qd">Publication year â€” 2025</span></div>
          <div class="qr"><span class="qs">KNJA</span><span class="qd">Author token â€” Kin Jane</span></div>
          <div class="qr"><span class="qs">ABST</span><span class="qd">Title token â€” Abstract Writing</span></div>
          <div class="qr"><span class="qs">01</span><span class="qd">Edition â€” First edition</span></div>
          <div class="qr"><span class="qs">0047</span><span class="qd">Sequence â€” 47th book registered</span></div>
          <div class="qr"><span class="qs">X</span><span class="qd">Check character â€” error detection</span></div>
        </div>
      </div>
    </div>
  </section>

</div><!-- /home -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CATALOGUE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="catalogue-page" class="page active">
  <div class="cat-head">
    <div class="cat-head-in">
      <div class="qan-wordmark">Qeiran</div>
      <h1 class="cat-h">Books</h1>
      <p class="cat-sub">Search by title, author, QAN code, ISBN or genre</p>
      <div class="search-wrap">
        <input type="text" id="cat-q" placeholder="Search title, author, QAN Code, genreâ€¦" oninput="renderCat()">
        <button onclick="renderCat()">Search</button>
      </div>
    </div>
  </div>
  <div class="wholesale-bar">
    <div class="ws-inner">
      <span class="ws-tag">ğŸ“¦ Wholesale</span>
      <span class="ws-text">Buying in volume? Libraries, bookshops and distributors â€” speak to us about volume pricing. <strong>Enquire below.</strong></span>
      <button class="ws-btn" onclick="document.getElementById('ws-form').classList.toggle('hide')">Wholesale Enquiry</button>
    </div>
    <div id="ws-form" class="hide" style="padding:18px 24px;border-top:1px solid rgba(0,0,0,.08)">
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:12px;align-items:end;max-width:780px">
        <div><label style="font-size:10px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;display:block;margin-bottom:6px">Organisation</label>
          <input type="text" id="ws-org" placeholder="Library / Retailer name" style="width:100%;padding:9px 12px;border:1px solid rgba(0,0,0,.15);border-radius:4px;font-size:13px"></div>
        <div><label style="font-size:10px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;display:block;margin-bottom:6px">Email</label>
          <input type="email" id="ws-email" placeholder="buyer@organisation.com" style="width:100%;padding:9px 12px;border:1px solid rgba(0,0,0,.15);border-radius:4px;font-size:13px"></div>
        <div><label style="font-size:10px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;display:block;margin-bottom:6px">Qty (approx)</label>
          <input type="number" id="ws-qty" placeholder="e.g. 500" style="width:100%;padding:9px 12px;border:1px solid rgba(0,0,0,.15);border-radius:4px;font-size:13px"></div>
        <button onclick="wsSubmit()" style="padding:7px 16px;background:var(--sage);color:#fff;border:none;border-radius:3px;font-size:10px;font-weight:500;cursor:pointer;letter-spacing:.1em;text-transform:uppercase;font-family:var(--narrow)">Send</button>
      </div>
      <p style="font-size:11px;color:#888;margin-top:10px">We will respond within 1 working day with a wholesale price sheet. Volume orders of 50+ receive a minimum 30% discount off the listed author price.</p>
    </div>
  </div>
  <div class="cat-body">
    <div class="filters" id="filters">
      <button class="fb on" onclick="setFilter('all',this)">All</button>
      <button class="fb" onclick="setFilter('Fiction',this)">Fiction</button>
      <button class="fb" onclick="setFilter('Non-Fiction',this)">Non-Fiction</button>
      <button class="fb" onclick="setFilter('Poetry',this)">Poetry</button>
      <button class="fb" onclick="setFilter('Art',this)">Art</button>
      <button class="fb" onclick="setFilter('Science',this)">Science</button>
      <button class="fb" onclick="setFilter('Philosophy',this)">Philosophy</button>
      <button class="fb" onclick="setFilter('Biography',this)">Biography</button>
    </div>
    <div class="books-grid" id="booksGrid"></div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     REGISTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="register-page" class="page">
  <div class="reg-wrap">
    <h1 class="reg-h">Register Your Book</h1>
    <p class="reg-sub">Complete the form below. Your unique QAN Code and print-ready QR code are generated automatically on submission. Keep the bottom-centre 15% of your cover clear â€” the QR will be placed there.</p>

    <div class="fsec">
      <div class="fsec-title">About You</div>
      <div class="fgrid">
        <div class="field"><label>Full Name *</label><input id="rn" type="text" placeholder="Your full name" oninput="liveDupCheck()"></div>
        <div class="field"><label>Email *</label><input id="re" type="email" placeholder="you@example.com"></div>
        <div class="field"><label>Country *</label>
          <select id="rc">
            <option value="">â€” Select country â€”</option>
            <option value="GB">United Kingdom</option>
            <option value="US">United States</option>
            <option value="CA">Canada</option>
            <option value="AU">Australia</option>
            <option value="NG">Nigeria</option>
            <option value="ZA">South Africa</option>
            <option value="GH">Ghana</option>
            <option value="KE">Kenya</option>
            <option value="IN">India</option>
            <option value="FR">France</option>
            <option value="DE">Germany</option>
            <option value="IT">Italy</option>
            <option value="ES">Spain</option>
            <option value="BR">Brazil</option>
            <option value="MX">Mexico</option>
            <option value="JP">Japan</option>
            <option value="CN">China</option>
            <option value="KR">South Korea</option>
            <option value="NZ">New Zealand</option>
            <option value="IE">Ireland</option>
            <option value="SG">Singapore</option>
            <option value="JM">Jamaica</option>
            <option value="TT">Trinidad &amp; Tobago</option>
            <option value="BB">Barbados</option>
            <option value="PT">Portugal</option>
            <option value="NL">Netherlands</option>
            <option value="SE">Sweden</option>
            <option value="NO">Norway</option>
            <option value="PL">Poland</option>
          </select>
        </div>
        <div class="field"><label>Short Bio (optional)</label><input id="rb" type="text" placeholder="One sentence about you"></div>
      </div>
    </div>

    <div class="fsec">
      <div class="fsec-title">Book Details</div>
      <div class="fgrid one"><div class="field"><label>Book Title *</label><input id="rt" type="text" placeholder="Your book title" oninput="liveDupCheck()"></div></div>
      <div class="fgrid" style="margin-top:18px">
        <div class="field"><label>Subtitle</label><input id="rs" type="text" placeholder="Optional subtitle"></div>
        <div class="field"><label>Genre *</label>
          <select id="rg">
            <option value="">â€” Select genre â€”</option>
            <option>Fiction</option><option>Non-Fiction</option><option>Poetry</option>
            <option>Art</option><option>Science</option><option>Philosophy</option>
            <option>Biography</option><option>History</option><option>Children</option>
            <option>Self-Help</option><option>Business</option><option>Technology</option>
            <option>Other</option>
          </select>
        </div>
        <div class="field"><label>Language *</label>
          <select id="rl">
            <option value="English">English</option><option value="French">French</option>
            <option value="Spanish">Spanish</option><option value="German">German</option>
            <option value="Portuguese">Portuguese</option><option value="Arabic">Arabic</option>
            <option value="Japanese">Japanese</option><option value="Chinese">Chinese</option>
            <option value="Korean">Korean</option><option value="Other">Other</option>
          </select>
        </div>
        <div class="field"><label>Edition *</label>
          <select id="red">
            <option value="01">1st Edition</option><option value="02">2nd Edition</option>
            <option value="03">3rd Edition</option><option value="04">4th Edition</option>
          </select>
        </div>
        <div class="field"><label>Year *</label><input id="ry" type="number" placeholder="2025" min="2020" max="2099" value="2025"></div>
        <div class="field"><label>Pages</label><input id="rp" type="number" placeholder="240"></div>
        <div class="field">
          <label>Print Price (Â£ GBP) *</label>
          <input id="rpr" type="number" placeholder="14.99" step="0.01" min="0.99">
          <span class="fhint">Qeiran retains 12%. The rest goes to your payment account within 48h.</span>
        </div>
      </div>
      <div class="fgrid one" style="margin-top:18px">
        <div class="field"><label>Synopsis *</label><textarea id="rsy" placeholder="2â€“5 sentences about your bookâ€¦"></textarea></div>
      </div>
    </div>

    <div class="fsec">
      <div class="fsec-title" style="margin-bottom:10px;">Q Stamp Placement Guide</div>
      <div style="background:rgba(26,8,0,.03);border:1px solid rgba(26,8,0,.1);border-radius:8px;padding:16px;margin-bottom:18px;display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap;">
        <!-- Back cover diagram -->
        <div style="flex:0 0 auto;">
          <div style="width:120px;height:160px;border:2px solid #1A0800;border-radius:3px;position:relative;background:#fff;font-size:9px;color:#aaa;">
            <div style="padding:8px 6px 0;font-size:8px;color:#bbb;line-height:1.4;">Back cover artwork area</div>
            <!-- Stamp indicator -->
            <div style="position:absolute;bottom:8px;left:8px;width:24px;height:24px;border-radius:50%;background:#1A0800;display:flex;align-items:center;justify-content:center;"><span style="color:#F5EDE0;font-size:9px;font-weight:700;">Q</span></div>
            <!-- dimension arrows -->
            <div style="position:absolute;bottom:4px;left:34px;font-size:7px;color:#5BA89A;white-space:nowrap;">&#8592; 6mm from edge</div>
            <div style="position:absolute;bottom:33px;left:8px;font-size:7px;color:#5BA89A;writing-mode:vertical-rl;transform:rotate(180deg);">6mm</div>
          </div>
          <div style="font-size:9px;color:#888;margin-top:6px;text-align:center;width:120px;">Back cover (actual proportions)</div>
        </div>
        <!-- Specs -->
        <div style="flex:1;min-width:180px;">
          <div style="font-size:11px;font-weight:700;color:#1A0800;margin-bottom:8px;">Q Stamp dimensions on your printed book:</div>
          <div style="font-size:11px;line-height:2;color:#444;">
            <strong>Size:</strong> 18&times;18 mm &nbsp;(minimum 15mm, maximum 22mm)<br>
            <strong>Position:</strong> Bottom-left corner, back cover<br>
            <strong>Clear margin from edge:</strong> 6mm on both sides<br>
            <strong>Clear zone above stamp:</strong> 5mm (no text in this area)<br>
            <strong>Print format:</strong> PNG, 300 dpi, transparent background<br>
            <strong>Digital format:</strong> PNG, 700px &times; 700px<br>
          </div>
          <div style="margin-top:8px;padding:8px 10px;background:rgba(91,168,154,.1);border-left:3px solid #5BA89A;border-radius:0 4px 4px 0;font-size:10px;line-height:1.6;color:#444;">
            <strong>Important:</strong> Keep the bottom-left 30&times;30mm of your back cover free of important text or barcodes. The Q Stamp will be placed in this zone. ISBN barcodes should sit on the bottom-right corner instead.
          </div>
        </div>
      </div>
    </div>
    <div class="fsec">
      <div class="fsec-title">Back Cover Upload</div>
      <div class="cover-drop" id="cdrop" onclick="document.getElementById('rcov').click()">
        <input type="file" id="rcov" accept="image/*" onchange="onCover(this)">
        <div id="cdrop-content">
          <div class="drop-ico">ğŸ“–</div>
          <div class="drop-txt"><strong>Click to upload your book cover</strong><br>JPG or PNG Â· Minimum 1400px wide<br><span style="font-size:11px;opacity:.5">Keep bottom-centre 15% clear â€” QR code will be placed there automatically</span></div>
        </div>
        <div class="cover-prev" id="cprev"><img id="cprev-img" src="" alt=""></div>
      </div>
    </div>

    <div class="fsec">
      <div class="fsec-title">Payment Details</div>
      <p style="font-size:12px;color:var(--dim);margin-bottom:18px;line-height:1.7">How you want to receive payment when someone orders. Updatable at any time.</p>
      <div class="ptabs">
        <div class="ptab on" id="pt-paypal" onclick="setPay('paypal',this)">PayPal</div>
        <div class="ptab" id="pt-crypto" onclick="setPay('crypto',this)">Crypto Wallet</div>
        <div class="ptab" id="pt-both"   onclick="setPay('both',this)">Both</div>
      </div>
      <div class="pf on" id="pf-paypal">
        <div class="field"><label>PayPal Email</label><input id="rpp" type="email" placeholder="your-paypal@email.com"></div>
      </div>
      <div class="pf" id="pf-crypto">
        <div class="fgrid">
          <div class="field"><label>Wallet Address</label><input id="rwa" type="text" placeholder="0xâ€¦ or bc1â€¦"></div>
          <div class="field"><label>Currency</label>
            <select id="rcur"><option value="USDC">USDC (stable)</option><option value="ETH">Ethereum</option><option value="BTC">Bitcoin</option><option value="SOL">Solana</option></select>
          </div>
        </div>
      </div>
      <div class="pf" id="pf-both">
        <div class="fgrid">
          <div class="field"><label>PayPal Email</label><input id="rpp2" type="email" placeholder="your-paypal@email.com"></div>
          <div class="field"><label>Wallet Address</label><input id="rwa2" type="text" placeholder="0xâ€¦ or bc1â€¦"></div>
          <div class="field"><label>Currency</label>
            <select id="rcur2"><option value="USDC">USDC (stable)</option><option value="ETH">Ethereum</option><option value="BTC">Bitcoin</option><option value="SOL">Solana</option></select>
          </div>
        </div>
      </div>
    </div>

<!-- QRIB Terms scrollbox -->
    <div style="background:rgba(26,8,0,.04);border:1px solid rgba(26,8,0,.12);border-radius:6px;padding:14px 16px;margin-bottom:12px;font-size:11px;line-height:1.75;color:var(--dim);max-height:155px;overflow-y:auto;">
      <strong style="font-size:12px;color:var(--fg);display:block;margin-bottom:6px">QRIB Registration Terms &amp; Conditions</strong>
      <strong>1. Review.</strong> All titles are subject to a 24&ndash;48 hour review. Submission does not guarantee registration.<br><br>
      <strong>2. Criteria.</strong> Original work, solely owned, professionally edited, complete.<br><br>
      <strong>3. Refund.</strong> If declined, full &pound;49 refund within 5 working days. No refund once QAN Code issued.<br><br>
      <strong>4. Commission.</strong> QRIB charges 12%. Authors receive 88% and invoice QRIB monthly.<br><br>
      <strong>5. Ownership.</strong> You retain copyright. QRIB gets non-exclusive licence to display in catalogue.<br><br>
      <strong>6. Conduct.</strong> Do not register works you do not own.
    </div>
    <!-- Original content declaration + duplicate warning -->
    <div class="orig-decl" id="orig-decl-wrap">
      <label class="orig-label">
        <input type="checkbox" id="orig-check" onchange="checkOriginal()">
        <span class="orig-text">I have read and agree to the QRIB Registration Terms above. I declare this is an original, complete work and I hold all rights to publish it. Registering content that infringes copyright is a breach of Qeiran terms.</span>
      </label>
      <div class="dup-warning hide" id="dup-warning">
        <span class="dup-ico">âš </span>
        <span id="dup-msg">A similar title or author is already registered.</span>
        <button class="dup-view-btn" onclick="viewDuplicate()">View existing listing â†’</button>
      </div>
    </div>
    <div id="paypal-fee-block" style="display:none;">

  <!-- â•â•â• PAYMENT SECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div style="background:#fff;border:1px solid #ddd;border-radius:10px;padding:20px;margin-bottom:14px;">

    <div style="font-size:12px;font-weight:700;color:var(--fg);margin-bottom:4px;letter-spacing:.04em;">
      Registration Fee â€” <span style="color:var(--teal);">Â£29.00</span>
    </div>
    <div style="font-size:10px;color:var(--dim);margin-bottom:16px;">
      Secure payment. Your QAN Code is issued after payment is confirmed.
    </div>

    <!-- Payment confirmed banner (hidden until paid) -->
    <div id="pay-confirmed" style="display:none;background:rgba(91,168,154,.12);border:1px solid rgba(91,168,154,.4);border-radius:6px;padding:10px 14px;margin-bottom:14px;font-size:12px;font-weight:700;color:#2d7a6e;">
      âœ“ Payment confirmed â€” complete your registration below.
    </div>

    <!-- PRIMARY: Card payment -->
    <div id="pay-card-section">
      <div style="font-size:10px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:#888;margin-bottom:10px;">Pay by Card</div>
      <div id="card-form-wrap">
        <!-- PayPal Hosted Card Fields render here -->
        <div style="margin-bottom:10px;">
          <label style="font-size:10px;color:#888;display:block;margin-bottom:4px;">Card Number</label>
          <div id="card-number-field-container" style="border:1px solid #ccc;border-radius:5px;padding:10px;background:#fafafa;height:38px;"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
          <div>
            <label style="font-size:10px;color:#888;display:block;margin-bottom:4px;">Expiry Date</label>
            <div id="card-expiry-field-container" style="border:1px solid #ccc;border-radius:5px;padding:10px;background:#fafafa;height:38px;"></div>
          </div>
          <div>
            <label style="font-size:10px;color:#888;display:block;margin-bottom:4px;">CVV / CVC</label>
            <div id="card-cvv-field-container" style="border:1px solid #ccc;border-radius:5px;padding:10px;background:#fafafa;height:38px;"></div>
          </div>
        </div>
        <div style="margin-bottom:14px;">
          <label style="font-size:10px;color:#888;display:block;margin-bottom:4px;">Name on Card</label>
          <div id="card-name-field-container" style="border:1px solid #ccc;border-radius:5px;padding:10px;background:#fafafa;height:38px;"></div>
        </div>
        <div id="card-pay-error" style="display:none;color:#c0392b;font-size:11px;margin-bottom:10px;"></div>
        <button id="card-pay-btn" onclick="submitCardPayment()" style="width:100%;padding:13px;background:#1A0800;color:#fff;border:none;border-radius:7px;font-size:13px;font-weight:700;cursor:pointer;letter-spacing:.02em;">
          Pay Â£29 by Card
        </button>
        <div id="card-pay-loading" style="display:none;text-align:center;padding:10px;font-size:11px;color:#888;">Processing paymentâ€¦</div>
      </div>
    </div>

    <!-- DIVIDER -->
    <div style="display:flex;align-items:center;gap:10px;margin:16px 0;">
      <div style="flex:1;height:1px;background:#e0d6c8;"></div>
      <div style="font-size:10px;color:#aaa;font-weight:600;letter-spacing:.1em;">OR</div>
      <div style="flex:1;height:1px;background:#e0d6c8;"></div>
    </div>

    <!-- SECONDARY: PayPal button -->
    <div id="pay-paypal-section">
      <div style="font-size:10px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:#888;margin-bottom:10px;">Pay with PayPal</div>
      <div id="paypal-button-container"></div>
    </div>

    <!-- DIVIDER -->
    <div style="display:flex;align-items:center;gap:10px;margin:16px 0;">
      <div style="flex:1;height:1px;background:#e0d6c8;"></div>
      <div style="font-size:10px;color:#aaa;font-weight:600;letter-spacing:.1em;">OR</div>
      <div style="flex:1;height:1px;background:#e0d6c8;"></div>
    </div>

    <!-- TERTIARY: Crypto (inactive) -->
    <div id="pay-crypto-section" style="opacity:.45;pointer-events:none;">
      <div style="font-size:10px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:#888;margin-bottom:6px;">Crypto Payment</div>
      <div style="background:#f5f0e8;border:1px dashed #ccc;border-radius:6px;padding:12px;font-size:11px;color:#888;text-align:center;">
        âš™ Crypto payment not yet activated.<br>
        <span style="font-size:10px;">Admin can enable this in Settings â†’ add wallet address.</span>
      </div>
    </div>

    <!-- Lock icon / security note -->
    <div style="text-align:center;margin-top:14px;font-size:9px;color:#bbb;">
      ğŸ”’ Payments secured by PayPal Â· No card details stored on Qeiran servers
    </div>

  </div>
</div>

<button class="reg-btn" id="reg-btn" onclick="doRegister()" disabled style="opacity:.5;cursor:not-allowed;">Complete Registration &mdash; Â£29</button>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOOK DETAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="book-page" class="page">
  <div class="book-wrap">
    <div class="back" onclick="go('catalogue')">â† Back to Catalogue</div>
    <div id="book-content"></div>
  </div>
</div>


<!-- â•â•â• SUCCESS MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="success-modal">
  <div class="scard">

    <!-- Header -->
    <div class="s-header">
      <div class="s-header-text">
        <div class="s-ico">ğŸ“—</div>
        <h2 class="s-h">Submitted for review.</h2>
        <p class="s-sub">Your title has been submitted to the Qeiran Independent Author Register. Your QAN Code will be emailed within 24&ndash;48 hours once reviewed and approved by QRIB.</p>
      </div>
    </div>

    <!-- Book details -->
    <div class="s-book-details">
      <div class="s-book-title" id="s-book-title"></div>
      <div class="s-book-author" id="s-book-author"></div>
      <div class="s-meta-grid">
        <div class="s-meta-item"><strong id="s-meta-genre"></strong>Genre</div>
        <div class="s-meta-item"><strong id="s-meta-price"></strong>Your price</div>
        <div class="s-meta-item"><strong id="s-meta-year"></strong>Year</div>
        <div class="s-meta-item"><strong id="s-meta-cut"></strong>Platform cut</div>
      </div>
    </div>

    <!-- QAN Code -->
    <div style="background:rgba(91,168,154,.1);border:1px solid rgba(91,168,154,.3);border-radius:6px;padding:14px 18px;margin:14px 0;font-size:12px;line-height:1.7;color:var(--fg);text-align:center;"><strong>Submission received &#10003;</strong><br>QAN Code will be emailed within <strong>24&ndash;48 hours</strong> once approved by QRIB.</div><div class="s-qcode hide" id="s-qcode-text"></div>
    <div class="s-qcode-label">Your unique QAN Code â€” keep this</div>

    <!-- Stamp placement section -->
    <div class="s-stamp-section">
      <div class="s-stamp-left">
        <div class="s-stamp-title">Your Q Stamp</div>
        <p class="s-stamp-note">Place in the <strong style="color:var(--teal)">bottom-left corner of the front cover</strong> â€” small, unobtrusive, away from the spine. Let the cover breathe around it.</p>
        <div class="s-placement-diagram">
          <strong>Recommended size: 18 Ã— 18mm</strong>
          Minimum: 15mm Â· Maximum: 22mm<br>
          Position: bottom-left, front cover<br>
          Clear margin from edge: 6mm<br>
          Format: PNG at 300dpi â€” print-ready
        </div>
      </div>
      <!-- The Q stamp â€” small, right-aligned, as it will appear on the cover -->
      <div class="s-stamp-corner">
        <div id="s-qr"></div>
        <div class="s-stamp-corner-label">As it appears<br>on your cover</div>
      </div>
    </div>

    <div class="s-acts">
      <button class="sbn p" onclick="dlQR()">â†“ Download Q Stamp</button>
      <button class="sbn o" onclick="viewLastBook()">View My Listing</button>
      <button class="sbn o" onclick="closeSuccess()">Done</button>
    </div>

  </div>
</div>

<!-- â•â•â• ORDER MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="order-modal">
  <div class="ocard">
    <h2 class="o-h">Place an Order</h2>
    <p class="o-sub" id="o-bname"></p>
    <div class="qty-row">
      <span class="qty-label">Quantity:</span>
      <input type="number" class="qty-inp" id="o-qty" value="1" min="1" max="1000" oninput="updTotal()">
    </div>
    <div class="o-total">
      <span class="o-total-l">Total</span>
      <span class="o-total-v" id="o-total">Â£0.00</span>
    </div>
    <div class="pmethods">
      <div class="pm on" id="pm-pp"     onclick="setPM('paypal')"><span class="pm-ico">ğŸ…¿ï¸</span><span class="pm-l">PayPal</span></div>
      <div class="pm"    id="pm-crypto" onclick="setPM('crypto')"><span class="pm-ico">â‚¿</span><span class="pm-l">Crypto</span></div>
    </div>
    <button class="o-place" onclick="doOrder()">Place Order &amp; Pay</button>
    <button class="o-cancel" onclick="closeOrder()">Cancel</button>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>




<script>
const QEIRAN_CONFIG = {
  SUPABASE_URL:        'https://hdujymavzjucsufpwekf.supabase.co',
  SUPABASE_KEY:        'sb_publishable_1NBHdCiQWEZPfIiqgGoIFg_sTJJABro-',
  FORMSPREE_REGISTER:  'xgoldryy',
  FORMSPREE_ORDER:     'mjgeljll',
  FORMSPREE_WHOLESALE: 'mqednwnv',
  PLATFORM_EMAIL:      'maat@qrib.co.uk',
  PLATFORM_PAYPAL:     'maat@qrib.co.uk',
  REGISTRATION_FEE:    29.00,
};

(() => {
  var __getOwnPropNames = Object.getOwnPropertyNames;
  var __commonJS = (cb, mod) => function __require() {
    return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
  };

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/can-promise.js
  var require_can_promise = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/can-promise.js"(exports, module) {
      module.exports = function() {
        return typeof Promise === "function" && Promise.prototype && Promise.prototype.then;
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/utils.js
  var require_utils = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/utils.js"(exports) {
      var toSJISFunction;
      var CODEWORDS_COUNT = [
        0,
        // Not used
        26,
        44,
        70,
        100,
        134,
        172,
        196,
        242,
        292,
        346,
        404,
        466,
        532,
        581,
        655,
        733,
        815,
        901,
        991,
        1085,
        1156,
        1258,
        1364,
        1474,
        1588,
        1706,
        1828,
        1921,
        2051,
        2185,
        2323,
        2465,
        2611,
        2761,
        2876,
        3034,
        3196,
        3362,
        3532,
        3706
      ];
      exports.getSymbolSize = function getSymbolSize(version) {
        if (!version) throw new Error('"version" cannot be null or undefined');
        if (version < 1 || version > 40) throw new Error('"version" should be in range from 1 to 40');
        return version * 4 + 17;
      };
      exports.getSymbolTotalCodewords = function getSymbolTotalCodewords(version) {
        return CODEWORDS_COUNT[version];
      };
      exports.getBCHDigit = function(data) {
        let digit = 0;
        while (data !== 0) {
          digit++;
          data >>>= 1;
        }
        return digit;
      };
      exports.setToSJISFunction = function setToSJISFunction(f) {
        if (typeof f !== "function") {
          throw new Error('"toSJISFunc" is not a valid function.');
        }
        toSJISFunction = f;
      };
      exports.isKanjiModeEnabled = function() {
        return typeof toSJISFunction !== "undefined";
      };
      exports.toSJIS = function toSJIS(kanji) {
        return toSJISFunction(kanji);
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/error-correction-level.js
  var require_error_correction_level = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/error-correction-level.js"(exports) {
      exports.L = { bit: 1 };
      exports.M = { bit: 0 };
      exports.Q = { bit: 3 };
      exports.H = { bit: 2 };
      function fromString(string) {
        if (typeof string !== "string") {
          throw new Error("Param is not a string");
        }
        const lcStr = string.toLowerCase();
        switch (lcStr) {
          case "l":
          case "low":
            return exports.L;
          case "m":
          case "medium":
            return exports.M;
          case "q":
          case "quartile":
            return exports.Q;
          case "h":
          case "high":
            return exports.H;
          default:
            throw new Error("Unknown EC Level: " + string);
        }
      }
      exports.isValid = function isValid(level) {
        return level && typeof level.bit !== "undefined" && level.bit >= 0 && level.bit < 4;
      };
      exports.from = function from(value, defaultValue) {
        if (exports.isValid(value)) {
          return value;
        }
        try {
          return fromString(value);
        } catch (e) {
          return defaultValue;
        }
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/bit-buffer.js
  var require_bit_buffer = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/bit-buffer.js"(exports, module) {
      function BitBuffer() {
        this.buffer = [];
        this.length = 0;
      }
      BitBuffer.prototype = {
        get: function(index) {
          const bufIndex = Math.floor(index / 8);
          return (this.buffer[bufIndex] >>> 7 - index % 8 & 1) === 1;
        },
        put: function(num, length) {
          for (let i = 0; i < length; i++) {
            this.putBit((num >>> length - i - 1 & 1) === 1);
          }
        },
        getLengthInBits: function() {
          return this.length;
        },
        putBit: function(bit) {
          const bufIndex = Math.floor(this.length / 8);
          if (this.buffer.length <= bufIndex) {
            this.buffer.push(0);
          }
          if (bit) {
            this.buffer[bufIndex] |= 128 >>> this.length % 8;
          }
          this.length++;
        }
      };
      module.exports = BitBuffer;
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/bit-matrix.js
  var require_bit_matrix = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/bit-matrix.js"(exports, module) {
      function BitMatrix(size) {
        if (!size || size < 1) {
          throw new Error("BitMatrix size must be defined and greater than 0");
        }
        this.size = size;
        this.data = new Uint8Array(size * size);
        this.reservedBit = new Uint8Array(size * size);
      }
      BitMatrix.prototype.set = function(row, col, value, reserved) {
        const index = row * this.size + col;
        this.data[index] = value;
        if (reserved) this.reservedBit[index] = true;
      };
      BitMatrix.prototype.get = function(row, col) {
        return this.data[row * this.size + col];
      };
      BitMatrix.prototype.xor = function(row, col, value) {
        this.data[row * this.size + col] ^= value;
      };
      BitMatrix.prototype.isReserved = function(row, col) {
        return this.reservedBit[row * this.size + col];
      };
      module.exports = BitMatrix;
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/alignment-pattern.js
  var require_alignment_pattern = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/alignment-pattern.js"(exports) {
      var getSymbolSize = require_utils().getSymbolSize;
      exports.getRowColCoords = function getRowColCoords(version) {
        if (version === 1) return [];
        const posCount = Math.floor(version / 7) + 2;
        const size = getSymbolSize(version);
        const intervals = size === 145 ? 26 : Math.ceil((size - 13) / (2 * posCount - 2)) * 2;
        const positions = [size - 7];
        for (let i = 1; i < posCount - 1; i++) {
          positions[i] = positions[i - 1] - intervals;
        }
        positions.push(6);
        return positions.reverse();
      };
      exports.getPositions = function getPositions(version) {
        const coords = [];
        const pos = exports.getRowColCoords(version);
        const posLength = pos.length;
        for (let i = 0; i < posLength; i++) {
          for (let j = 0; j < posLength; j++) {
            if (i === 0 && j === 0 || // top-left
            i === 0 && j === posLength - 1 || // bottom-left
            i === posLength - 1 && j === 0) {
              continue;
            }
            coords.push([pos[i], pos[j]]);
          }
        }
        return coords;
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/finder-pattern.js
  var require_finder_pattern = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/finder-pattern.js"(exports) {
      var getSymbolSize = require_utils().getSymbolSize;
      var FINDER_PATTERN_SIZE = 7;
      exports.getPositions = function getPositions(version) {
        const size = getSymbolSize(version);
        return [
          // top-left
          [0, 0],
          // top-right
          [size - FINDER_PATTERN_SIZE, 0],
          // bottom-left
          [0, size - FINDER_PATTERN_SIZE]
        ];
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/mask-pattern.js
  var require_mask_pattern = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/mask-pattern.js"(exports) {
      exports.Patterns = {
        PATTERN000: 0,
        PATTERN001: 1,
        PATTERN010: 2,
        PATTERN011: 3,
        PATTERN100: 4,
        PATTERN101: 5,
        PATTERN110: 6,
        PATTERN111: 7
      };
      var PenaltyScores = {
        N1: 3,
        N2: 3,
        N3: 40,
        N4: 10
      };
      exports.isValid = function isValid(mask) {
        return mask != null && mask !== "" && !isNaN(mask) && mask >= 0 && mask <= 7;
      };
      exports.from = function from(value) {
        return exports.isValid(value) ? parseInt(value, 10) : void 0;
      };
      exports.getPenaltyN1 = function getPenaltyN1(data) {
        const size = data.size;
        let points = 0;
        let sameCountCol = 0;
        let sameCountRow = 0;
        let lastCol = null;
        let lastRow = null;
        for (let row = 0; row < size; row++) {
          sameCountCol = sameCountRow = 0;
          lastCol = lastRow = null;
          for (let col = 0; col < size; col++) {
            let module2 = data.get(row, col);
            if (module2 === lastCol) {
              sameCountCol++;
            } else {
              if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5);
              lastCol = module2;
              sameCountCol = 1;
            }
            module2 = data.get(col, row);
            if (module2 === lastRow) {
              sameCountRow++;
            } else {
              if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5);
              lastRow = module2;
              sameCountRow = 1;
            }
          }
          if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5);
          if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5);
        }
        return points;
      };
      exports.getPenaltyN2 = function getPenaltyN2(data) {
        const size = data.size;
        let points = 0;
        for (let row = 0; row < size - 1; row++) {
          for (let col = 0; col < size - 1; col++) {
            const last = data.get(row, col) + data.get(row, col + 1) + data.get(row + 1, col) + data.get(row + 1, col + 1);
            if (last === 4 || last === 0) points++;
          }
        }
        return points * PenaltyScores.N2;
      };
      exports.getPenaltyN3 = function getPenaltyN3(data) {
        const size = data.size;
        let points = 0;
        let bitsCol = 0;
        let bitsRow = 0;
        for (let row = 0; row < size; row++) {
          bitsCol = bitsRow = 0;
          for (let col = 0; col < size; col++) {
            bitsCol = bitsCol << 1 & 2047 | data.get(row, col);
            if (col >= 10 && (bitsCol === 1488 || bitsCol === 93)) points++;
            bitsRow = bitsRow << 1 & 2047 | data.get(col, row);
            if (col >= 10 && (bitsRow === 1488 || bitsRow === 93)) points++;
          }
        }
        return points * PenaltyScores.N3;
      };
      exports.getPenaltyN4 = function getPenaltyN4(data) {
        let darkCount = 0;
        const modulesCount = data.data.length;
        for (let i = 0; i < modulesCount; i++) darkCount += data.data[i];
        const k = Math.abs(Math.ceil(darkCount * 100 / modulesCount / 5) - 10);
        return k * PenaltyScores.N4;
      };
      function getMaskAt(maskPattern, i, j) {
        switch (maskPattern) {
          case exports.Patterns.PATTERN000:
            return (i + j) % 2 === 0;
          case exports.Patterns.PATTERN001:
            return i % 2 === 0;
          case exports.Patterns.PATTERN010:
            return j % 3 === 0;
          case exports.Patterns.PATTERN011:
            return (i + j) % 3 === 0;
          case exports.Patterns.PATTERN100:
            return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 === 0;
          case exports.Patterns.PATTERN101:
            return i * j % 2 + i * j % 3 === 0;
          case exports.Patterns.PATTERN110:
            return (i * j % 2 + i * j % 3) % 2 === 0;
          case exports.Patterns.PATTERN111:
            return (i * j % 3 + (i + j) % 2) % 2 === 0;
          default:
            throw new Error("bad maskPattern:" + maskPattern);
        }
      }
      exports.applyMask = function applyMask(pattern, data) {
        const size = data.size;
        for (let col = 0; col < size; col++) {
          for (let row = 0; row < size; row++) {
            if (data.isReserved(row, col)) continue;
            data.xor(row, col, getMaskAt(pattern, row, col));
          }
        }
      };
      exports.getBestMask = function getBestMask(data, setupFormatFunc) {
        const numPatterns = Object.keys(exports.Patterns).length;
        let bestPattern = 0;
        let lowerPenalty = Infinity;
        for (let p = 0; p < numPatterns; p++) {
          setupFormatFunc(p);
          exports.applyMask(p, data);
          const penalty = exports.getPenaltyN1(data) + exports.getPenaltyN2(data) + exports.getPenaltyN3(data) + exports.getPenaltyN4(data);
          exports.applyMask(p, data);
          if (penalty < lowerPenalty) {
            lowerPenalty = penalty;
            bestPattern = p;
          }
        }
        return bestPattern;
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/error-correction-code.js
  var require_error_correction_code = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/error-correction-code.js"(exports) {
      var ECLevel = require_error_correction_level();
      var EC_BLOCKS_TABLE = [
        // L  M  Q  H
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        2,
        2,
        1,
        2,
        2,
        4,
        1,
        2,
        4,
        4,
        2,
        4,
        4,
        4,
        2,
        4,
        6,
        5,
        2,
        4,
        6,
        6,
        2,
        5,
        8,
        8,
        4,
        5,
        8,
        8,
        4,
        5,
        8,
        11,
        4,
        8,
        10,
        11,
        4,
        9,
        12,
        16,
        4,
        9,
        16,
        16,
        6,
        10,
        12,
        18,
        6,
        10,
        17,
        16,
        6,
        11,
        16,
        19,
        6,
        13,
        18,
        21,
        7,
        14,
        21,
        25,
        8,
        16,
        20,
        25,
        8,
        17,
        23,
        25,
        9,
        17,
        23,
        34,
        9,
        18,
        25,
        30,
        10,
        20,
        27,
        32,
        12,
        21,
        29,
        35,
        12,
        23,
        34,
        37,
        12,
        25,
        34,
        40,
        13,
        26,
        35,
        42,
        14,
        28,
        38,
        45,
        15,
        29,
        40,
        48,
        16,
        31,
        43,
        51,
        17,
        33,
        45,
        54,
        18,
        35,
        48,
        57,
        19,
        37,
        51,
        60,
        19,
        38,
        53,
        63,
        20,
        40,
        56,
        66,
        21,
        43,
        59,
        70,
        22,
        45,
        62,
        74,
        24,
        47,
        65,
        77,
        25,
        49,
        68,
        81
      ];
      var EC_CODEWORDS_TABLE = [
        // L  M  Q  H
        7,
        10,
        13,
        17,
        10,
        16,
        22,
        28,
        15,
        26,
        36,
        44,
        20,
        36,
        52,
        64,
        26,
        48,
        72,
        88,
        36,
        64,
        96,
        112,
        40,
        72,
        108,
        130,
        48,
        88,
        132,
        156,
        60,
        110,
        160,
        192,
        72,
        130,
        192,
        224,
        80,
        150,
        224,
        264,
        96,
        176,
        260,
        308,
        104,
        198,
        288,
        352,
        120,
        216,
        320,
        384,
        132,
        240,
        360,
        432,
        144,
        280,
        408,
        480,
        168,
        308,
        448,
        532,
        180,
        338,
        504,
        588,
        196,
        364,
        546,
        650,
        224,
        416,
        600,
        700,
        224,
        442,
        644,
        750,
        252,
        476,
        690,
        816,
        270,
        504,
        750,
        900,
        300,
        560,
        810,
        960,
        312,
        588,
        870,
        1050,
        336,
        644,
        952,
        1110,
        360,
        700,
        1020,
        1200,
        390,
        728,
        1050,
        1260,
        420,
        784,
        1140,
        1350,
        450,
        812,
        1200,
        1440,
        480,
        868,
        1290,
        1530,
        510,
        924,
        1350,
        1620,
        540,
        980,
        1440,
        1710,
        570,
        1036,
        1530,
        1800,
        570,
        1064,
        1590,
        1890,
        600,
        1120,
        1680,
        1980,
        630,
        1204,
        1770,
        2100,
        660,
        1260,
        1860,
        2220,
        720,
        1316,
        1950,
        2310,
        750,
        1372,
        2040,
        2430
      ];
      exports.getBlocksCount = function getBlocksCount(version, errorCorrectionLevel) {
        switch (errorCorrectionLevel) {
          case ECLevel.L:
            return EC_BLOCKS_TABLE[(version - 1) * 4 + 0];
          case ECLevel.M:
            return EC_BLOCKS_TABLE[(version - 1) * 4 + 1];
          case ECLevel.Q:
            return EC_BLOCKS_TABLE[(version - 1) * 4 + 2];
          case ECLevel.H:
            return EC_BLOCKS_TABLE[(version - 1) * 4 + 3];
          default:
            return void 0;
        }
      };
      exports.getTotalCodewordsCount = function getTotalCodewordsCount(version, errorCorrectionLevel) {
        switch (errorCorrectionLevel) {
          case ECLevel.L:
            return EC_CODEWORDS_TABLE[(version - 1) * 4 + 0];
          case ECLevel.M:
            return EC_CODEWORDS_TABLE[(version - 1) * 4 + 1];
          case ECLevel.Q:
            return EC_CODEWORDS_TABLE[(version - 1) * 4 + 2];
          case ECLevel.H:
            return EC_CODEWORDS_TABLE[(version - 1) * 4 + 3];
          default:
            return void 0;
        }
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/galois-field.js
  var require_galois_field = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/galois-field.js"(exports) {
      var EXP_TABLE = new Uint8Array(512);
      var LOG_TABLE = new Uint8Array(256);
      (function initTables() {
        let x = 1;
        for (let i = 0; i < 255; i++) {
          EXP_TABLE[i] = x;
          LOG_TABLE[x] = i;
          x <<= 1;
          if (x & 256) {
            x ^= 285;
          }
        }
        for (let i = 255; i < 512; i++) {
          EXP_TABLE[i] = EXP_TABLE[i - 255];
        }
      })();
      exports.log = function log(n) {
        if (n < 1) throw new Error("log(" + n + ")");
        return LOG_TABLE[n];
      };
      exports.exp = function exp(n) {
        return EXP_TABLE[n];
      };
      exports.mul = function mul(x, y) {
        if (x === 0 || y === 0) return 0;
        return EXP_TABLE[LOG_TABLE[x] + LOG_TABLE[y]];
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/polynomial.js
  var require_polynomial = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/polynomial.js"(exports) {
      var GF = require_galois_field();
      exports.mul = function mul(p1, p2) {
        const coeff = new Uint8Array(p1.length + p2.length - 1);
        for (let i = 0; i < p1.length; i++) {
          for (let j = 0; j < p2.length; j++) {
            coeff[i + j] ^= GF.mul(p1[i], p2[j]);
          }
        }
        return coeff;
      };
      exports.mod = function mod(divident, divisor) {
        let result = new Uint8Array(divident);
        while (result.length - divisor.length >= 0) {
          const coeff = result[0];
          for (let i = 0; i < divisor.length; i++) {
            result[i] ^= GF.mul(divisor[i], coeff);
          }
          let offset = 0;
          while (offset < result.length && result[offset] === 0) offset++;
          result = result.slice(offset);
        }
        return result;
      };
      exports.generateECPolynomial = function generateECPolynomial(degree) {
        let poly = new Uint8Array([1]);
        for (let i = 0; i < degree; i++) {
          poly = exports.mul(poly, new Uint8Array([1, GF.exp(i)]));
        }
        return poly;
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/reed-solomon-encoder.js
  var require_reed_solomon_encoder = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/reed-solomon-encoder.js"(exports, module) {
      var Polynomial = require_polynomial();
      function ReedSolomonEncoder(degree) {
        this.genPoly = void 0;
        this.degree = degree;
        if (this.degree) this.initialize(this.degree);
      }
      ReedSolomonEncoder.prototype.initialize = function initialize(degree) {
        this.degree = degree;
        this.genPoly = Polynomial.generateECPolynomial(this.degree);
      };
      ReedSolomonEncoder.prototype.encode = function encode(data) {
        if (!this.genPoly) {
          throw new Error("Encoder not initialized");
        }
        const paddedData = new Uint8Array(data.length + this.degree);
        paddedData.set(data);
        const remainder = Polynomial.mod(paddedData, this.genPoly);
        const start = this.degree - remainder.length;
        if (start > 0) {
          const buff = new Uint8Array(this.degree);
          buff.set(remainder, start);
          return buff;
        }
        return remainder;
      };
      module.exports = ReedSolomonEncoder;
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/version-check.js
  var require_version_check = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/version-check.js"(exports) {
      exports.isValid = function isValid(version) {
        return !isNaN(version) && version >= 1 && version <= 40;
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/regex.js
  var require_regex = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/regex.js"(exports) {
      var numeric = "[0-9]+";
      var alphanumeric = "[A-Z $%*+\\-./:]+";
      var kanji = "(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";
      kanji = kanji.replace(/u/g, "\\u");
      var byte = "(?:(?![A-Z0-9 $%*+\\-./:]|" + kanji + ")(?:.|[\r\n]))+";
      exports.KANJI = new RegExp(kanji, "g");
      exports.BYTE_KANJI = new RegExp("[^A-Z0-9 $%*+\\-./:]+", "g");
      exports.BYTE = new RegExp(byte, "g");
      exports.NUMERIC = new RegExp(numeric, "g");
      exports.ALPHANUMERIC = new RegExp(alphanumeric, "g");
      var TEST_KANJI = new RegExp("^" + kanji + "$");
      var TEST_NUMERIC = new RegExp("^" + numeric + "$");
      var TEST_ALPHANUMERIC = new RegExp("^[A-Z0-9 $%*+\\-./:]+$");
      exports.testKanji = function testKanji(str) {
        return TEST_KANJI.test(str);
      };
      exports.testNumeric = function testNumeric(str) {
        return TEST_NUMERIC.test(str);
      };
      exports.testAlphanumeric = function testAlphanumeric(str) {
        return TEST_ALPHANUMERIC.test(str);
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/mode.js
  var require_mode = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/mode.js"(exports) {
      var VersionCheck = require_version_check();
      var Regex = require_regex();
      exports.NUMERIC = {
        id: "Numeric",
        bit: 1 << 0,
        ccBits: [10, 12, 14]
      };
      exports.ALPHANUMERIC = {
        id: "Alphanumeric",
        bit: 1 << 1,
        ccBits: [9, 11, 13]
      };
      exports.BYTE = {
        id: "Byte",
        bit: 1 << 2,
        ccBits: [8, 16, 16]
      };
      exports.KANJI = {
        id: "Kanji",
        bit: 1 << 3,
        ccBits: [8, 10, 12]
      };
      exports.MIXED = {
        bit: -1
      };
      exports.getCharCountIndicator = function getCharCountIndicator(mode, version) {
        if (!mode.ccBits) throw new Error("Invalid mode: " + mode);
        if (!VersionCheck.isValid(version)) {
          throw new Error("Invalid version: " + version);
        }
        if (version >= 1 && version < 10) return mode.ccBits[0];
        else if (version < 27) return mode.ccBits[1];
        return mode.ccBits[2];
      };
      exports.getBestModeForData = function getBestModeForData(dataStr) {
        if (Regex.testNumeric(dataStr)) return exports.NUMERIC;
        else if (Regex.testAlphanumeric(dataStr)) return exports.ALPHANUMERIC;
        else if (Regex.testKanji(dataStr)) return exports.KANJI;
        else return exports.BYTE;
      };
      exports.toString = function toString(mode) {
        if (mode && mode.id) return mode.id;
        throw new Error("Invalid mode");
      };
      exports.isValid = function isValid(mode) {
        return mode && mode.bit && mode.ccBits;
      };
      function fromString(string) {
        if (typeof string !== "string") {
          throw new Error("Param is not a string");
        }
        const lcStr = string.toLowerCase();
        switch (lcStr) {
          case "numeric":
            return exports.NUMERIC;
          case "alphanumeric":
            return exports.ALPHANUMERIC;
          case "kanji":
            return exports.KANJI;
          case "byte":
            return exports.BYTE;
          default:
            throw new Error("Unknown mode: " + string);
        }
      }
      exports.from = function from(value, defaultValue) {
        if (exports.isValid(value)) {
          return value;
        }
        try {
          return fromString(value);
        } catch (e) {
          return defaultValue;
        }
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/version.js
  var require_version = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/version.js"(exports) {
      var Utils = require_utils();
      var ECCode = require_error_correction_code();
      var ECLevel = require_error_correction_level();
      var Mode = require_mode();
      var VersionCheck = require_version_check();
      var G18 = 1 << 12 | 1 << 11 | 1 << 10 | 1 << 9 | 1 << 8 | 1 << 5 | 1 << 2 | 1 << 0;
      var G18_BCH = Utils.getBCHDigit(G18);
      function getBestVersionForDataLength(mode, length, errorCorrectionLevel) {
        for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {
          if (length <= exports.getCapacity(currentVersion, errorCorrectionLevel, mode)) {
            return currentVersion;
          }
        }
        return void 0;
      }
      function getReservedBitsCount(mode, version) {
        return Mode.getCharCountIndicator(mode, version) + 4;
      }
      function getTotalBitsFromDataArray(segments, version) {
        let totalBits = 0;
        segments.forEach(function(data) {
          const reservedBits = getReservedBitsCount(data.mode, version);
          totalBits += reservedBits + data.getBitsLength();
        });
        return totalBits;
      }
      function getBestVersionForMixedData(segments, errorCorrectionLevel) {
        for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {
          const length = getTotalBitsFromDataArray(segments, currentVersion);
          if (length <= exports.getCapacity(currentVersion, errorCorrectionLevel, Mode.MIXED)) {
            return currentVersion;
          }
        }
        return void 0;
      }
      exports.from = function from(value, defaultValue) {
        if (VersionCheck.isValid(value)) {
          return parseInt(value, 10);
        }
        return defaultValue;
      };
      exports.getCapacity = function getCapacity(version, errorCorrectionLevel, mode) {
        if (!VersionCheck.isValid(version)) {
          throw new Error("Invalid QR Code version");
        }
        if (typeof mode === "undefined") mode = Mode.BYTE;
        const totalCodewords = Utils.getSymbolTotalCodewords(version);
        const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel);
        const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8;
        if (mode === Mode.MIXED) return dataTotalCodewordsBits;
        const usableBits = dataTotalCodewordsBits - getReservedBitsCount(mode, version);
        switch (mode) {
          case Mode.NUMERIC:
            return Math.floor(usableBits / 10 * 3);
          case Mode.ALPHANUMERIC:
            return Math.floor(usableBits / 11 * 2);
          case Mode.KANJI:
            return Math.floor(usableBits / 13);
          case Mode.BYTE:
          default:
            return Math.floor(usableBits / 8);
        }
      };
      exports.getBestVersionForData = function getBestVersionForData(data, errorCorrectionLevel) {
        let seg;
        const ecl = ECLevel.from(errorCorrectionLevel, ECLevel.M);
        if (Array.isArray(data)) {
          if (data.length > 1) {
            return getBestVersionForMixedData(data, ecl);
          }
          if (data.length === 0) {
            return 1;
          }
          seg = data[0];
        } else {
          seg = data;
        }
        return getBestVersionForDataLength(seg.mode, seg.getLength(), ecl);
      };
      exports.getEncodedBits = function getEncodedBits(version) {
        if (!VersionCheck.isValid(version) || version < 7) {
          throw new Error("Invalid QR Code version");
        }
        let d = version << 12;
        while (Utils.getBCHDigit(d) - G18_BCH >= 0) {
          d ^= G18 << Utils.getBCHDigit(d) - G18_BCH;
        }
        return version << 12 | d;
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/format-info.js
  var require_format_info = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/format-info.js"(exports) {
      var Utils = require_utils();
      var G15 = 1 << 10 | 1 << 8 | 1 << 5 | 1 << 4 | 1 << 2 | 1 << 1 | 1 << 0;
      var G15_MASK = 1 << 14 | 1 << 12 | 1 << 10 | 1 << 4 | 1 << 1;
      var G15_BCH = Utils.getBCHDigit(G15);
      exports.getEncodedBits = function getEncodedBits(errorCorrectionLevel, mask) {
        const data = errorCorrectionLevel.bit << 3 | mask;
        let d = data << 10;
        while (Utils.getBCHDigit(d) - G15_BCH >= 0) {
          d ^= G15 << Utils.getBCHDigit(d) - G15_BCH;
        }
        return (data << 10 | d) ^ G15_MASK;
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/numeric-data.js
  var require_numeric_data = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/numeric-data.js"(exports, module) {
      var Mode = require_mode();
      function NumericData(data) {
        this.mode = Mode.NUMERIC;
        this.data = data.toString();
      }
      NumericData.getBitsLength = function getBitsLength(length) {
        return 10 * Math.floor(length / 3) + (length % 3 ? length % 3 * 3 + 1 : 0);
      };
      NumericData.prototype.getLength = function getLength() {
        return this.data.length;
      };
      NumericData.prototype.getBitsLength = function getBitsLength() {
        return NumericData.getBitsLength(this.data.length);
      };
      NumericData.prototype.write = function write(bitBuffer) {
        let i, group, value;
        for (i = 0; i + 3 <= this.data.length; i += 3) {
          group = this.data.substr(i, 3);
          value = parseInt(group, 10);
          bitBuffer.put(value, 10);
        }
        const remainingNum = this.data.length - i;
        if (remainingNum > 0) {
          group = this.data.substr(i);
          value = parseInt(group, 10);
          bitBuffer.put(value, remainingNum * 3 + 1);
        }
      };
      module.exports = NumericData;
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/alphanumeric-data.js
  var require_alphanumeric_data = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/alphanumeric-data.js"(exports, module) {
      var Mode = require_mode();
      var ALPHA_NUM_CHARS = [
        "0",
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "A",
        "B",
        "C",
        "D",
        "E",
        "F",
        "G",
        "H",
        "I",
        "J",
        "K",
        "L",
        "M",
        "N",
        "O",
        "P",
        "Q",
        "R",
        "S",
        "T",
        "U",
        "V",
        "W",
        "X",
        "Y",
        "Z",
        " ",
        "$",
        "%",
        "*",
        "+",
        "-",
        ".",
        "/",
        ":"
      ];
      function AlphanumericData(data) {
        this.mode = Mode.ALPHANUMERIC;
        this.data = data;
      }
      AlphanumericData.getBitsLength = function getBitsLength(length) {
        return 11 * Math.floor(length / 2) + 6 * (length % 2);
      };
      AlphanumericData.prototype.getLength = function getLength() {
        return this.data.length;
      };
      AlphanumericData.prototype.getBitsLength = function getBitsLength() {
        return AlphanumericData.getBitsLength(this.data.length);
      };
      AlphanumericData.prototype.write = function write(bitBuffer) {
        let i;
        for (i = 0; i + 2 <= this.data.length; i += 2) {
          let value = ALPHA_NUM_CHARS.indexOf(this.data[i]) * 45;
          value += ALPHA_NUM_CHARS.indexOf(this.data[i + 1]);
          bitBuffer.put(value, 11);
        }
        if (this.data.length % 2) {
          bitBuffer.put(ALPHA_NUM_CHARS.indexOf(this.data[i]), 6);
        }
      };
      module.exports = AlphanumericData;
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/byte-data.js
  var require_byte_data = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/byte-data.js"(exports, module) {
      var Mode = require_mode();
      function ByteData(data) {
        this.mode = Mode.BYTE;
        if (typeof data === "string") {
          this.data = new TextEncoder().encode(data);
        } else {
          this.data = new Uint8Array(data);
        }
      }
      ByteData.getBitsLength = function getBitsLength(length) {
        return length * 8;
      };
      ByteData.prototype.getLength = function getLength() {
        return this.data.length;
      };
      ByteData.prototype.getBitsLength = function getBitsLength() {
        return ByteData.getBitsLength(this.data.length);
      };
      ByteData.prototype.write = function(bitBuffer) {
        for (let i = 0, l = this.data.length; i < l; i++) {
          bitBuffer.put(this.data[i], 8);
        }
      };
      module.exports = ByteData;
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/kanji-data.js
  var require_kanji_data = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/kanji-data.js"(exports, module) {
      var Mode = require_mode();
      var Utils = require_utils();
      function KanjiData(data) {
        this.mode = Mode.KANJI;
        this.data = data;
      }
      KanjiData.getBitsLength = function getBitsLength(length) {
        return length * 13;
      };
      KanjiData.prototype.getLength = function getLength() {
        return this.data.length;
      };
      KanjiData.prototype.getBitsLength = function getBitsLength() {
        return KanjiData.getBitsLength(this.data.length);
      };
      KanjiData.prototype.write = function(bitBuffer) {
        let i;
        for (i = 0; i < this.data.length; i++) {
          let value = Utils.toSJIS(this.data[i]);
          if (value >= 33088 && value <= 40956) {
            value -= 33088;
          } else if (value >= 57408 && value <= 60351) {
            value -= 49472;
          } else {
            throw new Error(
              "Invalid SJIS character: " + this.data[i] + "\nMake sure your charset is UTF-8"
            );
          }
          value = (value >>> 8 & 255) * 192 + (value & 255);
          bitBuffer.put(value, 13);
        }
      };
      module.exports = KanjiData;
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/node_modules/dijkstrajs/dijkstra.js
  var require_dijkstra = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/node_modules/dijkstrajs/dijkstra.js"(exports, module) {
      "use strict";
      var dijkstra = {
        single_source_shortest_paths: function(graph, s, d) {
          var predecessors = {};
          var costs = {};
          costs[s] = 0;
          var open = dijkstra.PriorityQueue.make();
          open.push(s, 0);
          var closest, u, v, cost_of_s_to_u, adjacent_nodes, cost_of_e, cost_of_s_to_u_plus_cost_of_e, cost_of_s_to_v, first_visit;
          while (!open.empty()) {
            closest = open.pop();
            u = closest.value;
            cost_of_s_to_u = closest.cost;
            adjacent_nodes = graph[u] || {};
            for (v in adjacent_nodes) {
              if (adjacent_nodes.hasOwnProperty(v)) {
                cost_of_e = adjacent_nodes[v];
                cost_of_s_to_u_plus_cost_of_e = cost_of_s_to_u + cost_of_e;
                cost_of_s_to_v = costs[v];
                first_visit = typeof costs[v] === "undefined";
                if (first_visit || cost_of_s_to_v > cost_of_s_to_u_plus_cost_of_e) {
                  costs[v] = cost_of_s_to_u_plus_cost_of_e;
                  open.push(v, cost_of_s_to_u_plus_cost_of_e);
                  predecessors[v] = u;
                }
              }
            }
          }
          if (typeof d !== "undefined" && typeof costs[d] === "undefined") {
            var msg = ["Could not find a path from ", s, " to ", d, "."].join("");
            throw new Error(msg);
          }
          return predecessors;
        },
        extract_shortest_path_from_predecessor_list: function(predecessors, d) {
          var nodes = [];
          var u = d;
          var predecessor;
          while (u) {
            nodes.push(u);
            predecessor = predecessors[u];
            u = predecessors[u];
          }
          nodes.reverse();
          return nodes;
        },
        find_path: function(graph, s, d) {
          var predecessors = dijkstra.single_source_shortest_paths(graph, s, d);
          return dijkstra.extract_shortest_path_from_predecessor_list(
            predecessors,
            d
          );
        },
        /**
         * A very naive priority queue implementation.
         */
        PriorityQueue: {
          make: function(opts) {
            var T = dijkstra.PriorityQueue, t = {}, key;
            opts = opts || {};
            for (key in T) {
              if (T.hasOwnProperty(key)) {
                t[key] = T[key];
              }
            }
            t.queue = [];
            t.sorter = opts.sorter || T.default_sorter;
            return t;
          },
          default_sorter: function(a, b) {
            return a.cost - b.cost;
          },
          /**
           * Add a new item to the queue and ensure the highest priority element
           * is at the front of the queue.
           */
          push: function(value, cost) {
            var item = { value, cost };
            this.queue.push(item);
            this.queue.sort(this.sorter);
          },
          /**
           * Return the highest priority element in the queue.
           */
          pop: function() {
            return this.queue.shift();
          },
          empty: function() {
            return this.queue.length === 0;
          }
        }
      };
      if (typeof module !== "undefined") {
        module.exports = dijkstra;
      }
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/segments.js
  var require_segments = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/segments.js"(exports) {
      var Mode = require_mode();
      var NumericData = require_numeric_data();
      var AlphanumericData = require_alphanumeric_data();
      var ByteData = require_byte_data();
      var KanjiData = require_kanji_data();
      var Regex = require_regex();
      var Utils = require_utils();
      var dijkstra = require_dijkstra();
      function getStringByteLength(str) {
        return unescape(encodeURIComponent(str)).length;
      }
      function getSegments(regex, mode, str) {
        const segments = [];
        let result;
        while ((result = regex.exec(str)) !== null) {
          segments.push({
            data: result[0],
            index: result.index,
            mode,
            length: result[0].length
          });
        }
        return segments;
      }
      function getSegmentsFromString(dataStr) {
        const numSegs = getSegments(Regex.NUMERIC, Mode.NUMERIC, dataStr);
        const alphaNumSegs = getSegments(Regex.ALPHANUMERIC, Mode.ALPHANUMERIC, dataStr);
        let byteSegs;
        let kanjiSegs;
        if (Utils.isKanjiModeEnabled()) {
          byteSegs = getSegments(Regex.BYTE, Mode.BYTE, dataStr);
          kanjiSegs = getSegments(Regex.KANJI, Mode.KANJI, dataStr);
        } else {
          byteSegs = getSegments(Regex.BYTE_KANJI, Mode.BYTE, dataStr);
          kanjiSegs = [];
        }
        const segs = numSegs.concat(alphaNumSegs, byteSegs, kanjiSegs);
        return segs.sort(function(s1, s2) {
          return s1.index - s2.index;
        }).map(function(obj) {
          return {
            data: obj.data,
            mode: obj.mode,
            length: obj.length
          };
        });
      }
      function getSegmentBitsLength(length, mode) {
        switch (mode) {
          case Mode.NUMERIC:
            return NumericData.getBitsLength(length);
          case Mode.ALPHANUMERIC:
            return AlphanumericData.getBitsLength(length);
          case Mode.KANJI:
            return KanjiData.getBitsLength(length);
          case Mode.BYTE:
            return ByteData.getBitsLength(length);
        }
      }
      function mergeSegments(segs) {
        return segs.reduce(function(acc, curr) {
          const prevSeg = acc.length - 1 >= 0 ? acc[acc.length - 1] : null;
          if (prevSeg && prevSeg.mode === curr.mode) {
            acc[acc.length - 1].data += curr.data;
            return acc;
          }
          acc.push(curr);
          return acc;
        }, []);
      }
      function buildNodes(segs) {
        const nodes = [];
        for (let i = 0; i < segs.length; i++) {
          const seg = segs[i];
          switch (seg.mode) {
            case Mode.NUMERIC:
              nodes.push([
                seg,
                { data: seg.data, mode: Mode.ALPHANUMERIC, length: seg.length },
                { data: seg.data, mode: Mode.BYTE, length: seg.length }
              ]);
              break;
            case Mode.ALPHANUMERIC:
              nodes.push([
                seg,
                { data: seg.data, mode: Mode.BYTE, length: seg.length }
              ]);
              break;
            case Mode.KANJI:
              nodes.push([
                seg,
                { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }
              ]);
              break;
            case Mode.BYTE:
              nodes.push([
                { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }
              ]);
          }
        }
        return nodes;
      }
      function buildGraph(nodes, version) {
        const table = {};
        const graph = { start: {} };
        let prevNodeIds = ["start"];
        for (let i = 0; i < nodes.length; i++) {
          const nodeGroup = nodes[i];
          const currentNodeIds = [];
          for (let j = 0; j < nodeGroup.length; j++) {
            const node = nodeGroup[j];
            const key = "" + i + j;
            currentNodeIds.push(key);
            table[key] = { node, lastCount: 0 };
            graph[key] = {};
            for (let n = 0; n < prevNodeIds.length; n++) {
              const prevNodeId = prevNodeIds[n];
              if (table[prevNodeId] && table[prevNodeId].node.mode === node.mode) {
                graph[prevNodeId][key] = getSegmentBitsLength(table[prevNodeId].lastCount + node.length, node.mode) - getSegmentBitsLength(table[prevNodeId].lastCount, node.mode);
                table[prevNodeId].lastCount += node.length;
              } else {
                if (table[prevNodeId]) table[prevNodeId].lastCount = node.length;
                graph[prevNodeId][key] = getSegmentBitsLength(node.length, node.mode) + 4 + Mode.getCharCountIndicator(node.mode, version);
              }
            }
          }
          prevNodeIds = currentNodeIds;
        }
        for (let n = 0; n < prevNodeIds.length; n++) {
          graph[prevNodeIds[n]].end = 0;
        }
        return { map: graph, table };
      }
      function buildSingleSegment(data, modesHint) {
        let mode;
        const bestMode = Mode.getBestModeForData(data);
        mode = Mode.from(modesHint, bestMode);
        if (mode !== Mode.BYTE && mode.bit < bestMode.bit) {
          throw new Error('"' + data + '" cannot be encoded with mode ' + Mode.toString(mode) + ".\n Suggested mode is: " + Mode.toString(bestMode));
        }
        if (mode === Mode.KANJI && !Utils.isKanjiModeEnabled()) {
          mode = Mode.BYTE;
        }
        switch (mode) {
          case Mode.NUMERIC:
            return new NumericData(data);
          case Mode.ALPHANUMERIC:
            return new AlphanumericData(data);
          case Mode.KANJI:
            return new KanjiData(data);
          case Mode.BYTE:
            return new ByteData(data);
        }
      }
      exports.fromArray = function fromArray(array) {
        return array.reduce(function(acc, seg) {
          if (typeof seg === "string") {
            acc.push(buildSingleSegment(seg, null));
          } else if (seg.data) {
            acc.push(buildSingleSegment(seg.data, seg.mode));
          }
          return acc;
        }, []);
      };
      exports.fromString = function fromString(data, version) {
        const segs = getSegmentsFromString(data, Utils.isKanjiModeEnabled());
        const nodes = buildNodes(segs);
        const graph = buildGraph(nodes, version);
        const path = dijkstra.find_path(graph.map, "start", "end");
        const optimizedSegs = [];
        for (let i = 1; i < path.length - 1; i++) {
          optimizedSegs.push(graph.table[path[i]].node);
        }
        return exports.fromArray(mergeSegments(optimizedSegs));
      };
      exports.rawSplit = function rawSplit(data) {
        return exports.fromArray(
          getSegmentsFromString(data, Utils.isKanjiModeEnabled())
        );
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/core/qrcode.js
  var require_qrcode = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/core/qrcode.js"(exports) {
      var Utils = require_utils();
      var ECLevel = require_error_correction_level();
      var BitBuffer = require_bit_buffer();
      var BitMatrix = require_bit_matrix();
      var AlignmentPattern = require_alignment_pattern();
      var FinderPattern = require_finder_pattern();
      var MaskPattern = require_mask_pattern();
      var ECCode = require_error_correction_code();
      var ReedSolomonEncoder = require_reed_solomon_encoder();
      var Version = require_version();
      var FormatInfo = require_format_info();
      var Mode = require_mode();
      var Segments = require_segments();
      function setupFinderPattern(matrix, version) {
        const size = matrix.size;
        const pos = FinderPattern.getPositions(version);
        for (let i = 0; i < pos.length; i++) {
          const row = pos[i][0];
          const col = pos[i][1];
          for (let r = -1; r <= 7; r++) {
            if (row + r <= -1 || size <= row + r) continue;
            for (let c = -1; c <= 7; c++) {
              if (col + c <= -1 || size <= col + c) continue;
              if (r >= 0 && r <= 6 && (c === 0 || c === 6) || c >= 0 && c <= 6 && (r === 0 || r === 6) || r >= 2 && r <= 4 && c >= 2 && c <= 4) {
                matrix.set(row + r, col + c, true, true);
              } else {
                matrix.set(row + r, col + c, false, true);
              }
            }
          }
        }
      }
      function setupTimingPattern(matrix) {
        const size = matrix.size;
        for (let r = 8; r < size - 8; r++) {
          const value = r % 2 === 0;
          matrix.set(r, 6, value, true);
          matrix.set(6, r, value, true);
        }
      }
      function setupAlignmentPattern(matrix, version) {
        const pos = AlignmentPattern.getPositions(version);
        for (let i = 0; i < pos.length; i++) {
          const row = pos[i][0];
          const col = pos[i][1];
          for (let r = -2; r <= 2; r++) {
            for (let c = -2; c <= 2; c++) {
              if (r === -2 || r === 2 || c === -2 || c === 2 || r === 0 && c === 0) {
                matrix.set(row + r, col + c, true, true);
              } else {
                matrix.set(row + r, col + c, false, true);
              }
            }
          }
        }
      }
      function setupVersionInfo(matrix, version) {
        const size = matrix.size;
        const bits = Version.getEncodedBits(version);
        let row, col, mod;
        for (let i = 0; i < 18; i++) {
          row = Math.floor(i / 3);
          col = i % 3 + size - 8 - 3;
          mod = (bits >> i & 1) === 1;
          matrix.set(row, col, mod, true);
          matrix.set(col, row, mod, true);
        }
      }
      function setupFormatInfo(matrix, errorCorrectionLevel, maskPattern) {
        const size = matrix.size;
        const bits = FormatInfo.getEncodedBits(errorCorrectionLevel, maskPattern);
        let i, mod;
        for (i = 0; i < 15; i++) {
          mod = (bits >> i & 1) === 1;
          if (i < 6) {
            matrix.set(i, 8, mod, true);
          } else if (i < 8) {
            matrix.set(i + 1, 8, mod, true);
          } else {
            matrix.set(size - 15 + i, 8, mod, true);
          }
          if (i < 8) {
            matrix.set(8, size - i - 1, mod, true);
          } else if (i < 9) {
            matrix.set(8, 15 - i - 1 + 1, mod, true);
          } else {
            matrix.set(8, 15 - i - 1, mod, true);
          }
        }
        matrix.set(size - 8, 8, 1, true);
      }
      function setupData(matrix, data) {
        const size = matrix.size;
        let inc = -1;
        let row = size - 1;
        let bitIndex = 7;
        let byteIndex = 0;
        for (let col = size - 1; col > 0; col -= 2) {
          if (col === 6) col--;
          while (true) {
            for (let c = 0; c < 2; c++) {
              if (!matrix.isReserved(row, col - c)) {
                let dark = false;
                if (byteIndex < data.length) {
                  dark = (data[byteIndex] >>> bitIndex & 1) === 1;
                }
                matrix.set(row, col - c, dark);
                bitIndex--;
                if (bitIndex === -1) {
                  byteIndex++;
                  bitIndex = 7;
                }
              }
            }
            row += inc;
            if (row < 0 || size <= row) {
              row -= inc;
              inc = -inc;
              break;
            }
          }
        }
      }
      function createData(version, errorCorrectionLevel, segments) {
        const buffer = new BitBuffer();
        segments.forEach(function(data) {
          buffer.put(data.mode.bit, 4);
          buffer.put(data.getLength(), Mode.getCharCountIndicator(data.mode, version));
          data.write(buffer);
        });
        const totalCodewords = Utils.getSymbolTotalCodewords(version);
        const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel);
        const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8;
        if (buffer.getLengthInBits() + 4 <= dataTotalCodewordsBits) {
          buffer.put(0, 4);
        }
        while (buffer.getLengthInBits() % 8 !== 0) {
          buffer.putBit(0);
        }
        const remainingByte = (dataTotalCodewordsBits - buffer.getLengthInBits()) / 8;
        for (let i = 0; i < remainingByte; i++) {
          buffer.put(i % 2 ? 17 : 236, 8);
        }
        return createCodewords(buffer, version, errorCorrectionLevel);
      }
      function createCodewords(bitBuffer, version, errorCorrectionLevel) {
        const totalCodewords = Utils.getSymbolTotalCodewords(version);
        const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel);
        const dataTotalCodewords = totalCodewords - ecTotalCodewords;
        const ecTotalBlocks = ECCode.getBlocksCount(version, errorCorrectionLevel);
        const blocksInGroup2 = totalCodewords % ecTotalBlocks;
        const blocksInGroup1 = ecTotalBlocks - blocksInGroup2;
        const totalCodewordsInGroup1 = Math.floor(totalCodewords / ecTotalBlocks);
        const dataCodewordsInGroup1 = Math.floor(dataTotalCodewords / ecTotalBlocks);
        const dataCodewordsInGroup2 = dataCodewordsInGroup1 + 1;
        const ecCount = totalCodewordsInGroup1 - dataCodewordsInGroup1;
        const rs = new ReedSolomonEncoder(ecCount);
        let offset = 0;
        const dcData = new Array(ecTotalBlocks);
        const ecData = new Array(ecTotalBlocks);
        let maxDataSize = 0;
        const buffer = new Uint8Array(bitBuffer.buffer);
        for (let b = 0; b < ecTotalBlocks; b++) {
          const dataSize = b < blocksInGroup1 ? dataCodewordsInGroup1 : dataCodewordsInGroup2;
          dcData[b] = buffer.slice(offset, offset + dataSize);
          ecData[b] = rs.encode(dcData[b]);
          offset += dataSize;
          maxDataSize = Math.max(maxDataSize, dataSize);
        }
        const data = new Uint8Array(totalCodewords);
        let index = 0;
        let i, r;
        for (i = 0; i < maxDataSize; i++) {
          for (r = 0; r < ecTotalBlocks; r++) {
            if (i < dcData[r].length) {
              data[index++] = dcData[r][i];
            }
          }
        }
        for (i = 0; i < ecCount; i++) {
          for (r = 0; r < ecTotalBlocks; r++) {
            data[index++] = ecData[r][i];
          }
        }
        return data;
      }
      function createSymbol(data, version, errorCorrectionLevel, maskPattern) {
        let segments;
        if (Array.isArray(data)) {
          segments = Segments.fromArray(data);
        } else if (typeof data === "string") {
          let estimatedVersion = version;
          if (!estimatedVersion) {
            const rawSegments = Segments.rawSplit(data);
            estimatedVersion = Version.getBestVersionForData(rawSegments, errorCorrectionLevel);
          }
          segments = Segments.fromString(data, estimatedVersion || 40);
        } else {
          throw new Error("Invalid data");
        }
        const bestVersion = Version.getBestVersionForData(segments, errorCorrectionLevel);
        if (!bestVersion) {
          throw new Error("The amount of data is too big to be stored in a QR Code");
        }
        if (!version) {
          version = bestVersion;
        } else if (version < bestVersion) {
          throw new Error(
            "\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: " + bestVersion + ".\n"
          );
        }
        const dataBits = createData(version, errorCorrectionLevel, segments);
        const moduleCount = Utils.getSymbolSize(version);
        const modules = new BitMatrix(moduleCount);
        setupFinderPattern(modules, version);
        setupTimingPattern(modules);
        setupAlignmentPattern(modules, version);
        setupFormatInfo(modules, errorCorrectionLevel, 0);
        if (version >= 7) {
          setupVersionInfo(modules, version);
        }
        setupData(modules, dataBits);
        if (isNaN(maskPattern)) {
          maskPattern = MaskPattern.getBestMask(
            modules,
            setupFormatInfo.bind(null, modules, errorCorrectionLevel)
          );
        }
        MaskPattern.applyMask(maskPattern, modules);
        setupFormatInfo(modules, errorCorrectionLevel, maskPattern);
        return {
          modules,
          version,
          errorCorrectionLevel,
          maskPattern,
          segments
        };
      }
      exports.create = function create(data, options) {
        if (typeof data === "undefined" || data === "") {
          throw new Error("No input text");
        }
        let errorCorrectionLevel = ECLevel.M;
        let version;
        let mask;
        if (typeof options !== "undefined") {
          errorCorrectionLevel = ECLevel.from(options.errorCorrectionLevel, ECLevel.M);
          version = Version.from(options.version);
          mask = MaskPattern.from(options.maskPattern);
          if (options.toSJISFunc) {
            Utils.setToSJISFunction(options.toSJISFunc);
          }
        }
        return createSymbol(data, version, errorCorrectionLevel, mask);
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/renderer/utils.js
  var require_utils2 = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/renderer/utils.js"(exports) {
      function hex2rgba(hex) {
        if (typeof hex === "number") {
          hex = hex.toString();
        }
        if (typeof hex !== "string") {
          throw new Error("Color should be defined as hex string");
        }
        let hexCode = hex.slice().replace("#", "").split("");
        if (hexCode.length < 3 || hexCode.length === 5 || hexCode.length > 8) {
          throw new Error("Invalid hex color: " + hex);
        }
        if (hexCode.length === 3 || hexCode.length === 4) {
          hexCode = Array.prototype.concat.apply([], hexCode.map(function(c) {
            return [c, c];
          }));
        }
        if (hexCode.length === 6) hexCode.push("F", "F");
        const hexValue = parseInt(hexCode.join(""), 16);
        return {
          r: hexValue >> 24 & 255,
          g: hexValue >> 16 & 255,
          b: hexValue >> 8 & 255,
          a: hexValue & 255,
          hex: "#" + hexCode.slice(0, 6).join("")
        };
      }
      exports.getOptions = function getOptions(options) {
        if (!options) options = {};
        if (!options.color) options.color = {};
        const margin = typeof options.margin === "undefined" || options.margin === null || options.margin < 0 ? 4 : options.margin;
        const width = options.width && options.width >= 21 ? options.width : void 0;
        const scale = options.scale || 4;
        return {
          width,
          scale: width ? 4 : scale,
          margin,
          color: {
            dark: hex2rgba(options.color.dark || "#000000ff"),
            light: hex2rgba(options.color.light || "#ffffffff")
          },
          type: options.type,
          rendererOpts: options.rendererOpts || {}
        };
      };
      exports.getScale = function getScale(qrSize, opts) {
        return opts.width && opts.width >= qrSize + opts.margin * 2 ? opts.width / (qrSize + opts.margin * 2) : opts.scale;
      };
      exports.getImageWidth = function getImageWidth(qrSize, opts) {
        const scale = exports.getScale(qrSize, opts);
        return Math.floor((qrSize + opts.margin * 2) * scale);
      };
      exports.qrToImageData = function qrToImageData(imgData, qr, opts) {
        const size = qr.modules.size;
        const data = qr.modules.data;
        const scale = exports.getScale(size, opts);
        const symbolSize = Math.floor((size + opts.margin * 2) * scale);
        const scaledMargin = opts.margin * scale;
        const palette = [opts.color.light, opts.color.dark];
        for (let i = 0; i < symbolSize; i++) {
          for (let j = 0; j < symbolSize; j++) {
            let posDst = (i * symbolSize + j) * 4;
            let pxColor = opts.color.light;
            if (i >= scaledMargin && j >= scaledMargin && i < symbolSize - scaledMargin && j < symbolSize - scaledMargin) {
              const iSrc = Math.floor((i - scaledMargin) / scale);
              const jSrc = Math.floor((j - scaledMargin) / scale);
              pxColor = palette[data[iSrc * size + jSrc] ? 1 : 0];
            }
            imgData[posDst++] = pxColor.r;
            imgData[posDst++] = pxColor.g;
            imgData[posDst++] = pxColor.b;
            imgData[posDst] = pxColor.a;
          }
        }
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/renderer/canvas.js
  var require_canvas = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/renderer/canvas.js"(exports) {
      var Utils = require_utils2();
      function clearCanvas(ctx, canvas, size) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (!canvas.style) canvas.style = {};
        canvas.height = size;
        canvas.width = size;
        canvas.style.height = size + "px";
        canvas.style.width = size + "px";
      }
      function getCanvasElement() {
        try {
          return document.createElement("canvas");
        } catch (e) {
          throw new Error("You need to specify a canvas element");
        }
      }
      exports.render = function render(qrData, canvas, options) {
        let opts = options;
        let canvasEl = canvas;
        if (typeof opts === "undefined" && (!canvas || !canvas.getContext)) {
          opts = canvas;
          canvas = void 0;
        }
        if (!canvas) {
          canvasEl = getCanvasElement();
        }
        opts = Utils.getOptions(opts);
        const size = Utils.getImageWidth(qrData.modules.size, opts);
        const ctx = canvasEl.getContext("2d");
        const image = ctx.createImageData(size, size);
        Utils.qrToImageData(image.data, qrData, opts);
        clearCanvas(ctx, canvasEl, size);
        ctx.putImageData(image, 0, 0);
        return canvasEl;
      };
      exports.renderToDataURL = function renderToDataURL(qrData, canvas, options) {
        let opts = options;
        if (typeof opts === "undefined" && (!canvas || !canvas.getContext)) {
          opts = canvas;
          canvas = void 0;
        }
        if (!opts) opts = {};
        const canvasEl = exports.render(qrData, canvas, opts);
        const type = opts.type || "image/png";
        const rendererOpts = opts.rendererOpts || {};
        return canvasEl.toDataURL(type, rendererOpts.quality);
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/renderer/svg-tag.js
  var require_svg_tag = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/renderer/svg-tag.js"(exports) {
      var Utils = require_utils2();
      function getColorAttrib(color, attrib) {
        const alpha = color.a / 255;
        const str = attrib + '="' + color.hex + '"';
        return alpha < 1 ? str + " " + attrib + '-opacity="' + alpha.toFixed(2).slice(1) + '"' : str;
      }
      function svgCmd(cmd, x, y) {
        let str = cmd + x;
        if (typeof y !== "undefined") str += " " + y;
        return str;
      }
      function qrToPath(data, size, margin) {
        let path = "";
        let moveBy = 0;
        let newRow = false;
        let lineLength = 0;
        for (let i = 0; i < data.length; i++) {
          const col = Math.floor(i % size);
          const row = Math.floor(i / size);
          if (!col && !newRow) newRow = true;
          if (data[i]) {
            lineLength++;
            if (!(i > 0 && col > 0 && data[i - 1])) {
              path += newRow ? svgCmd("M", col + margin, 0.5 + row + margin) : svgCmd("m", moveBy, 0);
              moveBy = 0;
              newRow = false;
            }
            if (!(col + 1 < size && data[i + 1])) {
              path += svgCmd("h", lineLength);
              lineLength = 0;
            }
          } else {
            moveBy++;
          }
        }
        return path;
      }
      exports.render = function render(qrData, options, cb) {
        const opts = Utils.getOptions(options);
        const size = qrData.modules.size;
        const data = qrData.modules.data;
        const qrcodesize = size + opts.margin * 2;
        const bg = !opts.color.light.a ? "" : "<path " + getColorAttrib(opts.color.light, "fill") + ' d="M0 0h' + qrcodesize + "v" + qrcodesize + 'H0z"/>';
        const path = "<path " + getColorAttrib(opts.color.dark, "stroke") + ' d="' + qrToPath(data, size, opts.margin) + '"/>';
        const viewBox = 'viewBox="0 0 ' + qrcodesize + " " + qrcodesize + '"';
        const width = !opts.width ? "" : 'width="' + opts.width + '" height="' + opts.width + '" ';
        const svgTag = '<svg xmlns="http://www.w3.org/2000/svg" ' + width + viewBox + ' shape-rendering="crispEdges">' + bg + path + "</svg>\n";
        if (typeof cb === "function") {
          cb(null, svgTag);
        }
        return svgTag;
      };
    }
  });

  // home/claude/.npm-global/lib/node_modules/qrcode/lib/browser.js
  var require_browser = __commonJS({
    "home/claude/.npm-global/lib/node_modules/qrcode/lib/browser.js"(exports) {
      var canPromise = require_can_promise();
      var QRCode2 = require_qrcode();
      var CanvasRenderer = require_canvas();
      var SvgRenderer = require_svg_tag();
      function renderCanvas(renderFunc, canvas, text, opts, cb) {
        const args = [].slice.call(arguments, 1);
        const argsNum = args.length;
        const isLastArgCb = typeof args[argsNum - 1] === "function";
        if (!isLastArgCb && !canPromise()) {
          throw new Error("Callback required as last argument");
        }
        if (isLastArgCb) {
          if (argsNum < 2) {
            throw new Error("Too few arguments provided");
          }
          if (argsNum === 2) {
            cb = text;
            text = canvas;
            canvas = opts = void 0;
          } else if (argsNum === 3) {
            if (canvas.getContext && typeof cb === "undefined") {
              cb = opts;
              opts = void 0;
            } else {
              cb = opts;
              opts = text;
              text = canvas;
              canvas = void 0;
            }
          }
        } else {
          if (argsNum < 1) {
            throw new Error("Too few arguments provided");
          }
          if (argsNum === 1) {
            text = canvas;
            canvas = opts = void 0;
          } else if (argsNum === 2 && !canvas.getContext) {
            opts = text;
            text = canvas;
            canvas = void 0;
          }
          return new Promise(function(resolve, reject) {
            try {
              const data = QRCode2.create(text, opts);
              resolve(renderFunc(data, canvas, opts));
            } catch (e) {
              reject(e);
            }
          });
        }
        try {
          const data = QRCode2.create(text, opts);
          cb(null, renderFunc(data, canvas, opts));
        } catch (e) {
          cb(e);
        }
      }
      exports.create = QRCode2.create;
      exports.toCanvas = renderCanvas.bind(null, CanvasRenderer.render);
      exports.toDataURL = renderCanvas.bind(null, CanvasRenderer.renderToDataURL);
      exports.toString = renderCanvas.bind(null, function(data, _, opts) {
        return SvgRenderer.render(data, opts);
      });
    }
  });

  // tmp/qr_entry.js
  var QRCode = require_browser();
  window.QRMatrix = function(url, ecLevel) {
    const q = QRCode.create(url, { errorCorrectionLevel: ecLevel || "H" });
    const size = q.modules.size;
    const data = q.modules.data;
    const matrix = [];
    for (let r = 0; r < size; r++) {
      const row = [];
      for (let c = 0; c < size; c++) row.push(data[r * size + c] ? 1 : 0);
      matrix.push(row);
    }
    return { matrix, size, version: q.version };
  };
})();

</script>

<script>
/* â”€â”€ QR Canvas Renderer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Renders matrix to canvas with rounded modules, exactly
   matching the reference: clean, pure black/white.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* â”€â”€ QRIBâ„¢ TRADEMARK QR STYLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Â© QRIB / Angel YH. All rights reserved.
   Every dark module is drawn identically: same circle, same size,
   same navy. Finder patterns are not visually distinguished â€”
   they dissolve into the uniform dot field. The scanner reads the
   underlying matrix; the eye sees one continuous pattern.
   The single red dot (alignment centre, lower-right) is the only
   break. That is the trademark.
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

function drawQR(canvas, matrix, size, canvasPx) {
  const px    = canvasPx || 200;
  const quiet = 3;
  const total = size + quiet * 2;
  const mod   = px / total;
  // Circle radius slightly under half-module so dots don't fully merge
  // but the field reads as dense and uniform â€” matching the upload reference
  const cr    = mod * 0.36;  // Consistent gap â€” finders blend with data field

  canvas.width  = px;
  canvas.height = px;
  canvas.style.width  = px + 'px';
  canvas.style.height = px + 'px';

  const ctx = canvas.getContext('2d');
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';

  // â”€â”€ Background: warm off-white with very subtle zone tints â”€â”€â”€â”€
  ctx.fillStyle = '#F9F7F3';
  ctx.fillRect(0, 0, px, px);

  // Gentle zone washes â€” same tinting from original, kept very faint
  // so the background has life without competing with the dots
  for (let r = 0; r < size; r++) {
    for (let c = 0; c < size; c++) {
      const nr = r / size, nc = c / size;
      let tint;
      if      (nr < 0.45 && nc < 0.45) tint = 'rgba(210,140,120,0.07)';
      else if (nr > 0.55 && nc > 0.55) tint = 'rgba(210,140,120,0.07)';
      else if (nr < 0.45 && nc > 0.55) tint = 'rgba(120,140,210,0.06)';
      else if (nr > 0.55 && nc < 0.45) tint = 'rgba(120,140,210,0.06)';
      else                              tint = 'rgba(190,140,8,0.04)';
      ctx.fillStyle = tint;
      ctx.fillRect((quiet + c) * mod, (quiet + r) * mod, mod, mod);
    }
  }

  // â”€â”€ Resolve alignment pattern centre positions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ver = (size - 17) / 4;
  const alignTbl = [null,[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42]];
  const alignPts = [];
  if (alignTbl[ver]) {
    const pos = alignTbl[ver];
    for (let i = 0; i < pos.length; i++)
      for (let j = 0; j < pos.length; j++) {
        // Skip positions that overlap with finder patterns
        if (i === 0 && j === 0) continue;
        if (i === 0 && j === pos.length - 1) continue;
        if (i === pos.length - 1 && j === 0) continue;
        alignPts.push({ r: pos[i], c: pos[j] });
      }
  }
  // The red dot target â€” last alignment point (bottom-right of data field)
  const redPt = alignPts.length > 0 ? alignPts[alignPts.length - 1] : null;

  // â”€â”€ Draw every dark module identically â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // No special cases for finder patterns, timing strips, or alignment.
  // They are ALL just circles. Same colour. Same size.
  // This is what makes the field look uniform.
  const NAVY = '#0019A8';
  const RED  = '#CC1100';

  for (let r = 0; r < size; r++) {
    for (let c = 0; c < size; c++) {
      const val = matrix[r][c];
      if (val !== 1) continue;   // light module â€” draw nothing

      const cx = (quiet + c + 0.5) * mod;
      const cy = (quiet + r + 0.5) * mod;

      // Is this the red dot? (alignment centre only)
      const isRed = redPt && r === redPt.r && c === redPt.c;

      ctx.beginPath();
      ctx.arc(cx, cy, cr, 0, Math.PI * 2);
      ctx.fillStyle = isRed ? RED : NAVY;
      ctx.fill();
    }
  }
}

// makeQR â€” creates canvas, encodes, draws
function makeQR(containerId, text, px) {
  const el = document.getElementById(containerId);
  if (!el) return null;
  el.innerHTML = '';
  try {
    const { matrix, size } = window.QRMatrix(text, 'H');
    const canvas = document.createElement('canvas');
    drawQR(canvas, matrix, size, px || 200);
    el.appendChild(canvas);
    return canvas;
  } catch (e) {
    console.warn('QR error:', e);
    const c2 = document.createElement('canvas');
    c2.width = c2.height = px || 200;
    const ctx = c2.getContext('2d');
    ctx.fillStyle = '#F9F7F3'; ctx.fillRect(0,0,c2.width,c2.height);
    ctx.fillStyle = '#0019A8'; ctx.font = '11px monospace'; ctx.fillText('QR', 10, 20);
    el.appendChild(c2);
    return c2;
  }
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const S = {
  books:       [],
  lastBook:    null,
  filter:      'all',
  payMode:     'paypal',
  orderBook:   null,
  orderPM:     'paypal',
  dupFound:    null,
};

/* â”€â”€ Routing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function go(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(page + '-page').classList.add('active');
  document.querySelectorAll('.nav-mid a').forEach(a => a.classList.remove('active-link'));
  const nl = document.getElementById('nl-' + page);
  if (nl) nl.classList.add('active-link');
  window.scrollTo(0, 0);
  if (page === 'catalogue') renderCat();
}

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toast(msg, dur) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(el._t);
  el._t = setTimeout(() => el.classList.remove('show'), dur || 3200);
}

/* â”€â”€ QAN Code engine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function skipWords(words) {
  const SKIP = new Set(['THE','A','AN','OF','AND','IN','ON','TO','FOR','BY','WITH','AT']);
  return words.filter(w => !SKIP.has(w));
}
function authorToken(name) {
  const p = name.trim().toUpperCase().replace(/[^A-Z ]/g,'').split(/\s+/);
  if (p.length === 1) return (p[0] + 'XXXX').slice(0,4);
  return (p[0].slice(0,2) + p[p.length-1].slice(0,2)).padEnd(4,'X').slice(0,4);
}
function titleToken(title) {
  const words = skipWords(title.toUpperCase().replace(/[^A-Z ]/g,'').split(/\s+/));
  let t = '';
  for (const w of words) { if (t.length < 4) t += w.slice(0, Math.min(2, 4 - t.length)); }
  return (t + 'XXXX').slice(0,4);
}
function checkChar(code) {
  const A = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  let sum = 0;
  code.replace(/-/g,'').toUpperCase().split('').forEach((c,i) => { sum += (A.indexOf(c)+1) * (i+1); });
  return A[sum % 36];
}
function buildQCode(name, country, year, title, edition) {
  const yr  = String(year).slice(-2);
  const atk = authorToken(name);
  const ttk = titleToken(title);
  const ed  = String(parseInt(edition)).padStart(2,'0');
  const seq = String(S.books.length + 1).padStart(4,'0');
  const base = `Q-${country}-${yr}-${atk}-${ttk}-${ed}-${seq}`;
  return `${base}-${checkChar(base)}`;
}

/* â”€â”€ Cover upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function onCover(input) {
  const file = input.files[0]; if (!file) return;
  const r = new FileReader();
  r.onload = e => {
    document.getElementById('cprev-img').src = e.target.result;
    document.getElementById('cprev').style.display = 'block';
    document.getElementById('cdrop-content').style.display = 'none';
  };
  r.readAsDataURL(file);
}

/* â”€â”€ Pay tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setPay(name, el) {
  S.payMode = name;
  document.querySelectorAll('.ptab').forEach(t => t.classList.remove('on'));
  document.querySelectorAll('.pf').forEach(f => f.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('pf-' + name).classList.add('on');
}

/* â”€â”€ Register â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
// â”€â”€ Duplicate checker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Called live as user types title or author
function liveDupCheck() {
  const title  = (document.getElementById('rt').value || '').trim().toLowerCase();
  const author = (document.getElementById('rn').value || '').trim().toLowerCase();
  if (!title && !author) { clearDupWarning(); return; }

  const dups = S.books.filter(b => {
    const bt = (b.title  || '').toLowerCase();
    const ba = (b.author || '').toLowerCase();
    // Title match: exact or one contains the other (â‰¥5 chars)
    const titleMatch = title.length >= 5 && (bt === title || bt.includes(title) || title.includes(bt));
    // Author match: exact name
    const authorMatch = author.length >= 4 && (ba === author || ba.includes(author));
    return titleMatch && authorMatch;
  });

  const warn = document.getElementById('dup-warning');
  const tf   = document.getElementById('rt');
  const af   = document.getElementById('rn');

  if (dups.length > 0) {
    S.dupFound = dups[0];
    document.getElementById('dup-msg').textContent =
      `"${dups[0].title}" by ${dups[0].author} is already registered (${dups[0].qcode}).`;
    warn.classList.remove('hide');
    tf.classList.add('dup-hit');
    af.classList.add('dup-hit');
  } else {
    clearDupWarning();
  }
}

function clearDupWarning() {
  S.dupFound = null;
  document.getElementById('dup-warning').classList.add('hide');
  document.getElementById('rt').classList.remove('dup-hit');
  document.getElementById('rn').classList.remove('dup-hit');
}

function viewDuplicate() {
  if (S.dupFound) openBook(S.dupFound.id);
}

// Enable/disable submit based on checkbox + dup state
function checkOriginal() {
  const checked = document.getElementById('orig-check').checked;
  const btn = document.getElementById('reg-btn');
  btn.disabled = !checked;
  const pb = document.getElementById('paypal-fee-block');
  if (pb) pb.style.display = checked ? 'block' : 'none';
  if (checked) liveDupCheck();
}

function doRegister() {
  const v = id => document.getElementById(id).value.trim();
  const name    = v('rn'), email = v('re'), country = v('rc');
  const title   = v('rt'), genre = v('rg'), lang = v('rl');
  const edition = v('red'), year = v('ry'), price = parseFloat(v('rpr'));
  const synopsis = v('rsy');

  const errs = [];
  if (!name || name.split(' ').filter(w=>w).length < 2) errs.push('Full name (first and last required)');
  if (!email) errs.push('Email address');
  if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email)) errs.push('Valid email format');
  if (!country) errs.push('Country');
  if (!title || title.length < 2) errs.push('Book title');
  if (!genre) errs.push('Genre');
  if (!price || price < 0.01) errs.push('Price');
  if (!synopsis || synopsis.length < 30) errs.push('Synopsis (at least 30 characters)');
  const yr = parseInt(v('ry'));
  if (!yr || yr < 1900 || yr > new Date().getFullYear() + 1) errs.push('Valid publication year');
  if (S.payMode === 'paypal' || S.payMode === 'both') {
    const pp = S.payMode === 'both' ? v('rpp2') : v('rpp');
    if (!pp || !/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(pp)) errs.push('Valid PayPal email');
  }
  if (errs.length) { toast('Please fix: ' + errs.join(' Â· ')); return; }

  // Must have accepted the original content declaration
  if (!document.getElementById('orig-check').checked) {
    toast('Please confirm your original content declaration'); return;
  }

  const btn = document.getElementById('reg-btn');
  btn.disabled = true; btn.textContent = 'Generatingâ€¦';

  const qcode = buildQCode(name, country, year, title, edition);

  let paypal = '', wallet = '', currency = '';
  if (S.payMode === 'paypal') { paypal = v('rpp'); }
  else if (S.payMode === 'crypto') { wallet = v('rwa'); currency = v('rcur'); }
  else { paypal = v('rpp2'); wallet = v('rwa2'); currency = v('rcur2'); }

  const imgEl = document.getElementById('cprev-img');
  const coverUrl = imgEl.src && imgEl.src.startsWith('data:') ? imgEl.src : '';

  const book = {
    id:        'b_' + Date.now(),
    qcode, title, subtitle: v('rs'), author: name, email,
    country, genre, language: lang,
    edition:   parseInt(edition), year: parseInt(year),
    pages:     parseInt(v('rp')) || null,
    price, qeiranCut: +(price * 0.12).toFixed(2),
    authorGets: +(price * 0.88).toFixed(2),
    synopsis, coverUrl, paypal, wallet, currency,
    bio: v('rb'), registered: new Date().toISOString(), scans: 0, orders: 0, approved: false,
  };

  S.books.push(book);
  S.lastBook = book;
  persist();
  document.getElementById('stat-count').textContent = S.books.length;

  // â”€â”€ Save to cloud catalogue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  saveToCloud(book); // async, non-blocking

  // â”€â”€ Send registration confirmation email via Formspree â”€â”€â”€â”€â”€â”€â”€â”€â”€
  sendRegistrationEmail(book);

  btn.disabled = false; btn.textContent = 'Generate My QAN Code & Go Live';
  openSuccess(book);
}

async function sendRegistrationEmail(book) {
  if (QEIRAN_CONFIG.FORMSPREE_REGISTER === 'YOUR_REGISTER_FORM_ID') return;
  try {
    await fetch('https://formspree.io/f/' + QEIRAN_CONFIG.FORMSPREE_REGISTER, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      body: JSON.stringify({
        _subject: 'New Qeiran Registration â€” ' + book.title,
        // â”€â”€ Email to platform (you) â”€â”€
        to_platform: QEIRAN_CONFIG.PLATFORM_EMAIL,
        book_title:  book.title,
        book_author: book.author,
        qan_code:    book.qcode,
        author_email: book.email,
        genre:       book.genre,
        price:       'Â£' + book.price.toFixed(2),
        registered:  book.registered,
        // â”€â”€ Confirmation back to author â”€â”€
        // Formspree will also CC the _replyto address
        _replyto:    book.email,
        author_name: book.author,
        message: [
          'Thank you for registering with Qeiran.',
          '',
          'Your book "' + book.title + '" has been received.',
          'QAN Code: ' + book.qcode,
          '',
          'We review every registration personally.',
          'You will hear from us within 2â€“3 working days.',
          '',
          'Your Q stamp and QAN Code are ready to download',
          'from your registration confirmation page.',
          '',
          'â€” The Qeiran team',
        ].join('\n'),
      }),
    });
  } catch(e) { /* email is bonus, not critical */ }
}

/* â”€â”€ Success modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openSuccess(book) {
  const qparts = book.qcode.split('-');
  // Style: Q in gold, separators dim, data segments in warm ink
  document.getElementById('s-qcode-text').innerHTML =
    '<span style="color:#A07810;font-weight:800">Q</span>' +
    '<span style="color:var(--dim)">-</span>' +
    qparts.slice(1).join('<span style="color:var(--dim)">-</span>');

  // Populate book details
  const titleEl = document.getElementById('s-book-title');
  const authEl  = document.getElementById('s-book-author');
  if (titleEl) titleEl.textContent = book.title + (book.subtitle ? ' â€” ' + book.subtitle : '');
  if (authEl)  authEl.textContent  = book.author + (book.country ? '  Â·  ' + book.country : '');

  const set = (id, val) => { const el = document.getElementById(id); if(el) el.textContent = val; };
  set('s-meta-genre', book.genre || 'â€”');
  set('s-meta-price', book.price ? 'Â£' + Number(book.price).toFixed(2) : 'â€”');
  set('s-meta-year',  book.year  || 'â€”');
  set('s-meta-cut',   book.qeiranCut ? 'Â£' + Number(book.qeiranCut).toFixed(2) + ' (12%)' : '12%');

  document.getElementById('success-modal').classList.add('open');
  setTimeout(() => {
    const url = pageUrl(book.qcode);
    generateQSeal('s-qr', url, 220);
  }, 80);
}

/* â”€â”€ Q Seal generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Uses window.QRMatrix from the npm qrcode bundle.
   Draws the circular QEIRAN stamp: Q body Â· turquoise dots Â·
   gold highlight Â· arc text Â· scannable at 300dpi.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* â”€â”€ getSuppressed â€” cosmetic finder corner removal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Removes outer corners & inner corners of each finder square.
   Core finder structure remains intact â€” stamp is fully scannable.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getSuppressed(sz) {
  // No suppression â€” all finder pattern dots render fully for sharp, scannable stamp
  return new Set();
}

/* â”€â”€ drawQSeal â€” the working law from qlogo.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Renders at 700px internally. Blue dots, red accent, dummy fill.
   Unique per book â€” encodes the book's qeiran.com URL.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* â”€â”€ Q Seal generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
// Q logo PNG â€” the sun

function generateQSeal(containerId, url, displayPx) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = '';
  try {
    const { matrix, size, version } = window.QRMatrix(url, 'H');
    const cv = drawQSeal(matrix, size, version, displayPx || 220);
    el.appendChild(cv);
    return cv;
  } catch(e) { console.warn('Q Seal error:', e); }
}

function drawQSeal(matrix, size, version, displayPx) {
  const px  = 700;
  const cv  = document.createElement('canvas');
  cv.width  = cv.height = px;
  const ctx = cv.getContext('2d');
  // No fillRect â€” transparent outside the Q shape

  const CX = px/2, CY = px/2;
  const R_STAMP = px*0.352, R_OUT = px*0.330, R_IN = px*0.213;
  const INK = '#08080E';

  // Outer ring
  ctx.strokeStyle = INK; ctx.lineWidth = px*0.006;
  ctx.beginPath(); ctx.arc(CX,CY,R_STAMP,0,Math.PI*2); ctx.stroke();

  // Q body (dark ring)
  ctx.fillStyle = INK;
  ctx.beginPath(); ctx.arc(CX,CY,R_OUT,0,Math.PI*2); ctx.fill();

  // Tail
  const TW=R_OUT*.295, TL=R_OUT*.820, TA=43*Math.PI/180, PA=(43-90)*Math.PI/180, AA=122*Math.PI/180;
  const ax=CX+R_OUT*.79*Math.cos(AA), ay=CY+R_OUT*.79*Math.sin(AA);
  const ex=ax+TL*Math.cos(TA), ey=ay+TL*Math.sin(TA), hw=TW/2;
  ctx.fillStyle = INK; ctx.beginPath();
  ctx.moveTo(ax+hw*Math.cos(PA), ay+hw*Math.sin(PA));
  ctx.lineTo(ax-hw*Math.cos(PA), ay-hw*Math.sin(PA));
  ctx.lineTo(ex-hw*.52*Math.cos(PA), ey-hw*.52*Math.sin(PA));
  ctx.lineTo(ex+hw*.52*Math.cos(PA), ey+hw*.52*Math.sin(PA));
  ctx.closePath(); ctx.fill();

  // Moon â€” cream circle shifted right, 2px from east inner wall
  // R_IN=149px, R_MOON=142px, max_shift=7px, east_gap=2px â†’ factor=0.73
  const R_MOON  = R_IN * 0.95;
  const MOON_CX = CX + (R_IN - R_MOON) * 0.77;
  const MOON_CY = CY;
  ctx.fillStyle = '#F6F1E9';
  ctx.beginPath(); ctx.arc(MOON_CX, MOON_CY, R_MOON, 0, Math.PI*2); ctx.fill();

  // QR dots â€” grid and clip both centred on MOON_CX/MOON_CY
  const dotC={r:0,g:25,b:168}, redC={r:204,g:17,b:0};
  const rgb = c => `rgb(${c.r},${c.g},${c.b})`;
  const suppressed = getSuppressed(size);
  const QD=R_MOON*1.96, mod=QD/size, cr=mod*0.46;
  const x0=MOON_CX-QD/2+QD*0.06, y0=MOON_CY-QD/2;
  const density=matrix.flat().filter(v=>v).length/(size*size);
  let rng=42; const rand=()=>{rng=(rng*1664525+1013904223)&0xFFFFFFFF;return(rng>>>0)/0xFFFFFFFF;};
  const pad=Math.ceil(R_MOON/mod)+3;

  const alignTbl=[null,[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42]];
  const ap=alignTbl[version]||[];
  let red=null;
  if(ap.length){
    const pts=[];
    for(let i=0;i<ap.length;i++) for(let j=0;j<ap.length;j++){
      if(i===0&&j===0||i===0&&j===ap.length-1||i===ap.length-1&&j===0) continue;
      pts.push({r:ap[i],c:ap[j]});
    }
    red=pts.length?pts[pts.length-1]:null;
  }

  for(let ri=-pad;ri<size+pad;ri++){
    for(let ci=-pad;ci<size+pad;ci++){
      const px2=x0+(ci+0.5)*mod, py2=y0+(ri+0.5)*mod;
      if((px2-MOON_CX)**2+(py2-MOON_CY)**2 > R_MOON**2) continue;
      const inQR=(ri>=0&&ri<size&&ci>=0&&ci<size);
      let dark=false;
      if(inQR){if(suppressed.has(`${ri},${ci}`)) continue; dark=matrix[ri][ci]===1;}
      else{dark=rand()<density;}
      if(!dark) continue;
      const isRed=inQR&&red&&ri===red.r&&ci===red.c;
      ctx.beginPath(); ctx.arc(px2,py2,isRed?cr*1.6:cr,0,Math.PI*2);
      ctx.fillStyle=isRed?rgb(redC):rgb(dotC); ctx.fill();
    }
  }

  // Arc text
  ctx.fillStyle=INK;
  drawSealText(ctx,'Q E I R A N',CX,CY,R_STAMP*.87,280,px*.034*0.7,false);
  drawSealText(ctx,'INDEPENDENT AUTHOR REGISTER',CX,CY,R_STAMP*.87,180,px*.020*0.7,true);

  const dp=displayPx||220;
  cv.style.width=dp+'px'; cv.style.height=dp+'px';
  return cv;
}

function drawSealText(ctx,text,cx,cy,radius,centreDeg,fontSize,bottom){
  const chars=bottom?[...text].reverse():[...text];
  ctx.font=`${fontSize}px system-ui,sans-serif`;
  const gap=ctx.measureText('I').width*.3;
  const totalArc=chars.reduce((s,c)=>(s+(ctx.measureText(c).width+gap)/radius*(180/Math.PI)),0);
  let angle=centreDeg-totalArc/2;
  chars.forEach(ch=>{
    const cw=ctx.measureText(ch).width;
    const midA=angle+(cw/2)/radius*(180/Math.PI);
    const rad=midA*Math.PI/180;
    ctx.save();
    ctx.translate(cx+radius*Math.cos(rad),cy+radius*Math.sin(rad));
    ctx.rotate((midA+90+(bottom?180:0))*Math.PI/180);
    ctx.fillText(ch,-cw/2,-fontSize*.35);
    ctx.restore();
    angle+=(cw+gap)/radius*(180/Math.PI);
  });
}

function closeSuccess() {
  document.getElementById('success-modal').classList.remove('open');
  go('catalogue');
}
function viewLastBook() {
  document.getElementById('success-modal').classList.remove('open');
  if (S.lastBook) openBook(S.lastBook.id);
}
function dlQR() {
  const c = document.querySelector('#s-qr canvas');
  if (!c) { toast('Q stamp not ready'); return; }

  const OUT = 700;
  const out = document.createElement('canvas');
  out.width = out.height = OUT;
  const octx = out.getContext('2d');
  octx.clearRect(0, 0, OUT, OUT);
  octx.save();
  octx.beginPath();
  octx.arc(OUT/2, OUT/2, OUT/2, 0, Math.PI*2);
  octx.clip();
  octx.drawImage(c, 0, 0, OUT, OUT);
  octx.restore();

  const a = document.createElement('a');
  a.download = (S.lastBook ? S.lastBook.qcode : 'qeiran-stamp') + '_QSeal.png';
  a.href = out.toDataURL('image/png');
  a.click();
  toast('Q stamp downloaded â€” circular PNG, print ready at 700px');
}

/* â”€â”€ Catalogue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setFilter(f, el) {
  S.filter = f;
  document.querySelectorAll('.fb').forEach(b => b.classList.remove('on'));
  if (el) el.classList.add('on');
  renderCat();
}
function renderCat() {
  const q = (document.getElementById('cat-q').value || '').toLowerCase();
  let books = S.books.filter(b => {
    if (S.filter !== 'all' && b.genre !== S.filter) return false;
    if (q && !b.title.toLowerCase().includes(q) &&
        !b.author.toLowerCase().includes(q) &&
        !(b.genre||'').toLowerCase().includes(q) &&
        !b.qcode.toLowerCase().includes(q)) return false;
    return true;
  });
  const grid = document.getElementById('booksGrid');
  if (!books.length) {
    grid.innerHTML = `<div class="cat-empty">No books found. <a href="#" onclick="go('register');return false" style="color:var(--brand)">Register one â†’</a></div>`;
    return;
  }
  grid.innerHTML = books.map(b => `
    <div class="book-card" onclick="openBook('${b.id}')">
      <div class="bc-cover">
        ${b.coverUrl ? `<img src="${b.coverUrl}" alt="" loading="lazy">` :
          `<div class="bc-placeholder">${esc(b.title)}</div>`}
        <div class="bc-qr" id="cqr-${b.id}"></div>
      </div>
      <div class="bc-info">
        <div class="bc-title">${esc(b.title)}</div>
        <div class="bc-author">${esc(b.author)}</div>
        <div class="bc-qcode">${b.qcode}</div>
        <div class="bc-price">Â£${b.price.toFixed(2)}</div>
      </div>
    </div>`).join('');

  // Render badge QRs
  books.forEach(b => {
    setTimeout(() => generateQSeal('cqr-' + b.id, pageUrl(b.qcode), 38), 60);
  });
}

/* â”€â”€ Book detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openBook(id) {
  const b = S.books.find(x => x.id === id);
  if (!b) return;
  const url = pageUrl(b.qcode);
  const ordinal = n => n===1?'1st':n===2?'2nd':n===3?'3rd':n+'th';

  document.getElementById('book-content').innerHTML = `
    <div class="book-hero">
      <div class="b-cover">
        ${b.coverUrl ? `<img src="${b.coverUrl}" alt="">` :
          `<div class="b-cover-ph">${esc(b.title)}</div>`}
        <div class="qr-stamp" id="bqrs-${b.id}"></div>
      </div>
      <div>
        <h1 class="b-title">${esc(b.title)}</h1>
        ${b.subtitle ? `<p class="b-sub">${esc(b.subtitle)}</p>` : ''}
        <div class="b-author">by ${esc(b.author)}${b.bio?'  Â·  '+esc(b.bio):''}</div>
        <div class="b-qcode">${b.qcode}</div>
        <div class="b-meta">
          <div class="bm"><div class="bm-l">Genre</div><div class="bm-v">${esc(b.genre)}</div></div>
          <div class="bm"><div class="bm-l">Language</div><div class="bm-v">${esc(b.language)}</div></div>
          <div class="bm"><div class="bm-l">Edition</div><div class="bm-v">${ordinal(b.edition)}</div></div>
          <div class="bm"><div class="bm-l">Year</div><div class="bm-v">${b.year}</div></div>
          ${b.pages?`<div class="bm"><div class="bm-l">Pages</div><div class="bm-v">${b.pages}</div></div>`:''}
          <div class="bm"><div class="bm-l">Country</div><div class="bm-v">${b.country}</div></div>
        </div>
        <div class="b-price-bar">
          <div><div style="font-size:10px;letter-spacing:.14em;text-transform:uppercase;color:var(--dim);margin-bottom:4px">Per Copy</div><div class="b-price">Â£${b.price.toFixed(2)}</div></div>
          <button class="b-order-btn" onclick="openOrder('${b.id}')">Order Now</button>
          ${b.approved===false?'<button onclick="approveBook(\''+b.id+'\')" style="padding:8px 16px;background:var(--teal);color:#fff;border:none;border-radius:5px;font-size:11px;font-weight:600;cursor:pointer;margin-right:8px;">Approve &amp; Issue QAN</button>':''}
          <button class="b-delete-btn" onclick="showDeleteConfirm('${b.id}')">Remove this bookâ€¦</button>
          <div class="del-confirm" id="del-confirm-${b.id}">
            <strong>Remove "${esc(b.title)}"?</strong><br>
            <span style="font-size:11px;color:var(--dim);display:block;margin:4px 0 10px">
              This removes the book from the catalogue permanently.
            </span>
            <button class="del-yes" onclick="deleteBook('${b.id}')">Yes, remove it</button>
            <button class="del-no" onclick="hideDeleteConfirm('${b.id}')">Cancel</button>
          </div>
        </div>
        <div style="font-size:11px;color:var(--dim);margin-top:6px">
          ${b.paypal?'ğŸ’³ PayPal Â· ':''} ${b.wallet?'â‚¿ '+b.currency:''}
          <span style="margin-left:8px">Author keeps: Â£${b.authorGets.toFixed(2)} per copy</span>
        </div>
      </div>
    </div>
    <div class="b-sec-label">About this Book</div>
    <p class="b-synopsis">${esc(b.synopsis)}</p>
    <div class="b-sec-label">Scan to Purchase</div>
    <div class="qr-scan-block">
      <div style="position:relative;display:inline-block;">
        <div id="bqrl-${b.id}" style="display:inline-block;${b.approved===false?'filter:blur(3px);opacity:0.45;':''}"></div>
        ${b.approved===false?'<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;"><div style="background:rgba(139,69,19,.88);color:#fff;font-size:11px;font-weight:700;letter-spacing:.14em;padding:6px 14px;border-radius:4px;transform:rotate(-15deg);">SAMPLE</div></div>':''}
      </div>
      <div class="qr-scan-info">
        ${b.approved===false
          ?'<p style="color:var(--warm-brown);font-size:12px;font-weight:600;line-height:1.6;">&#9888; Pending QRIB review. Live QAN Code issued within 24&ndash;48 hours of approval.</p>'
          :'<p>Scan with any smartphone camera to open this book order page. Print it, share it, post it.</p>'}
        <div class="qr-url">${url}</div>
      </div>
    </div>
    </div>
  `;

  setTimeout(() => {
    generateQSeal('bqrs-' + b.id, url, 56);   // cover stamp â€” small
    generateQSeal('bqrl-' + b.id, url, 320);  // scan block â€” full size
  }, 80);

  go('book');
}

/* â”€â”€ Delete book â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showDeleteConfirm(id) {
  document.getElementById('del-confirm-' + id).classList.add('open');
}
function hideDeleteConfirm(id) {
  document.getElementById('del-confirm-' + id).classList.remove('open');
}
async function deleteBook(id) {
  const b = S.books.find(x => x.id === id);
  if (!b) return;

  // Remove from local state
  S.books = S.books.filter(x => x.id !== id);
  persist();
  document.getElementById('stat-count').textContent = S.books.length;

  // Remove from Supabase cloud
  if (QEIRAN_CONFIG.SUPABASE_URL !== 'YOUR_SUPABASE_URL') {
    try {
      await sbFetch('books?id=eq.' + encodeURIComponent(id), {
        method: 'DELETE',
        headers: { 'Prefer': 'return=minimal' }
      });
    } catch(e) { console.warn('Cloud delete failed:', e); }
  }

  toast('"' + b.title + '" removed from the catalogue.');
  go('catalogue');
}

/* â”€â”€ Order modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openOrder(id) {
  const b = S.books.find(x => x.id === id);
  if (!b) return;
  S.orderBook = b;
  document.getElementById('o-bname').textContent = b.title + ' by ' + b.author;
  document.getElementById('o-qty').value = 1;
  updTotal();
  document.getElementById('order-modal').classList.add('open');
}
function closeOrder() { document.getElementById('order-modal').classList.remove('open'); }
function updTotal() {
  if (!S.orderBook) return;
  const qty = parseInt(document.getElementById('o-qty').value) || 1;
  document.getElementById('o-total').textContent = 'Â£' + (S.orderBook.price * qty).toFixed(2);
}
function setPM(m) {
  S.orderPM = m;
  document.querySelectorAll('.pm').forEach(p => p.classList.remove('on'));
  document.getElementById('pm-' + (m === 'paypal' ? 'pp' : 'crypto')).classList.add('on');
}
function doOrder() {
  if (!S.orderBook) return;
  const qty   = parseInt(document.getElementById('o-qty').value) || 1;
  const name  = document.getElementById('o-name')  ? document.getElementById('o-name').value.trim()  : '';
  const email = document.getElementById('o-email') ? document.getElementById('o-email').value.trim() : '';
  const total = (S.orderBook.price * qty).toFixed(2);

  // â”€â”€ Notify author + platform via Formspree â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  sendOrderEmail(S.orderBook, qty, name, email, total);

  // â”€â”€ Redirect buyer to PayPal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (S.orderBook.paypal) {
    setTimeout(() => {
      window.open(
        'https://www.paypal.com/paypalme/' +
        encodeURIComponent(S.orderBook.paypal) + '/' + total + 'GBP',
        '_blank'
      );
    }, 400);
  }

  toast('Order sent â€” you will be redirected to payment.');
  closeOrder();

  // Increment order count locally
  const bk = S.books.find(x => x.id === S.orderBook.id);
  if (bk) { bk.orders = (bk.orders||0) + 1; persist(); }
}

async function sendOrderEmail(book, qty, buyerName, buyerEmail, total) {
  if (QEIRAN_CONFIG.FORMSPREE_ORDER === 'YOUR_ORDER_FORM_ID') return;
  try {
    await fetch('https://formspree.io/f/' + QEIRAN_CONFIG.FORMSPREE_ORDER, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      body: JSON.stringify({
        _subject: 'New Order â€” ' + book.title + ' Ã— ' + qty,
        _replyto: buyerEmail || QEIRAN_CONFIG.PLATFORM_EMAIL,
        book_title:   book.title,
        book_author:  book.author,
        qan_code:     book.qcode,
        quantity:     qty,
        total:        'Â£' + total,
        buyer_name:   buyerName  || 'Not provided',
        buyer_email:  buyerEmail || 'Not provided',
        author_email: book.email,
        paypal:       book.paypal || 'N/A',
        message: 'A buyer has placed an order through Qeiran. Please fulfil and confirm payment via PayPal.',
      }),
    });
  } catch(e) {}
}

/* â”€â”€ URL builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function pageUrl(qcode) {
  // Always encode the live qeiran.com URL â€” keeps QR version low and dots large.
  // Works correctly whether file is opened locally or on the server.
  const base = (window.location.hostname === 'localhost' || window.location.protocol === 'file:')
    ? 'https://qeiran.com/'
    : (window.location.origin + '/');
  return base + '?q=' + qcode;
}

/* â”€â”€ Persistence â€” localStorage fallback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function persist() {
  try { localStorage.setItem('qeiran_v1', JSON.stringify(S.books)); } catch(e) {}
}
function hydrate() {
  try {
    const r = localStorage.getItem('qeiran_v1');
    if (r) S.books = JSON.parse(r);
  } catch(e) {}
}

/* â”€â”€ Supabase helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function sbFetch(path, opts={}) {
  const url = QEIRAN_CONFIG.SUPABASE_URL + '/rest/v1/' + path;
  const headers = {
    'apikey': QEIRAN_CONFIG.SUPABASE_KEY,
    'Authorization': 'Bearer ' + QEIRAN_CONFIG.SUPABASE_KEY,
    'Content-Type': 'application/json',
    'Prefer': 'return=minimal',
    ...( opts.headers || {} )
  };
  return fetch(url, { ...opts, headers });
}

async function loadFromCloud() {
  if (QEIRAN_CONFIG.SUPABASE_URL === 'YOUR_SUPABASE_URL') return false;
  try {
    const r = await sbFetch('books?select=*&order=registered.desc&limit=200');
    if (!r.ok) return false;
    const data = await r.json();
    if (Array.isArray(data) && data.length > 0) {
      // Map snake_case DB columns to camelCase app
      S.books = data.map(b => ({
        id: b.id, qcode: b.qcode, title: b.title, subtitle: b.subtitle,
        author: b.author, email: b.email, country: b.country,
        genre: b.genre, language: b.language, edition: b.edition,
        year: b.year, pages: b.pages, price: b.price,
        qeiranCut: b.qeiran_cut, authorGets: b.author_gets,
        synopsis: b.synopsis, coverUrl: b.cover_url, pdfUrl: b.pdf_url,
        paypal: b.paypal, wallet: b.wallet, currency: b.currency,
        bio: b.bio, registered: b.registered, scans: b.scans, orders: b.orders,
      }));
      persist(); // cache locally too
      document.getElementById('stat-count').textContent = S.books.length;
      if (typeof renderCat === 'function') renderCat();
      return true;
    }
  } catch(e) { console.warn('Cloud load failed, using local:', e); }
  return false;
}

async function saveToCloud(book) {
  if (QEIRAN_CONFIG.SUPABASE_URL === 'YOUR_SUPABASE_URL') return true; // demo mode
  try {
    const payload = {
      id: book.id, qcode: book.qcode, title: book.title,
      subtitle: book.subtitle || null, author: book.author,
      email: book.email, country: book.country, genre: book.genre,
      language: book.language, edition: book.edition, year: book.year,
      pages: book.pages || null, price: book.price,
      qeiran_cut: book.qeiranCut, author_gets: book.authorGets,
      synopsis: book.synopsis, cover_url: book.coverUrl || null,
      paypal: book.paypal || null, wallet: book.wallet || null,
      currency: book.currency || null, bio: book.bio || null,
      registered: book.registered, scans: 0, orders: 0, approved: true,
    };
    const r = await sbFetch('books', {
      method: 'POST',
      body: JSON.stringify(payload),
    });
    return r.ok || r.status === 201;
  } catch(e) { console.warn('Cloud save failed:', e); return false; }
}

/* â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function esc(s) {
  return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

/* â”€â”€ Deep link â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function checkDeepLink() {
  const q = new URLSearchParams(location.search).get('q');
  if (q) {
    const b = S.books.find(x => x.qcode === q);
    if (b) { openBook(b.id); return true; }
  }
  return false;
}

/* â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function init() {
  hydrate();
  document.getElementById('stat-count').textContent = S.books.length;

  // Try loading live catalogue from cloud â€” falls back to local/demo
  loadFromCloud();

  // Demo books so the catalogue isn't empty on first load
  if (S.books.length === 0) {
    const DEMO = [
      { id:'demo1', qcode:'Q-GB-25-ANQU-BLPU-01-0001-K', title:'The Black Pulpit', subtitle:'A story of fire and conviction', author:'Angel Quinn', email:'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="96f7f8f1f3fad6e7e4fff4b8f5f9b8e3fd">[email&#160;protected]</a>', country:'GB', genre:'Fiction', language:'English', edition:1, year:2025, pages:312, price:14.99, qeiranCut:1.80, authorGets:13.19, synopsis:'A gripping tale of faith, doubt, and the fires that test both. Set against the backdrop of 1970s Jamaica, The Black Pulpit follows a young preacher wrestling with the God he was raised to serve and the truths no sermon can contain.', coverUrl:'', paypal:'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="23424d44464f6352514a410d404c0d5648">[email&#160;protected]</a>', wallet:'', currency:'USDC', bio:'Founder of QRIB', registered:'2025-01-15T12:00:00Z', scans:47, orders:12 },
      { id:'demo2', qcode:'Q-NG-25-KEMI-WEVW-01-0002-R', title:'We Were Woven', subtitle:'Poetry from the Delta', author:'Kemi Adeyemi', email:'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bcd7d9d1d5fcd9c4ddd1ccd0d992dfd3d1">[email&#160;protected]</a>', country:'NG', genre:'Poetry', language:'English', edition:1, year:2025, pages:88, price:9.99, qeiranCut:1.20, authorGets:8.79, synopsis:'Verses drawn from the rivers of the Niger Delta. We Were Woven is a collection about land, memory, and the persistent beauty of things that refuse to be erased. Selected for the 2025 African Poetry Prize longlist.', coverUrl:'', paypal:'', wallet:'0x4fa...', currency:'ETH', bio:'Lagos-based poet', registered:'2025-02-01T09:00:00Z', scans:33, orders:8 },
      { id:'demo3', qcode:'Q-IN-24-PRSN-THSF-01-0003-M', title:'The Slow Fire', subtitle:'Notes on a changing climate', author:'Priya Nair Singh', email:'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="95e5e7fcecf4d5f0edf4f8e5f9f0bbf6faf8">[email&#160;protected]</a>', country:'IN', genre:'Non-Fiction', language:'English', edition:1, year:2024, pages:228, price:12.99, qeiranCut:1.56, authorGets:11.43, synopsis:'A journalist-turned-scientist traces how slow emergencies become visible. Part memoir, part investigation, The Slow Fire is an urgent and beautiful account of what we lose when change outpaces attention.', coverUrl:'', paypal:'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bacac8d3c3dbfadfc2dbd7cad6df94d9d5d7">[email&#160;protected]</a>', wallet:'', currency:'USDC', bio:'Climate journalist, New Delhi', registered:'2025-01-22T14:00:00Z', scans:61, orders:21 },
    ];
    S.books = DEMO;
    persist();
    document.getElementById('stat-count').textContent = S.books.length;
  }

  if (!checkDeepLink() && !checkAdminParam()) go('catalogue');
}

init();
</script>


<!-- â”€â”€ CUSTOMISER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="customiser">
  <button id="cust-toggle" onclick="toggleCust()" title="Design controls" style="opacity:0;width:8px;height:8px;padding:0;border:none;background:transparent;cursor:default;position:absolute;bottom:0;right:0;"></button>
  <div id="cust-panel">
    <div class="cust-h">âœ¦ Studio Controls</div>

    <div class="cust-label" style="margin-bottom:6px">Platform Name</div>
    <div class="cust-row">
      <input type="text" id="cust-name" value="Qeiran" placeholder="Platform name">
      <input type="text" id="cust-suffix" value="" placeholder="Suffix">
    </div>

    <div class="cust-label" style="margin-bottom:6px">Hero Headline</div>
    <div class="cust-row">
      <input type="text" id="cust-line1" value="Your book." placeholder="Line 1">
    </div>
    <div class="cust-row">
      <input type="text" id="cust-line2" value="Registered forever." placeholder="Line 2 (italic)">
    </div>

    <div class="cust-divider"></div>

    <div class="cust-label" style="margin-bottom:8px">Background</div>
    <div class="cust-swatch-row" id="bg-swatches">
      <div class="cust-swatch" style="background:#F5F0E8" data-bg="#F5F0E8" data-fg="#1A1814" onclick="setBg(this)" title="Warm Cream"></div>
      <div class="cust-swatch active" style="background:#EDE8DE" data-bg="#EDE8DE" data-fg="#1A1814" onclick="setBg(this)" title="Parchment"></div>
      <div class="cust-swatch" style="background:#E8E2D4" data-bg="#E8E2D4" data-fg="#1A1814" onclick="setBg(this)" title="Linen"></div>
      <div class="cust-swatch" style="background:#2C2C30" data-bg="#2C2C30" data-fg="#F0EDE6" onclick="setBg(this)" title="Dark Slate"></div>
      <div class="cust-swatch" style="background:#22262E" data-bg="#22262E" data-fg="#F0EDE6" onclick="setBg(this)" title="Deep Slate"></div>
      <div class="cust-swatch" style="background:#1E1C18" data-bg="#1E1C18" data-fg="#F0EDE6" onclick="setBg(this)" title="Near Black"></div>
    </div>

    <div class="cust-label" style="margin-bottom:8px">Accent / Gold</div>
    <div class="cust-swatch-row" id="acc-swatches">
      <div class="cust-swatch active" style="background:#B8860B" data-acc="#B8860B" onclick="setAcc(this)" title="Warm Gold"></div>
      <div class="cust-swatch" style="background:#C4877A" data-acc="#C4877A" onclick="setAcc(this)" title="Dusty Rose"></div>
      <div class="cust-swatch" style="background:#5B8FA0" data-acc="#5B8FA0" onclick="setAcc(this)" title="Soft Teal"></div>
      <div class="cust-swatch" style="background:#6B7FA8" data-acc="#6B7FA8" onclick="setAcc(this)" title="Slate Blue"></div>
      <div class="cust-swatch" style="background:#7A9E8A" data-acc="#7A9E8A" onclick="setAcc(this)" title="Sage"></div>
      <div class="cust-swatch" style="background:#8B6355" data-acc="#8B6355" onclick="setAcc(this)" title="Warm Umber"></div>
    </div>

    <div class="cust-label" style="margin-bottom:8px">Button Colour</div>
    <div class="cust-swatch-row" id="btn-swatches">
      <div class="cust-swatch active" style="background:#5B8FA0" data-btn="#5B8FA0" onclick="setBtn(this)" title="Soft Teal"></div>
      <div class="cust-swatch" style="background:#7A9E8A" data-btn="#7A9E8A" onclick="setBtn(this)" title="Sage"></div>
      <div class="cust-swatch" style="background:#6B7FA8" data-btn="#6B7FA8" onclick="setBtn(this)" title="Periwinkle"></div>
      <div class="cust-swatch" style="background:#C4877A" data-btn="#C4877A" onclick="setBtn(this)" title="Dusty Rose"></div>
      <div class="cust-swatch" style="background:#8B6355" data-btn="#8B6355" onclick="setBtn(this)" title="Warm Umber"></div>
      <div class="cust-swatch" style="background:#9E8B6E" data-btn="#9E8B6E" onclick="setBtn(this)" title="Sand"></div>
    </div>

    <div class="cust-label" style="margin-bottom:8px">Headline Font</div>
    <div class="cust-row">
      <select id="cust-font" onchange="applyFont(this.value)">
        <option value="Georgia,serif">Georgia (Serif)</option>
        <option value="'Helvetica Neue',Arial,sans-serif" selected>Helvetica Neue (Narrow)</option>
        <option value="'Times New Roman',serif">Times New Roman</option>
        <option value="'Trebuchet MS',sans-serif">Trebuchet (Humanist)</option>
        <option value="'Palatino Linotype',serif">Palatino (Literary)</option>
        <option value="'Century Gothic','Futura',sans-serif">Century Gothic (Geometric)</option>
        <option value="'Courier New',monospace">Courier (Typewriter)</option>
      </select>
    </div>

    <div class="cust-apply" onclick="applyAll()">âœ¦ Apply</div>

    <div class="cust-divider"></div>
    <div class="cust-name-hint">
      Qeiran Â· qauthor Â· Quthora Â· Lybris Â· Lybriq Â· Foliant Â· Velluma
    </div>
  </div>
</div>

<!-- â”€â”€ CAVEAT / LEGAL NOTICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="caveat-bar">
  <strong style="color:var(--warm-brown);letter-spacing:.12em;font-size:10px;text-transform:uppercase;">
    âš  Notice of Private &amp; Proprietary Intellectual Property
  </strong><br>
  All creative works, concepts, platform architecture, QAN Code system, QR trade dress, visual identity, 
  code and content within this platform are the exclusive intellectual property of QRIB and its agent YH (Angel). 
  Unauthorised reproduction, reverse engineering, imitation or distribution â€” in whole or in part â€” 
  is strictly prohibited and will be pursued. Registration constitutes your acceptance of these terms.<br>
  <span style="opacity:.45;font-size:9px;">
    Â© QRIB. All rights reserved. Qeiran is a QRIB platform. 
    QAN Codes are unique permanent identifiers â€” once assigned they cannot be transferred or deleted.
  </span>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUTHORS PORTAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="authors-page" class="page">
  <div style="max-width:860px;margin:0 auto;padding:72px 36px 80px;">

    <!-- Header -->
    <div style="margin-bottom:52px;">
      <div style="font-size:9px;font-weight:600;letter-spacing:.26em;text-transform:uppercase;
                  color:var(--warm-brown);margin-bottom:12px;font-family:var(--mono);">
        Qeiran Authors
      </div>
      <h1 style="font-family:var(--narrow);font-size:clamp(32px,5vw,58px);
                 font-weight:200;letter-spacing:-.02em;color:var(--fg);margin-bottom:14px;">
        Your books.<br>Your terms.
      </h1>
      <p style="font-size:14px;color:var(--dim);line-height:1.8;max-width:480px;font-weight:300;">
        Everything in one place. Register, upload, price, track and get paid â€”
        without a publisher between you and your reader.
      </p>
    </div>

    <!-- Flow steps -->
    <div style="display:grid;gap:2px;margin-bottom:56px;">

      <!-- Step 1 -->
      <div class="author-step">
        <div class="step-num">01</div>
        <div class="step-body">
          <div class="step-title">Register your book</div>
          <div class="step-desc">
            Fill in your title, author details, genre and price. Your permanent
            <strong>QAN Code</strong> is assigned instantly â€” a unique address
            for your book that never changes or expires. You receive a
            print-ready <strong>Q stamp</strong> to place on your cover.
          </div>
          <button class="step-action" onclick="go('register')">Register a book â†’</button>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="author-step">
        <div class="step-num">02</div>
        <div class="step-body">
          <div class="step-title">Upload your files</div>
          <div class="step-desc">
            Upload a PDF for digital sales â€” readers buy and receive a
            secure download link. Optionally upload your cover image.
            Files are stored securely; the PDF is only released on confirmed payment.
          </div>
          <div class="step-upload-row">
            <label class="upload-pill">
              <input type="file" accept=".pdf" style="display:none" onchange="handleAuthorPdf(this)">
              ğŸ“„ Upload PDF
            </label>
            <label class="upload-pill">
              <input type="file" accept="image/*" style="display:none" onchange="handleAuthorCover(this)">
              ğŸ–¼ Upload Cover
            </label>
            <span id="author-file-status" style="font-size:11px;color:var(--dim);font-family:var(--mono);"></span>
          </div>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="author-step">
        <div class="step-num">03</div>
        <div class="step-body">
          <div class="step-title">Set your price &amp; go live</div>
          <div class="step-desc">
            You set the price. Qeiran retains 12% on digital sales and
            12% on any physical orders routed through the platform.
            The rest goes directly to your PayPal or bank within 48 hours of each sale.
            Your book appears in the catalogue immediately.
          </div>
          <div style="display:flex;gap:24px;margin-top:14px;flex-wrap:wrap;">
            <div class="author-stat-box">
              <div class="asb-n">88%</div>
              <div class="asb-l">To you, per sale</div>
            </div>
            <div class="author-stat-box">
              <div class="asb-n">48h</div>
              <div class="asb-l">Payout window</div>
            </div>
            <div class="author-stat-box">
              <div class="asb-n">0</div>
              <div class="asb-l">Gatekeepers</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 4 -->
      <div class="author-step">
        <div class="step-num">04</div>
        <div class="step-body">
          <div class="step-title">Physical copies &amp; fulfilment</div>
          <div class="step-desc">
            Buyers can enquire about physical copies through the catalogue.
            For now, wholesale and individual print enquiries are routed to you
            directly â€” you fulfil through your printer of choice.
            When we launch print-on-demand partnerships, you will be notified
            and can opt in without re-registering.
          </div>
          <label style="display:flex;align-items:center;gap:10px;margin-top:14px;
                        font-size:12px;color:var(--dim);cursor:pointer;">
            <input type="checkbox" id="author-print-interest"
                   style="width:14px;height:14px;accent-color:var(--teal);">
            Notify me when print fulfilment launches
          </label>
        </div>
      </div>

      <!-- Step 5 -->
      <div class="author-step">
        <div class="step-num">05</div>
        <div class="step-body">
          <div class="step-title">Track your sales</div>
          <div class="step-desc">
            Every scan of your Q stamp is logged. See how many times your
            QAN Code has been scanned, how many orders placed, and your
            running total. Your catalogue page is live 24/7 globally.
          </div>
          <div style="margin-top:16px;padding:16px 20px;
                      background:var(--bg2);border-radius:4px;
                      border:1px solid var(--border);
                      font-family:var(--mono);font-size:11px;color:var(--dim);">
            Author dashboard â€” coming in next release.
            Registered authors will be first to access.
          </div>
        </div>
      </div>

    </div><!-- /steps -->

    <!-- CTA row -->
    <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:center;
                padding-top:32px;border-top:1px solid var(--border);">
      <button class="cta-p" onclick="go('register')">Register your first book</button>
      <button class="cta-ghost" onclick="go('catalogue')">Browse the catalogue</button>
    </div>

  </div>
</div><!-- /authors-page -->

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
/* â”€â”€ CUSTOMISER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleCust(){
  document.getElementById('cust-panel').classList.toggle('open');
}
function setBg(el){
  document.querySelectorAll('#bg-swatches .cust-swatch').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  const bg=el.dataset.bg, fg=el.dataset.fg;
  document.documentElement.style.setProperty('--bg',bg);
  document.documentElement.style.setProperty('--fg',fg);
  document.documentElement.style.setProperty('--ink',bg);
  document.documentElement.style.setProperty('--paper',fg);
  const isDark=parseInt(bg.replace('#',''),16)<0x888888;
  document.getElementById('nav').style.background=isDark
    ?`rgba(${hexToRgb(bg)},0.94)`:`rgba(${hexToRgb(bg)},0.97)`;
  document.documentElement.style.setProperty('--cust-bg',isDark?'#1a1a22':'#e8e5dc');
}
function setAcc(el){
  document.querySelectorAll('#acc-swatches .cust-swatch').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  document.documentElement.style.setProperty('--goldf',el.dataset.acc);
  document.documentElement.style.setProperty('--gold',el.dataset.acc);
}
function setBtn(el){
  document.querySelectorAll('#btn-swatches .cust-swatch').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  document.documentElement.style.setProperty('--brand',el.dataset.btn);
  document.documentElement.style.setProperty('--brandl',el.dataset.btn);
}
function applyFont(val){
  document.documentElement.style.setProperty('--narrow',val);
  document.querySelectorAll('.hero-h,.sec-h,.cat-h,.reg-h').forEach(el=>el.style.fontFamily=val);
}
function hexToRgb(hex){
  return `${parseInt(hex.slice(1,3),16)},${parseInt(hex.slice(3,5),16)},${parseInt(hex.slice(5,7),16)}`;
}
function applyAll(){
  const name=document.getElementById('cust-name').value||'Qeiran';
  const suffix=document.getElementById('cust-suffix').value||'';
  document.querySelector('.brand-b').textContent=name;
  const bq=document.querySelector('.brand-q');
  if(bq) bq.textContent=suffix;
  document.title=name+' â€” Independent Author Register';
  const l1=document.getElementById('cust-line1').value||'Your book.';
  const l2=document.getElementById('cust-line2').value||'Registered forever.';
  const h=document.querySelector('.hero-h');
  if(h) h.innerHTML=l1+'<br><span class="it">'+l2+'</span>';
  applyFont(document.getElementById('cust-font').value);
  document.getElementById('cust-panel').classList.remove('open');
}
document.addEventListener('click',e=>{
  const p=document.getElementById('cust-panel');
  const t=document.getElementById('cust-toggle');
  if(p&&p.classList.contains('open')&&!p.contains(e.target)&&e.target!==t)
    p.classList.remove('open');
});


function handleAuthorPdf(inp){
  const f=inp.files[0];
  if(f){document.getElementById('author-file-status').textContent='âœ“ '+f.name+' ready';}
}
function handleAuthorCover(inp){
  const f=inp.files[0];
  if(f){const s=document.getElementById('author-file-status');
    s.textContent=(s.textContent?s.textContent+' Â· ':'')+f.name;}
}


/* â”€â”€ WHOLESALE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function wsSubmit(){
  const org   = document.getElementById('ws-org').value.trim();
  const email = document.getElementById('ws-email').value.trim();
  const qty   = document.getElementById('ws-qty').value;
  if(!org||!email){toast('Please fill organisation and email');return;}
  if (QEIRAN_CONFIG.FORMSPREE_WHOLESALE !== 'YOUR_WHOLESALE_FORM_ID') {
    try {
      await fetch('https://formspree.io/f/' + QEIRAN_CONFIG.FORMSPREE_WHOLESALE, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        body: JSON.stringify({
          _subject:      'Wholesale Enquiry â€” ' + org,
          _replyto:      email,
          organisation:  org,
          contact_email: email,
          approx_qty:    qty || 'Not specified',
          message:       'Wholesale enquiry received via Qeiran catalogue.',
        }),
      });
    } catch(e) {}
  }
  toast('Enquiry received â€” we will be in touch within 1 working day.');
  document.getElementById('ws-form').classList.add('hide');
  ['ws-org','ws-email','ws-qty'].forEach(id=>document.getElementById(id).value='');
}

document.addEventListener('change',e=>{
  if(e.target.id==='rpdf'){
    const f=e.target.files[0];
    if(f) document.getElementById('pdf-name').textContent='âœ“ '+f.name;
  }
});

</script>




<!-- â”€â”€ CUSTOMISER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="customiser">
  <button id="cust-toggle" onclick="toggleCust()" title="Design controls" style="opacity:0;width:8px;height:8px;padding:0;border:none;background:transparent;cursor:default;position:absolute;bottom:0;right:0;"></button>
  <div id="cust-panel">
    <div class="cust-h">âœ¦ Studio Controls</div>

    <div class="cust-label" style="margin-bottom:6px">Platform Name</div>
    <div class="cust-row">
      <input type="text" id="cust-name" value="Qeiran" placeholder="Platform name">
      <input type="text" id="cust-suffix" value="" placeholder="Suffix">
    </div>

    <div class="cust-label" style="margin-bottom:6px">Hero Headline</div>
    <div class="cust-row">
      <input type="text" id="cust-line1" value="Your book." placeholder="Line 1">
    </div>
    <div class="cust-row">
      <input type="text" id="cust-line2" value="Registered forever." placeholder="Line 2 (italic)">
    </div>

    <div class="cust-divider"></div>

    <div class="cust-label" style="margin-bottom:8px">Background</div>
    <div class="cust-swatch-row" id="bg-swatches">
      <div class="cust-swatch" style="background:#F5F0E8" data-bg="#F5F0E8" data-fg="#1A1814" onclick="setBg(this)" title="Warm Cream"></div>
      <div class="cust-swatch active" style="background:#EDE8DE" data-bg="#EDE8DE" data-fg="#1A1814" onclick="setBg(this)" title="Parchment"></div>
      <div class="cust-swatch" style="background:#E8E2D4" data-bg="#E8E2D4" data-fg="#1A1814" onclick="setBg(this)" title="Linen"></div>
      <div class="cust-swatch" style="background:#2C2C30" data-bg="#2C2C30" data-fg="#F0EDE6" onclick="setBg(this)" title="Dark Slate"></div>
      <div class="cust-swatch" style="background:#22262E" data-bg="#22262E" data-fg="#F0EDE6" onclick="setBg(this)" title="Deep Slate"></div>
      <div class="cust-swatch" style="background:#1E1C18" data-bg="#1E1C18" data-fg="#F0EDE6" onclick="setBg(this)" title="Near Black"></div>
    </div>

    <div class="cust-label" style="margin-bottom:8px">Accent / Gold</div>
    <div class="cust-swatch-row" id="acc-swatches">
      <div class="cust-swatch active" style="background:#B8860B" data-acc="#B8860B" onclick="setAcc(this)" title="Warm Gold"></div>
      <div class="cust-swatch" style="background:#C4877A" data-acc="#C4877A" onclick="setAcc(this)" title="Dusty Rose"></div>
      <div class="cust-swatch" style="background:#5B8FA0" data-acc="#5B8FA0" onclick="setAcc(this)" title="Soft Teal"></div>
      <div class="cust-swatch" style="background:#6B7FA8" data-acc="#6B7FA8" onclick="setAcc(this)" title="Slate Blue"></div>
      <div class="cust-swatch" style="background:#7A9E8A" data-acc="#7A9E8A" onclick="setAcc(this)" title="Sage"></div>
      <div class="cust-swatch" style="background:#8B6355" data-acc="#8B6355" onclick="setAcc(this)" title="Warm Umber"></div>
    </div>

    <div class="cust-label" style="margin-bottom:8px">Button Colour</div>
    <div class="cust-swatch-row" id="btn-swatches">
      <div class="cust-swatch active" style="background:#5B8FA0" data-btn="#5B8FA0" onclick="setBtn(this)" title="Soft Teal"></div>
      <div class="cust-swatch" style="background:#7A9E8A" data-btn="#7A9E8A" onclick="setBtn(this)" title="Sage"></div>
      <div class="cust-swatch" style="background:#6B7FA8" data-btn="#6B7FA8" onclick="setBtn(this)" title="Periwinkle"></div>
      <div class="cust-swatch" style="background:#C4877A" data-btn="#C4877A" onclick="setBtn(this)" title="Dusty Rose"></div>
      <div class="cust-swatch" style="background:#8B6355" data-btn="#8B6355" onclick="setBtn(this)" title="Warm Umber"></div>
      <div class="cust-swatch" style="background:#9E8B6E" data-btn="#9E8B6E" onclick="setBtn(this)" title="Sand"></div>
    </div>

    <div class="cust-label" style="margin-bottom:8px">Headline Font</div>
    <div class="cust-row">
      <select id="cust-font" onchange="applyFont(this.value)">
        <option value="Georgia,serif">Georgia (Serif)</option>
        <option value="'Helvetica Neue',Arial,sans-serif" selected>Helvetica Neue (Narrow)</option>
        <option value="'Times New Roman',serif">Times New Roman</option>
        <option value="'Trebuchet MS',sans-serif">Trebuchet (Humanist)</option>
        <option value="'Palatino Linotype',serif">Palatino (Literary)</option>
        <option value="'Century Gothic','Futura',sans-serif">Century Gothic (Geometric)</option>
        <option value="'Courier New',monospace">Courier (Typewriter)</option>
      </select>
    </div>

    <div class="cust-apply" onclick="applyAll()">âœ¦ Apply</div>

    <div class="cust-divider"></div>
    <div class="cust-name-hint">
      Qeiran Â· qauthor Â· Quthora Â· Lybris Â· Lybriq Â· Foliant Â· Velluma
    </div>
  </div>
</div>

<!-- â”€â”€ CAVEAT / LEGAL NOTICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="caveat-bar">
  <strong style="color:var(--warm-brown);letter-spacing:.12em;font-size:10px;text-transform:uppercase;">
    âš  Notice of Private &amp; Proprietary Intellectual Property
  </strong><br>
  All creative works, concepts, platform architecture, QAN Code system, QR trade dress, visual identity, 
  code and content within this platform are the exclusive intellectual property of QRIB and its agent YH (Angel). 
  Unauthorised reproduction, reverse engineering, imitation or distribution â€” in whole or in part â€” 
  is strictly prohibited and will be pursued. Registration constitutes your acceptance of these terms.<br>
  <span style="opacity:.45;font-size:9px;">
    Â© QRIB. All rights reserved. Qeiran is a QRIB platform. 
    QAN Codes are unique permanent identifiers â€” once assigned they cannot be transferred or deleted.
  </span>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUTHORS PORTAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<script>
/* â”€â”€ CUSTOMISER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleCust(){
  document.getElementById('cust-panel').classList.toggle('open');
}
function setBg(el){
  document.querySelectorAll('#bg-swatches .cust-swatch').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  const bg=el.dataset.bg, fg=el.dataset.fg;
  document.documentElement.style.setProperty('--bg',bg);
  document.documentElement.style.setProperty('--fg',fg);
  document.documentElement.style.setProperty('--ink',fg);
  document.documentElement.style.setProperty('--paper',bg);
  const isDark=parseInt(bg.replace('#',''),16)<0x888888;
  document.getElementById('nav').style.background=isDark
    ?`rgba(${hexToRgb(bg)},0.94)`:`rgba(${hexToRgb(bg)},0.97)`;
  document.documentElement.style.setProperty('--cust-bg',isDark?'#1a1a22':'#e8e5dc');
}
function setAcc(el){
  document.querySelectorAll('#acc-swatches .cust-swatch').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  document.documentElement.style.setProperty('--goldf',el.dataset.acc);
  document.documentElement.style.setProperty('--gold',el.dataset.acc);
}
function setBtn(el){
  document.querySelectorAll('#btn-swatches .cust-swatch').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  document.documentElement.style.setProperty('--brand',el.dataset.btn);
  document.documentElement.style.setProperty('--brandl',el.dataset.btn);
}
function applyFont(val){
  document.documentElement.style.setProperty('--narrow',val);
  document.querySelectorAll('.hero-h,.sec-h,.cat-h,.reg-h').forEach(el=>el.style.fontFamily=val);
}
function hexToRgb(hex){
  return `${parseInt(hex.slice(1,3),16)},${parseInt(hex.slice(3,5),16)},${parseInt(hex.slice(5,7),16)}`;
}
function applyAll(){
  const name=document.getElementById('cust-name').value||'Qeiran';
  const suffix=document.getElementById('cust-suffix').value||'';
  document.querySelector('.brand-b').textContent=name;
  const bq=document.querySelector('.brand-q');
  if(bq) bq.textContent=suffix;
  document.title=name+' â€” Independent Author Register';
  const l1=document.getElementById('cust-line1').value||'Your book.';
  const l2=document.getElementById('cust-line2').value||'Registered forever.';
  const h=document.querySelector('.hero-h');
  if(h) h.innerHTML=l1+'<br><span class="it">'+l2+'</span>';
  applyFont(document.getElementById('cust-font').value);
  document.getElementById('cust-panel').classList.remove('open');
}
document.addEventListener('click',e=>{
  const p=document.getElementById('cust-panel');
  const t=document.getElementById('cust-toggle');
  if(p&&p.classList.contains('open')&&!p.contains(e.target)&&e.target!==t)
    p.classList.remove('open');
});

/* == Approve book == */
function approveBook(id) {
  var b = S.books.find(function(x){return x.id===id;});
  if (!b) { toast('Book not found'); return; }
  b.approved = true;
  persist();
  if (typeof saveToCloud === 'function') saveToCloud(b);
  toast('Approved. QAN Code is now live. Email the Q Stamp to the author.');
  openBook(id);
}

/* == Admin QAN Generator == */
function checkAdminParam(){
  var m=document.getElementById('admin-pw-modal');
  if(!m) return false;
  var isAdmin = window.location.search.indexOf('admin=1') !== -1;
  if(isAdmin){
    m.style.display='flex';
    return true;
  } else {
    m.style.display='none';
    return false;
  }
}
// Run immediately and also on DOMContentLoaded as fallback
checkAdminParam();
document.addEventListener('DOMContentLoaded', checkAdminParam);
function adminCheckPW(){
  var pw=document.getElementById('admin-pw-input').value.trim();
  var stored=_adminSettings&&_adminSettings.admin_password?_adminSettings.admin_password:'';
  if(pw==='qrib2026'||pw===stored){
    document.getElementById('admin-pw-modal').style.display='none';
    document.getElementById('admin-modal').style.display='flex';
  } else {
    document.getElementById('admin-pw-error').style.display='block';
    document.getElementById('admin-pw-input').value='';
  }
}

function adminIssueQAN(){
  var gv=function(id){return document.getElementById(id)?document.getElementById(id).value.trim():'';};
  var name=gv('a-name'),email=gv('a-email'),title=gv('a-title');
  var country=gv('a-country')||'GB',year=gv('a-year')||new Date().getFullYear();
  var genre=gv('a-genre')||'General',price=parseFloat(gv('a-price'))||0;
  var synopsis=gv('a-synopsis'),paypal=gv('a-paypal');
  if(!name||!email||!title){alert('Name, email and title required.');return;}
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email)){alert('Valid email required.');return;}
  var qcode=buildQCode(name,country,year,title,1);
  var book={id:'a_'+Date.now(),qcode:qcode,title:title,subtitle:'',author:name,email:email,
    country:country,genre:genre,language:'English',edition:1,year:parseInt(year),
    pages:null,price:price,qeiranCut:0,authorGets:price,
    synopsis:synopsis||'Complimentary registration.',coverUrl:'',
    paypal:paypal,wallet:'',currency:'',bio:'',
    registered:new Date().toISOString(),scans:0,orders:0,approved:true,complimentary:true};
  S.books.push(book);S.lastBook=book;persist();
  if(typeof saveToCloud==='function')saveToCloud(book);
  var res=document.getElementById('admin-result');
  if(res){
    res.style.display='block';
    res.innerHTML='<strong>QAN Code issued:</strong> '+qcode+'<br><strong>Author:</strong> '+name
      +'<br><strong>Email:</strong> '+email
      +'<br><br><em>Book is live in catalogue.</em>'
      +'<br><br><button onclick="dlQR()" style="padding:8px 16px;background:var(--teal);color:#fff;'
      +'border:none;border-radius:5px;font-size:12px;font-weight:600;cursor:pointer;">Download Q Stamp for this author</button>';
    ['a-name','a-email','a-title','a-country','a-year','a-genre','a-price','a-synopsis','a-paypal']
      .forEach(function(id){var el=document.getElementById(id);if(el)el.value='';});
  }
}

/* == Admin tabs == */
function adminTab(name) {
  ['pending','issue','stoppress'].forEach(function(t){
    var panel = document.getElementById('admin-tab-'+t);
    var tab   = document.getElementById('atab-'+t);
    if(panel) panel.style.display = t===name ? 'block' : 'none';
    if(tab){
      tab.style.borderBottomColor = t===name ? '#1A0800' : 'transparent';
      tab.style.color = t===name ? '#1A0800' : '#888';
      tab.style.fontWeight = t===name ? '700' : '600';
    }
  });
  if(name==='pending') adminLoadPending();
  if(name==='stoppress') adminLoadStopPress();
}

function adminLoadPending() {
  var list = document.getElementById('admin-pending-list');
  if(!list) return;
  list.innerHTML='<div style="font-size:11px;color:#aaa;text-align:center;padding:20px;">Loading from database...</div>';
  var cfg = QEIRAN_CONFIG;
  fetch(cfg.SUPABASE_URL+'/rest/v1/books?approved=eq.false&select=id,title,author,email,qcode,registered&order=registered.asc', {
    headers:{'apikey':cfg.SUPABASE_KEY,'Authorization':'Bearer '+cfg.SUPABASE_KEY}
  })
  .then(function(r){return r.json();})
  .then(function(rows){
    if(!rows||rows.length===0){
      list.innerHTML='<div style="font-size:11px;color:#aaa;text-align:center;padding:20px;">No titles pending review. &#10003;</div>';
      return;
    }
    list.innerHTML = rows.map(function(b){
      var ago = b.registered ? Math.round((Date.now()-new Date(b.registered))/(1000*60*60)) : '?';
      return '<div style="background:rgba(26,8,0,.03);border:1px solid rgba(26,8,0,.1);'
        +'border-radius:6px;padding:12px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;gap:10px;">'
        +'<div style="min-width:0;"><div style="font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">'+b.title+'</div>'
        +'<div style="font-size:10px;color:#888;">'+b.author+' &mdash; '+b.email+'</div>'
        +'<div style="font-size:10px;color:#aaa;">QAN: '+b.qcode+' &nbsp;|&nbsp; '+ago+' hrs ago</div></div>'
        +'<button onclick="adminApproveSingle(\''+b.id+'\',\''+b.title.replace(/'/g,"\\'")+'\',\''+b.email+'\')" '
        +'style="padding:7px 14px;background:#5BA89A;color:#fff;border:none;border-radius:5px;'
        +'font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;flex-shrink:0;">Approve</button>'
        +'</div>';
    }).join('');
    window._adminPendingRows = rows;
  })
  .catch(function(e){
    list.innerHTML='<div style="font-size:11px;color:#c0392b;text-align:center;padding:20px;">Database error: '+e.message+'</div>';
  });
}

function adminApproveSingle(id, title, email) {
  var cfg = QEIRAN_CONFIG;
  fetch(cfg.SUPABASE_URL+'/rest/v1/books?id=eq.'+encodeURIComponent(id), {
    method:'PATCH',
    headers:{
      'apikey':cfg.SUPABASE_KEY,
      'Authorization':'Bearer '+cfg.SUPABASE_KEY,
      'Content-Type':'application/json',
      'Prefer':'return=minimal'
    },
    body: JSON.stringify({approved:true})
  })
  .then(function(r){
    if(r.ok||r.status===204){
      toast('Approved: '+(title||id));
      adminLoadPending();
    } else {
      r.text().then(function(t){toast('Error: '+t);});
    }
  })
  .catch(function(e){toast('Network error: '+e.message);});
}

function adminApproveAll() {
  var rows = window._adminPendingRows;
  if(!rows||rows.length===0){ toast('No pending titles.'); adminLoadPending(); return; }
  var cfg = QEIRAN_CONFIG;
  var ids = rows.map(function(r){return r.id;});
  fetch(cfg.SUPABASE_URL+'/rest/v1/books?id=in.('+ids.join(',')+')', {
    method:'PATCH',
    headers:{
      'apikey':cfg.SUPABASE_KEY,
      'Authorization':'Bearer '+cfg.SUPABASE_KEY,
      'Content-Type':'application/json',
      'Prefer':'return=minimal'
    },
    body: JSON.stringify({approved:true})
  })
  .then(function(r){
    if(r.ok||r.status===204){
      toast('All '+rows.length+' titles approved.');
      window._adminPendingRows = [];
      adminLoadPending();
    } else {
      r.text().then(function(t){toast('Error: '+t);});
    }
  })
  .catch(function(e){toast('Network error: '+e.message);});
}

/* == Stop Press â€” stored in Supabase settings table == */
function _updateStopPressUI(stopped){
  var statusEl = document.getElementById('sp-status');
  var btnEl = document.getElementById('sp-btn');
  if(statusEl) statusEl.innerHTML = stopped
    ? '<span style="color:#c0392b;">&#9632; STOP PRESS IS ON &mdash; automatic emails paused</span>'
    : '<span style="color:#27ae60;">&#9654; System running normally &mdash; 24hr auto-send active</span>';
  if(btnEl){
    btnEl.textContent = stopped ? 'Resume (release queue)' : 'Stop Press';
    btnEl.style.background = stopped ? '#27ae60' : '#c0392b';
    btnEl.style.color = '#fff';
  }
}

function adminLoadStopPress() {
  var cfg = QEIRAN_CONFIG;
  fetch(cfg.SUPABASE_URL+'/rest/v1/settings?key=eq.stop_press&select=value', {
    headers:{'apikey':cfg.SUPABASE_KEY,'Authorization':'Bearer '+cfg.SUPABASE_KEY}
  })
  .then(function(r){return r.json();})
  .then(function(rows){
    var stopped = rows && rows[0] && rows[0].value==='1';
    _updateStopPressUI(stopped);
  })
  .catch(function(){
    // Fallback to localStorage if Supabase unreachable
    _updateStopPressUI(localStorage.getItem('qeiran_stop_press')==='1');
  });
}

function adminToggleStopPress() {
  var cfg = QEIRAN_CONFIG;
  // Read current state from Supabase, then toggle
  fetch(cfg.SUPABASE_URL+'/rest/v1/settings?key=eq.stop_press&select=value', {
    headers:{'apikey':cfg.SUPABASE_KEY,'Authorization':'Bearer '+cfg.SUPABASE_KEY}
  })
  .then(function(r){return r.json();})
  .then(function(rows){
    var stopped = rows && rows[0] && rows[0].value==='1';
    var newVal = stopped ? '0' : '1';
    return fetch(cfg.SUPABASE_URL+'/rest/v1/settings', {
      method:'POST',
      headers:{
        'apikey':cfg.SUPABASE_KEY,
        'Authorization':'Bearer '+cfg.SUPABASE_KEY,
        'Content-Type':'application/json',
        'Prefer':'resolution=merge-duplicates'
      },
      body: JSON.stringify({key:'stop_press', value:newVal})
    }).then(function(){
      _updateStopPressUI(newVal==='1');
      toast(newVal==='1' ? 'Stop Press activated. No automatic emails will send.' : 'System resumed. Queue will process on next cycle.');
    });
  })
  .catch(function(){
    // Fallback localStorage
    var stopped = localStorage.getItem('qeiran_stop_press')==='1';
    localStorage.setItem('qeiran_stop_press', stopped ? '0' : '1');
    adminLoadStopPress();
    toast(stopped ? 'System resumed.' : 'Stop Press activated.');
  });
}

/* Open admin panel on load if needed */
(function(){
  if(document.getElementById('admin-tab-pending')) adminLoadPending();
})();
</script>


<!-- PASSWORD MODAL -->


<!-- ADMIN PANEL -->
<div id="admin-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:9999;align-items:center;justify-content:center;">
  <div style="background:#f6f1e9;border-radius:12px;padding:28px;width:min(540px,94vw);max-height:88vh;overflow-y:auto;position:relative;">
    <button onclick="document.getElementById('admin-modal').style.display='none'" style="position:absolute;top:14px;right:14px;font-size:22px;background:none;border:none;cursor:pointer;color:#888;">&times;</button>
    <h2 style="font-size:17px;font-weight:700;margin-bottom:14px;">QRIB Admin</h2>

    <!-- TABS -->
    <div style="display:flex;gap:0;margin-bottom:20px;border-bottom:2px solid #e0d6c8;">
      <button onclick="adminTab('pending')" id="atab-pending" style="padding:8px 14px;background:none;border:none;border-bottom:3px solid #1A0800;margin-bottom:-2px;font-size:12px;font-weight:700;cursor:pointer;color:#1A0800;">Pending Review</button>
      <button onclick="adminTab('issue')" id="atab-issue" style="padding:8px 14px;background:none;border:none;border-bottom:3px solid transparent;margin-bottom:-2px;font-size:12px;font-weight:600;cursor:pointer;color:#888;">Issue Free Code</button>
      <button onclick="adminTab('stoppress')" id="atab-stoppress" style="padding:8px 14px;background:none;border:none;border-bottom:3px solid transparent;margin-bottom:-2px;font-size:12px;font-weight:600;cursor:pointer;color:#c0392b;">&#9632; Stop Press</button>
      <button onclick="adminTab('settings')" id="atab-settings" style="padding:8px 14px;background:none;border:none;border-bottom:3px solid transparent;margin-bottom:-2px;font-size:12px;font-weight:600;cursor:pointer;color:#555;">&#9881; Settings</button>
    </div>

    <!-- PENDING TAB -->
    <div id="admin-tab-pending">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div style="font-size:11px;color:#888;">Books awaiting your approval</div>
        <button onclick="adminApproveAll()" style="padding:6px 14px;background:#5BA89A;color:#fff;border:none;border-radius:5px;font-size:11px;font-weight:600;cursor:pointer;">Approve All</button>
      </div>
      <div id="admin-pending-list"><div style="font-size:11px;color:#aaa;text-align:center;padding:20px;">Loading...</div></div>
    </div>

    <!-- ISSUE FREE CODE TAB -->
    <div id="admin-tab-issue" style="display:none;">
      <p style="font-size:11px;color:#888;margin-bottom:14px;">Complimentary registration. No payment. Book goes live immediately with approved status.</p>
      <div style="display:flex;flex-direction:column;gap:10px;">
        <input id="a-name" type="text" placeholder="Author Full Name *" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;width:100%;box-sizing:border-box;">
        <input id="a-email" type="email" placeholder="Author Email *" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;width:100%;box-sizing:border-box;">
        <input id="a-title" type="text" placeholder="Book Title *" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;width:100%;box-sizing:border-box;">
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;">
          <input id="a-country" type="text" placeholder="Country (GB)" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;box-sizing:border-box;">
          <input id="a-year" type="number" placeholder="Year" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;box-sizing:border-box;">
          <input id="a-price" type="number" placeholder="Price (Â£)" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;box-sizing:border-box;">
        </div>
        <input id="a-genre" type="text" placeholder="Genre" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;width:100%;box-sizing:border-box;">
        <textarea id="a-synopsis" rows="3" placeholder="Synopsis" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;width:100%;box-sizing:border-box;resize:vertical;"></textarea>
        <input id="a-paypal" type="email" placeholder="Author PayPal Email" style="padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;width:100%;box-sizing:border-box;">
      </div>
      <div id="admin-result" style="display:none;margin-top:14px;background:rgba(91,168,154,.1);border:1px solid rgba(91,168,154,.35);border-radius:7px;padding:13px;font-size:12px;line-height:1.7;"></div>
      <button onclick="adminIssueQAN()" style="margin-top:14px;width:100%;padding:13px;background:#5BA89A;color:#fff;border:none;border-radius:7px;font-size:13px;font-weight:600;cursor:pointer;">Issue QAN Code (Complimentary)</button>
    </div>

    <!-- STOP PRESS TAB -->
    <div id="admin-tab-stoppress" style="display:none;text-align:center;padding:16px 0;">
      <div style="font-size:40px;margin-bottom:12px;">&#128750;</div>
      <div id="sp-status" style="font-size:14px;font-weight:700;margin-bottom:8px;"></div>
      <div style="font-size:11px;color:#888;margin-bottom:20px;line-height:1.6;max-width:320px;margin-left:auto;margin-right:auto;">When Stop Press is ON, automatic 24hr QAN Code emails are paused. Books queue. Press Resume to release all queued approvals.</div>
      <button id="sp-btn" onclick="adminToggleStopPress()" style="padding:12px 28px;font-size:13px;font-weight:700;border:none;border-radius:8px;cursor:pointer;">Loading...</button>
    </div>

    <!-- SETTINGS TAB -->
    <div id="admin-tab-settings" style="display:none;">
      <p style="font-size:11px;color:#888;margin-bottom:16px;line-height:1.6;">Adjust platform parameters. Changes take effect immediately for all new registrations. Stored in Supabase so they persist across sessions.</p>

      <div style="display:flex;flex-direction:column;gap:14px;">

        <div style="background:#fff;border:1px solid #e0d6c8;border-radius:8px;padding:14px;">
          <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:#666;margin-bottom:10px;">ğŸ’° Pricing</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
            <div>
              <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Registration Fee (Â£)</label>
              <input id="s-reg-fee" type="number" min="0" step="1" style="width:100%;padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:14px;font-weight:600;box-sizing:border-box;">
            </div>
            <div>
              <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">QRIB Commission (%)</label>
              <input id="s-commission" type="number" min="0" max="100" step="1" style="width:100%;padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:14px;font-weight:600;box-sizing:border-box;">
            </div>
          </div>
          <div style="font-size:10px;color:#aaa;margin-top:8px;">Author receives: <span id="s-author-pct">88</span>% &nbsp;|&nbsp; QRIB keeps: <span id="s-qrib-pct">12</span>%</div>
        </div>

        <div style="background:#fff;border:1px solid #e0d6c8;border-radius:8px;padding:14px;">
          <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:#666;margin-bottom:10px;">âœ‰ï¸ Platform Contacts</div>
          <div style="display:flex;flex-direction:column;gap:10px;">
            <div>
              <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Platform Email (notifications sent here)</label>
              <input id="s-platform-email" type="email" style="width:100%;padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;box-sizing:border-box;">
            </div>
            <div>
              <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">PayPal Email (payment destination)</label>
              <input id="s-paypal-email" type="email" style="width:100%;padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;box-sizing:border-box;">
            </div>
          </div>
        </div>

        <div style="background:#fff;border:1px solid #e0d6c8;border-radius:8px;padding:14px;">
          <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:#666;margin-bottom:10px;">â± Automation</div>
          <div>
            <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Auto-email delay (hours after registration)</label>
            <input id="s-email-delay" type="number" min="1" max="168" step="1" style="width:160px;padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:14px;font-weight:600;box-sizing:border-box;">
          </div>
          <div style="font-size:10px;color:#aaa;margin-top:8px;">Default: 24 hrs. If Stop Press is ON, no emails send regardless of this setting.</div>
        </div>

        <div style="background:#fff;border:1px solid #e0d6c8;border-radius:8px;padding:14px;">
          <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:#666;margin-bottom:10px;">ğŸ”’ Security</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
            <div>
              <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">New Admin Password</label>
              <input id="s-new-password" type="password" placeholder="Leave blank to keep" style="width:100%;padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;box-sizing:border-box;">
            </div>
            <div>
              <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Confirm Password</label>
              <input id="s-confirm-password" type="password" placeholder="Leave blank to keep" style="width:100%;padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:13px;box-sizing:border-box;">
            </div>
          </div>
          <div style="font-size:10px;color:#e74c3c;margin-top:6px;">âš  Password changes only persist for this browser session unless saved to Supabase settings.</div>
        </div>

      </div>

      <div id="settings-msg" style="display:none;margin-top:12px;padding:10px 14px;border-radius:6px;font-size:12px;font-weight:600;"></div>

      <div style="display:flex;gap:10px;margin-top:16px;">
        <button onclick="adminSaveSettings()" style="flex:1;padding:13px;background:#5BA89A;color:#fff;border:none;border-radius:7px;font-size:13px;font-weight:700;cursor:pointer;">ğŸ’¾ Save All Settings</button>
        <button onclick="adminLoadSettings()" style="padding:13px 18px;background:#f0ebe2;color:#555;border:1px solid #ccc;border-radius:7px;font-size:13px;font-weight:600;cursor:pointer;">â†º Reload</button>
      </div>

      <div style="background:#fff;border:1px solid #e0d6c8;border-radius:8px;padding:14px;">
          <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:#666;margin-bottom:10px;">â‚¿ Crypto Payment Option</div>
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
            <label style="font-size:11px;color:#888;">Enable crypto payment</label>
            <div style="display:flex;gap:8px;">
              <label style="font-size:11px;"><input type="radio" name="crypto-active" id="s-crypto-on" value="1"> On</label>
              <label style="font-size:11px;"><input type="radio" name="crypto-active" id="s-crypto-off" value="0" checked> Off</label>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:3fr 1fr;gap:10px;">
            <div>
              <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Wallet Address</label>
              <input id="s-crypto-wallet" type="text" placeholder="e.g. bc1qxxxxxxxx or 0xXXXXXX" style="width:100%;padding:9px 11px;border:1px solid #ccc;border-radius:5px;font-size:12px;font-family:monospace;box-sizing:border-box;">
            </div>
            <div>
              <label style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Currency</label>
              <select id="s-crypto-currency" style="width:100%;padding:9px 8px;border:1px solid #ccc;border-radius:5px;font-size:13px;box-sizing:border-box;">
                <option>BTC</option>
                <option>ETH</option>
                <option>USDC</option>
                <option>USDT</option>
                <option>SOL</option>
                <option>XRP</option>
              </select>
            </div>
          </div>
          <div style="font-size:10px;color:#aaa;margin-top:8px;">When enabled, crypto wallet address appears on payment page. Confirmation is manual â€” author emails you their transaction ID.</div>
        </div>

      <div style="margin-top:16px;padding:12px;background:#fff8e1;border:1px solid #f0c040;border-radius:6px;font-size:10px;color:#7a6000;line-height:1.7;">
        <strong>Note on GitHub Actions automation:</strong> The email delay setting here updates Supabase. The GitHub Actions workflow reads the <code>settings</code> table each run and uses the stored delay value. After changing, allow up to 1 hour for the next scheduled run to pick it up.
      </div>
    </div>

  </div>
</div>

<script>
/* === ADMIN SETTINGS TAB === */
var _adminSettings = {
  regFee: 29,
  commission: 12,
  platformEmail: 'maat@qrib.co.uk',
  paypalEmail: 'maat@qrib.co.uk',
  emailDelayHrs: 24,
  password: 'qrib2026'
};

function adminLoadSettings(){
  // Try to load from Supabase settings table
  var cfg = QEIRAN_CONFIG;
  var url = cfg.SUPABASE_URL + '/rest/v1/settings?key=in.(reg_fee,commission,platform_email,paypal_email,email_delay_hrs,admin_password)&select=key,value';
  fetch(url, {headers:{'apikey':cfg.SUPABASE_KEY,'Authorization':'Bearer '+cfg.SUPABASE_KEY}})
    .then(function(r){return r.json();})
    .then(function(rows){
      if(rows && rows.length){
        rows.forEach(function(row){
          if(row.key==='reg_fee') _adminSettings.regFee = parseFloat(row.value)||29;
          if(row.key==='commission') _adminSettings.commission = parseFloat(row.value)||12;
          if(row.key==='platform_email') _adminSettings.platformEmail = row.value||'maat@qrib.co.uk';
          if(row.key==='paypal_email') _adminSettings.paypalEmail = row.value||'maat@qrib.co.uk';
          if(row.key==='email_delay_hrs') _adminSettings.emailDelayHrs = parseInt(row.value)||24;
          if(row.key==='admin_password') _adminSettings.password = row.value||'qrib2026';
          if(row.key==='crypto_wallet') _adminSettings.cryptoWallet = row.value||'';
          if(row.key==='crypto_currency') _adminSettings.cryptoCurrency = row.value||'BTC';
          if(row.key==='crypto_active') _adminSettings.cryptoActive = row.value||'0';
        });
      }
      adminPopulateSettingsForm();
    })
    .catch(function(){
      // Fall back to current config values
      _adminSettings.regFee = QEIRAN_CONFIG.REGISTRATION_FEE||29;
      adminPopulateSettingsForm();
    });
}

function adminPopulateSettingsForm(){
  var s = _adminSettings;
  var el = function(id){return document.getElementById(id);};
  if(el('s-reg-fee')) el('s-reg-fee').value = s.regFee;
  if(el('s-commission')) el('s-commission').value = s.commission;
  if(el('s-platform-email')) el('s-platform-email').value = s.platformEmail;
  if(el('s-paypal-email')) el('s-paypal-email').value = s.paypalEmail;
  if(el('s-email-delay')) el('s-email-delay').value = s.emailDelayHrs;
  if(s.cryptoWallet && el('s-crypto-wallet')) el('s-crypto-wallet').value = s.cryptoWallet;
  if(s.cryptoCurrency && el('s-crypto-currency')) el('s-crypto-currency').value = s.cryptoCurrency;
  if(s.cryptoActive==='1'){var on=document.getElementById('s-crypto-on');if(on)on.checked=true;}
  adminUpdateCommissionDisplay();
}

function adminUpdateCommissionDisplay(){
  var comm = parseFloat(document.getElementById('s-commission')?document.getElementById('s-commission').value:12)||12;
  var authorPct = Math.round((100-comm)*10)/10;
  if(document.getElementById('s-author-pct')) document.getElementById('s-author-pct').textContent = authorPct;
  if(document.getElementById('s-qrib-pct')) document.getElementById('s-qrib-pct').textContent = comm;
}

// Live commission display update
document.addEventListener('DOMContentLoaded', function(){
  var commEl = document.getElementById('s-commission');
  if(commEl) commEl.addEventListener('input', adminUpdateCommissionDisplay);
});

function adminSaveSettings(){
  var el = function(id){return document.getElementById(id);};
  var fee = parseFloat(el('s-reg-fee')?el('s-reg-fee').value:'29')||29;
  var comm = parseFloat(el('s-commission')?el('s-commission').value:'12')||12;
  var pEmail = (el('s-platform-email')?el('s-platform-email').value:'').trim();
  var ppEmail = (el('s-paypal-email')?el('s-paypal-email').value:'').trim();
  var delay = parseInt(el('s-email-delay')?el('s-email-delay').value:'24')||24;
  var newPw = (el('s-new-password')?el('s-new-password').value:'').trim();
  var confPw = (el('s-confirm-password')?el('s-confirm-password').value:'').trim();

  if(newPw && newPw !== confPw){
    adminSettingsMsg('Passwords do not match.', false);
    return;
  }
  if(comm<0||comm>100){adminSettingsMsg('Commission must be 0-100%.', false);return;}
  if(fee<0){adminSettingsMsg('Fee cannot be negative.', false);return;}
  if(delay<1||delay>168){adminSettingsMsg('Delay must be 1â€“168 hours.', false);return;}

  // Build upsert rows
  var rows = [
    {key:'reg_fee', value:String(fee)},
    {key:'commission', value:String(comm)},
    {key:'email_delay_hrs', value:String(delay)}
  ];
  if(pEmail) rows.push({key:'platform_email', value:pEmail});
  if(ppEmail) rows.push({key:'paypal_email', value:ppEmail});
  if(newPw) rows.push({key:'admin_password', value:newPw});
  // Crypto settings
  var cryptoActive = document.querySelector('input[name="crypto-active"]:checked');
  var cryptoWallet = (el('s-crypto-wallet')?el('s-crypto-wallet').value:'').trim();
  var cryptoCurrency = el('s-crypto-currency')?el('s-crypto-currency').value:'BTC';
  rows.push({key:'crypto_active', value: cryptoActive ? cryptoActive.value : '0'});
  if(cryptoWallet) rows.push({key:'crypto_wallet', value:cryptoWallet});
  rows.push({key:'crypto_currency', value:cryptoCurrency});

  var cfg = QEIRAN_CONFIG;
  fetch(cfg.SUPABASE_URL + '/rest/v1/settings', {
    method:'POST',
    headers:{
      'apikey':cfg.SUPABASE_KEY,
      'Authorization':'Bearer '+cfg.SUPABASE_KEY,
      'Content-Type':'application/json',
      'Prefer':'resolution=merge-duplicates'
    },
    body: JSON.stringify(rows)
  })
  .then(function(r){
    if(r.ok||r.status===200||r.status===201){
      // Apply to live config immediately in this session
      QEIRAN_CONFIG.REGISTRATION_FEE = fee;
      // Update PayPal link on the page
      var ppLink = document.querySelector('a[href*="paypal.me/Qeiran"]');
      if(ppLink && ppEmail) ppLink.href = 'https://paypal.me/Qeiran/'+Math.round(fee)+'GBP';
      var ppBtn = document.querySelector('[href*="paypal.me"]');
      // Update displayed fee labels
      document.querySelectorAll('[data-fee-label]').forEach(function(el){
        el.textContent = 'Â£'+fee;
      });
      if(newPw) _adminSettings.password = newPw;
      _adminSettings.regFee = fee;
      _adminSettings.commission = comm;
      _adminSettings.emailDelayHrs = delay;
      adminSettingsMsg('âœ“ Settings saved successfully. Fee: Â£'+fee+' | Commission: '+comm+'% | Authors receive: '+(100-comm)+'% | Email delay: '+delay+'hrs', true);
    } else {
      r.text().then(function(t){adminSettingsMsg('Save error: '+t, false);});
    }
  })
  .catch(function(e){
    adminSettingsMsg('Network error. Settings NOT saved to database: '+e.message, false);
  });
}

function adminSettingsMsg(msg, ok){
  var el = document.getElementById('settings-msg');
  if(!el) return;
  el.style.display = 'block';
  el.style.background = ok ? 'rgba(91,168,154,.15)' : 'rgba(231,76,60,.1)';
  el.style.border = ok ? '1px solid #5BA89A' : '1px solid #e74c3c';
  el.style.color = ok ? '#2d7a6e' : '#c0392b';
  el.innerHTML = msg;
}

// Patch adminTab to load settings when tab selected
var _origAdminTab = typeof adminTab !== 'undefined' ? adminTab : null;
document.addEventListener('DOMContentLoaded', function(){
  // Extend adminTab to load settings on open
  var origFn = window.adminTab;
  window.adminTab = function(tab){
    origFn(tab);
    if(tab==='settings') adminLoadSettings();
  };
});
</script>


<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAYPAL PAYMENT INTEGRATION
   Card payment primary, PayPal button secondary.
   Uses Supabase Edge Functions to create & capture orders
   so the Secret never appears in client-side code.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

var _paymentOrderId = null;
var _paymentConfirmed = false;
var _cardFields = null;

/* Supabase Edge Function endpoints */
var EDGE_BASE = QEIRAN_CONFIG.SUPABASE_URL + '/functions/v1';

/* Called when terms checkbox ticked â€” initialises PayPal SDK */
function initPayPal() {
  if (typeof paypal === 'undefined') {
    document.getElementById('card-pay-error').style.display = 'block';
    document.getElementById('card-pay-error').textContent = 'Payment system loading... please wait a moment and try again.';
    return;
  }

  /* Load active crypto wallet from admin settings */
  loadCryptoOption();

  /* â”€â”€ Card Fields (primary: no PayPal branding visible) â”€â”€ */
  if (paypal.CardFields) {
    try {
      _cardFields = paypal.CardFields({
        createOrder: createPayPalOrder,
        onApprove:   onPaymentApproved,
        onError: function(err) {
          showCardError('Card payment failed: ' + (err.message || 'Please try again.'));
        }
      });

      if (_cardFields.isEligible()) {
        var numberField = _cardFields.NumberField({
          style: { input: { 'font-size': '13px', 'color': '#1A0800', 'font-family': 'system-ui,sans-serif' } }
        });
        var expiryField = _cardFields.ExpiryField({
          style: { input: { 'font-size': '13px', 'color': '#1A0800', 'font-family': 'system-ui,sans-serif' } }
        });
        var cvvField = _cardFields.CVVField({
          style: { input: { 'font-size': '13px', 'color': '#1A0800', 'font-family': 'system-ui,sans-serif' } }
        });
        var nameField = _cardFields.NameField({
          style: { input: { 'font-size': '13px', 'color': '#1A0800', 'font-family': 'system-ui,sans-serif' } }
        });

        numberField.render('#card-number-field-container');
        expiryField.render('#card-expiry-field-container');
        cvvField.render('#card-cvv-field-container');
        nameField.render('#card-name-field-container');
      } else {
        /* Card fields not eligible in this region/browser â€” hide section */
        document.getElementById('pay-card-section').style.display = 'none';
      }
    } catch(e) {
      document.getElementById('pay-card-section').style.display = 'none';
    }
  }

  /* â”€â”€ PayPal Button (secondary) â”€â”€ */
  paypal.Buttons({
    style: {
      layout: 'horizontal',
      color:  'gold',
      shape:  'rect',
      label:  'paypal',
      height: 40,
      tagline: false
    },
    createOrder: createPayPalOrder,
    onApprove:   onPaymentApproved,
    onError: function(err) {
      showCardError('PayPal payment error: ' + (err.message || 'Please try again.'));
    },
    onCancel: function() {
      showCardError('Payment cancelled.');
    }
  }).render('#paypal-button-container');
}

/* Create order via Supabase Edge Function (keeps Secret server-side) */
async function createPayPalOrder() {
  try {
    var fee = (QEIRAN_CONFIG.REGISTRATION_FEE || 29).toFixed(2);
    var r = await fetch(EDGE_BASE + '/create-paypal-order', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + QEIRAN_CONFIG.SUPABASE_KEY
      },
      body: JSON.stringify({ amount: fee, currency: 'GBP' })
    });
    var data = await r.json();
    if (!data.id) throw new Error(data.error || 'Order creation failed');
    _paymentOrderId = data.id;
    return data.id;
  } catch(e) {
    showCardError('Could not start payment: ' + e.message);
    throw e;
  }
}

/* Capture via Supabase Edge Function */
async function onPaymentApproved(data) {
  var orderId = data.orderID || _paymentOrderId;
  setCardLoading(true);
  try {
    var r = await fetch(EDGE_BASE + '/capture-paypal-order', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + QEIRAN_CONFIG.SUPABASE_KEY
      },
      body: JSON.stringify({ orderId: orderId })
    });
    var result = await r.json();
    if (result.success) {
      _paymentConfirmed = true;
      _paymentOrderId = orderId;
      paymentSuccess();
    } else {
      showCardError('Payment could not be confirmed. Please contact support. Ref: ' + orderId);
    }
  } catch(e) {
    showCardError('Capture error: ' + e.message);
  }
  setCardLoading(false);
}

/* Submit card fields */
async function submitCardPayment() {
  if (!_cardFields) { showCardError('Payment not ready â€” please refresh.'); return; }
  hideCardError();
  setCardLoading(true);
  try {
    await _cardFields.submit();
    /* onApprove fires automatically after submit */
  } catch(e) {
    showCardError(e.message || 'Card payment failed â€” please check your details.');
    setCardLoading(false);
  }
}

/* Called after confirmed payment */
function paymentSuccess() {
  document.getElementById('pay-confirmed').style.display = 'block';
  document.getElementById('paypal-fee-block').style.background = 'rgba(91,168,154,.04)';
  /* Enable submit button */
  var btn = document.getElementById('reg-btn');
  btn.disabled = false;
  btn.style.opacity = '1';
  btn.style.cursor = 'pointer';
  btn.textContent = 'Complete Registration';
  btn.style.background = 'var(--teal)';
  toast('Payment confirmed âœ“ â€” complete your registration below.');
  /* Scroll to submit */
  btn.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

/* â”€â”€ Load crypto option from admin settings â”€â”€ */
function loadCryptoOption() {
  var cfg = QEIRAN_CONFIG;
  fetch(cfg.SUPABASE_URL + '/rest/v1/settings?key=in.(crypto_wallet,crypto_currency,crypto_active)&select=key,value', {
    headers: { 'apikey': cfg.SUPABASE_KEY, 'Authorization': 'Bearer ' + cfg.SUPABASE_KEY }
  })
  .then(function(r){ return r.json(); })
  .then(function(rows){
    if (!rows || !rows.length) return;
    var wallet='', currency='BTC', active='0';
    rows.forEach(function(r){
      if (r.key==='crypto_wallet') wallet = r.value;
      if (r.key==='crypto_currency') currency = r.value;
      if (r.key==='crypto_active') active = r.value;
    });
    if (active === '1' && wallet) {
      var sec = document.getElementById('pay-crypto-section');
      if (sec) {
        sec.style.opacity = '1';
        sec.style.pointerEvents = 'auto';
        sec.innerHTML = '<div style="font-size:10px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:#888;margin-bottom:6px;">Crypto Payment</div>'
          + '<div style="background:#f5f0e8;border:1px solid #ccc;border-radius:6px;padding:12px;font-size:11px;color:#555;">'
          + '<div style="font-weight:700;margin-bottom:4px;">' + currency + ' Wallet Address</div>'
          + '<div style="font-family:monospace;font-size:10px;word-break:break-all;color:#1A0800;">' + wallet + '</div>'
          + '<div style="margin-top:8px;font-size:10px;color:#888;">Send exactly <strong>Â£29 equivalent</strong> in ' + currency + ' to the address above, then email your transaction ID to <strong>' + (QEIRAN_CONFIG.PLATFORM_EMAIL||'maat@qrib.co.uk') + '</strong> â€” we will confirm manually.</div>'
          + '</div>';
      }
    }
  })
  .catch(function(){});
}

/* â”€â”€ Helpers â”€â”€ */
function showCardError(msg) {
  var el = document.getElementById('card-pay-error');
  if (el) { el.style.display='block'; el.textContent = msg; }
}
function hideCardError() {
  var el = document.getElementById('card-pay-error');
  if (el) el.style.display='none';
}
function setCardLoading(on) {
  var btn = document.getElementById('card-pay-btn');
  var load = document.getElementById('card-pay-loading');
  if (btn) btn.style.display = on ? 'none' : 'block';
  if (load) load.style.display = on ? 'block' : 'none';
}

/* â”€â”€ Patch checkOriginal to also init PayPal â”€â”€ */
var _origCheckOriginal = checkOriginal;
window.checkOriginal = function() {
  _origCheckOriginal();
  var checked = document.getElementById('orig-check').checked;
  if (checked) {
    /* Small delay to let the payment block render before init */
    setTimeout(initPayPal, 200);
  }
};

/* â”€â”€ Patch doRegister to include payment reference â”€â”€ */
var _origDoRegister = doRegister;
window.doRegister = function() {
  if (!_paymentConfirmed) {
    toast('Please complete payment before submitting.');
    return;
  }
  _origDoRegister();
};

/* â”€â”€ Update saveToCloud to include payment_ref â”€â”€ */
var _origSaveToCloud = saveToCloud;
window.saveToCloud = async function(book) {
  if (_paymentOrderId) book.paymentRef = _paymentOrderId;
  return _origSaveToCloud(book);
};

</script>

</body>
</html>